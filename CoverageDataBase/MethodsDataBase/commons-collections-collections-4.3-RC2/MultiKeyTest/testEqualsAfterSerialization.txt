@Test public void testEqualsAfterSerialization() throws IOException, ClassNotFoundException {
  SystemHashCodeSimulatingKey sysKey=new SystemHashCodeSimulatingKey("test");
  final MultiKey<?> mk=new MultiKey<Object>(ONE,sysKey);
  final Map<MultiKey<?>,Integer> map=new HashMap<>();
  map.put(mk,TWO);
  final ByteArrayOutputStream baos=new ByteArrayOutputStream();
  final ObjectOutputStream out=new ObjectOutputStream(baos);
  out.writeObject(sysKey);
  out.writeObject(map);
  out.close();
  final ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  final ObjectInputStream in=new ObjectInputStream(bais);
  sysKey=(SystemHashCodeSimulatingKey)in.readObject();
  final Map<?,?> map2=(Map<?,?>)in.readObject();
  in.close();
  assertEquals(2,sysKey.hashCode());
  final MultiKey<?> mk2=new MultiKey<Object>(ONE,sysKey);
  assertEquals(TWO,map2.get(mk2));
}

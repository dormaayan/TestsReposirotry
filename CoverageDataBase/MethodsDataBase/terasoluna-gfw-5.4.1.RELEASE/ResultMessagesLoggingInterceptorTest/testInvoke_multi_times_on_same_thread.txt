/** 
 * [invoke] Case of intercept two times(multi times) on same thread(+other stack). <p> [Expected Result] <ol> <li>throws exception.</li> <li>BusinessException log is output in both interception.(verify ThreadLocal variable is removed.)</li> </ol> </p>
 */
@Test public void testInvoke_multi_times_on_same_thread() throws Throwable {
  BusinessException occurException=new BusinessException(ResultMessages.error().add("e.cm.xxx1","args1","args2"));
  when(mockMethodInvocation.proceed()).thenThrow(occurException);
  try {
    testTarget.invoke(mockMethodInvocation);
    fail("don't occur BusinessException.");
  }
 catch (  BusinessException e) {
    assertThat(e,is(occurException));
  }
  try {
    testTarget.invoke(mockMethodInvocation);
    fail("don't occur BusinessException.");
  }
 catch (  BusinessException e) {
    assertThat(e,is(occurException));
  }
  verify(mockExceptionLogger,times(2)).warn(occurException);
  verify(mockExceptionLogger,times(2)).warn((Exception)anyObject());
}

@Test public void testSmallLastStep() throws DimensionMismatchException, NumberIsTooSmallException, MaxCountExceededException, NoBracketingException {
  TestProblemAbstract pb=new TestProblem5();
  double minStep=1.25;
  double maxStep=FastMath.abs(pb.getFinalTime() - pb.getInitialTime());
  double scalAbsoluteTolerance=6.0e-4;
  double scalRelativeTolerance=6.0e-4;
  AdaptiveStepsizeIntegrator integ=new DormandPrince54Integrator(minStep,maxStep,scalAbsoluteTolerance,scalRelativeTolerance);
  DP54SmallLastHandler handler=new DP54SmallLastHandler(minStep);
  integ.addStepHandler(handler);
  integ.setInitialStepSize(1.7);
  integ.integrate(pb,pb.getInitialTime(),pb.getInitialState(),pb.getFinalTime(),new double[pb.getDimension()]);
  Assert.assertTrue(handler.wasLastSeen());
  Assert.assertEquals("Dormand-Prince 5(4)",integ.getName());
}

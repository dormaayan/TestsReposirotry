@Test public void testAsyncClose_read() throws Throwable {
  RegularFile file=regularFile(15);
  ExecutorService executor=Executors.newFixedThreadPool(2);
  try {
    JimfsAsynchronousFileChannel channel=channel(file,executor,READ,WRITE);
    file.writeLock().lock();
    Future<Integer> future=channel.read(ByteBuffer.allocate(10),0);
    SettableFuture<Integer> completionHandlerFuture=SettableFuture.create();
    channel.read(ByteBuffer.allocate(10),0,null,setFuture(completionHandlerFuture));
    Uninterruptibles.sleepUninterruptibly(10,MILLISECONDS);
    channel.close();
    assertAsynchronousClose(future);
    assertAsynchronousClose(completionHandlerFuture);
  }
  finally {
    executor.shutdown();
  }
}

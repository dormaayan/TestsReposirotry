@Test public void testRepeatedGetConnectionInTimeout() throws Exception {
  mds.getTransactionManager().setTransactionTimeout(1);
  mds.getTransactionManager().begin();
  try {
    do {
      Thread.sleep(1000);
    }
 while (mds.getTransactionManager().getTransaction().getStatus() != Status.STATUS_ROLLEDBACK);
    Thread.sleep(1000);
    try (Connection conn=mds.getConnection()){
      fail("Should not get the connection 1");
    }
 catch (    final SQLException e) {
      if (!e.getCause().getClass().equals(IllegalStateException.class)) {
        throw e;
      }
      try (Connection conn=mds.getConnection()){
        fail("Should not get connection 2");
      }
 catch (      final SQLException e2) {
        if (!e2.getCause().getClass().equals(IllegalStateException.class)) {
          throw e2;
        }
      }
    }
  }
  finally {
    mds.getTransactionManager().rollback();
  }
  Assert.assertEquals(0,mds.getNumActive());
}

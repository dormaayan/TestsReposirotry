@Test public void testPoolCloseRTE() throws Exception {
  ds.setAccessToUnderlyingConnectionAllowed(true);
  final Connection conn=ds.getConnection();
  final TesterConnection tc=(TesterConnection)((DelegatingConnection<?>)conn).getInnermostDelegate();
  conn.close();
  tc.setFailure(new IllegalStateException("boom"));
  try {
    StackMessageLog.lock();
    StackMessageLog.clear();
    ds.close();
    final String message=StackMessageLog.popMessage();
    Assert.assertNotNull(message);
    assertTrue(message.indexOf("boom") > 0);
  }
 catch (  final IllegalStateException ex) {
    assertTrue(ex.getMessage().indexOf("boom") > 0);
  }
 finally {
    StackMessageLog.unLock();
  }
}

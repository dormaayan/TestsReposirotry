/** 
 * JIRA: DBCP-342, DBCP-93 Verify that when errors occur during BasicDataSource initialization, GenericObjectPool Evictors are cleaned up.
 */
@Test public void testCreateDataSourceCleanupEvictor() throws Exception {
  ds.close();
  ds=null;
  ds=createDataSource();
  ds.setDriverClassName("org.apache.commons.dbcp2.TesterConnRequestCountDriver");
  ds.setUrl("jdbc:apache:commons:testerConnRequestCountDriver");
  ds.setValidationQuery("SELECT DUMMY FROM DUAL");
  ds.setUsername("userName");
  ds.setPassword("wrong");
  ds.setTimeBetweenEvictionRunsMillis(100);
  ds.setMinIdle(2);
synchronized (TesterConnRequestCountDriver.class) {
    TesterConnRequestCountDriver.initConnRequestCount();
    for (int i=0; i < 10; i++) {
      try {
        @SuppressWarnings("unused") final DataSource ds2=ds.createDataSource();
      }
 catch (      final SQLException e) {
      }
    }
    Thread.sleep(1000);
    assertEquals(10,TesterConnRequestCountDriver.getConnectionRequestCount());
  }
  assertNull(ds.getConnectionPool());
}

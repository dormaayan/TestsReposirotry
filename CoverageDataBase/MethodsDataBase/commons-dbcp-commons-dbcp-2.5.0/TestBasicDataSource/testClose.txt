@Test public void testClose() throws Exception {
  ds.setAccessToUnderlyingConnectionAllowed(true);
  final Connection activeConnection=getConnection();
  final Connection rawActiveConnection=((DelegatingConnection<?>)activeConnection).getInnermostDelegate();
  assertFalse(activeConnection.isClosed());
  assertFalse(rawActiveConnection.isClosed());
  final Connection idleConnection=getConnection();
  final Connection rawIdleConnection=((DelegatingConnection<?>)idleConnection).getInnermostDelegate();
  assertFalse(idleConnection.isClosed());
  assertFalse(rawIdleConnection.isClosed());
  idleConnection.close();
  assertTrue(idleConnection.isClosed());
  assertFalse(rawIdleConnection.isClosed());
  ds.close();
  assertTrue(rawIdleConnection.isClosed());
  assertFalse(activeConnection.isClosed());
  assertFalse(rawActiveConnection.isClosed());
  activeConnection.close();
  assertTrue(activeConnection.isClosed());
  assertTrue(rawActiveConnection.isClosed());
  try {
    getConnection();
    fail("Expecting SQLException");
  }
 catch (  final SQLException ex) {
  }
  ds.close();
}

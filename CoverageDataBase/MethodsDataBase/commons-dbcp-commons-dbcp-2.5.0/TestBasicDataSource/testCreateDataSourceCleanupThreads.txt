/** 
 * JIRA DBCP-93: If an SQLException occurs after the GenericObjectPool is initialized in createDataSource, the evictor task is not cleaned up.
 */
@Test public void testCreateDataSourceCleanupThreads() throws Exception {
  ds.close();
  ds=null;
  ds=createDataSource();
  ds.setDriverClassName("org.apache.commons.dbcp2.TesterDriver");
  ds.setUrl("jdbc:apache:commons:testdriver");
  ds.setMaxTotal(getMaxTotal());
  ds.setMaxWaitMillis(getMaxWaitMillis());
  ds.setDefaultAutoCommit(Boolean.TRUE);
  ds.setDefaultReadOnly(Boolean.FALSE);
  ds.setDefaultTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);
  ds.setDefaultCatalog(CATALOG);
  ds.setUsername("userName");
  ds.setTimeBetweenEvictionRunsMillis(100);
  ds.setPassword("wrong");
  ds.setValidationQuery("SELECT DUMMY FROM DUAL");
  final int threadCount=Thread.activeCount();
  for (int i=0; i < 10; i++) {
    try (Connection c=ds.getConnection()){
    }
 catch (    final SQLException ex) {
    }
  }
  assertTrue(Thread.activeCount() <= threadCount + 1);
}

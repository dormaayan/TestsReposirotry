@Test public void testPooling() throws Exception {
  final Connection[] c=new Connection[getMaxTotal()];
  final Connection[] u=new Connection[getMaxTotal()];
  for (int i=0; i < c.length; i++) {
    c[i]=newConnection();
    if (c[i] instanceof DelegatingConnection) {
      u[i]=((DelegatingConnection<?>)c[i]).getInnermostDelegate();
    }
 else {
      for (int j=0; j <= i; j++) {
        c[j].close();
      }
      return;
    }
  }
  for (  final Connection element : c) {
    element.close();
    final Connection con=newConnection();
    final Connection underCon=((DelegatingConnection<?>)con).getInnermostDelegate();
    assertTrue("Failed to get connection",underCon != null);
    boolean found=false;
    for (int j=0; j < c.length; j++) {
      if (underCon == u[j]) {
        found=true;
        break;
      }
    }
    assertTrue("New connection not from pool",found);
    con.close();
  }
}

@Test public void testCloseInTransaction() throws Exception {
  final DelegatingConnection<?> connectionA=(DelegatingConnection<?>)newConnection();
  final DelegatingConnection<?> connectionB=(DelegatingConnection<?>)newConnection();
  assertFalse(connectionA.equals(connectionB));
  assertFalse(connectionB.equals(connectionA));
  assertTrue(connectionA.innermostDelegateEquals(connectionB.getInnermostDelegate()));
  assertTrue(connectionB.innermostDelegateEquals(connectionA.getInnermostDelegate()));
  connectionA.close();
  connectionB.close();
  final Connection connection=newConnection();
  assertFalse("Connection should be open",connection.isClosed());
  connection.close();
  assertTrue("Connection should be closed",connection.isClosed());
}

@Test public void testSharedTransactionConversion() throws Exception {
  final DelegatingConnection<?> connectionA=(DelegatingConnection<?>)newConnection();
  final DelegatingConnection<?> connectionB=(DelegatingConnection<?>)newConnection();
  assertFalse(connectionA.equals(connectionB));
  assertFalse(connectionB.equals(connectionA));
  assertTrue(connectionA.innermostDelegateEquals(connectionB.getInnermostDelegate()));
  assertTrue(connectionB.innermostDelegateEquals(connectionA.getInnermostDelegate()));
  transactionManager.commit();
  connectionA.getAutoCommit();
  connectionB.getAutoCommit();
  assertFalse(connectionA.equals(connectionB));
  assertFalse(connectionB.equals(connectionA));
  assertFalse(connectionA.innermostDelegateEquals(connectionB.getInnermostDelegate()));
  assertFalse(connectionB.innermostDelegateEquals(connectionA.getInnermostDelegate()));
  transactionManager.begin();
  connectionA.getAutoCommit();
  connectionB.getAutoCommit();
  assertFalse(connectionA.equals(connectionB));
  assertFalse(connectionB.equals(connectionA));
  assertTrue(connectionA.innermostDelegateEquals(connectionB.getInnermostDelegate()));
  assertTrue(connectionB.innermostDelegateEquals(connectionA.getInnermostDelegate()));
  connectionA.close();
  connectionB.close();
}

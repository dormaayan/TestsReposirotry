/** 
 * JIRA: DBCP-428
 */
@Test(expected=SQLException.class) public void testSetSharedConnectionEnlistFailure() throws Exception {
  final BasicManagedDataSource basicManagedDataSource=new BasicManagedDataSource();
  basicManagedDataSource.setTransactionManager(new TransactionManagerImpl());
  basicManagedDataSource.setDriverClassName("org.apache.commons.dbcp2.TesterDriver");
  basicManagedDataSource.setUrl("jdbc:apache:commons:testdriver");
  basicManagedDataSource.setUsername("userName");
  basicManagedDataSource.setPassword("password");
  basicManagedDataSource.setMaxIdle(1);
  final ManagedConnection<?> conn=(ManagedConnection<?>)basicManagedDataSource.getConnection();
  final UncooperativeTransaction transaction=new UncooperativeTransaction();
  final TransactionContext transactionContext=new TransactionContext(basicManagedDataSource.getTransactionRegistry(),transaction);
  transactionContext.setSharedConnection(conn);
  basicManagedDataSource.close();
}

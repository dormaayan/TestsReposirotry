/** 
 * Starting with a successful connection, then incorrect password, then correct password for same user illustrates JIRA: DBCP-245
 */
@Test public void testIncorrectPassword() throws Exception {
  ds.getConnection("u2","p2").close();
  try (Connection c=ds.getConnection("u1","zlsafjk")){
    fail("Able to retrieve connection with incorrect password");
  }
 catch (  final SQLException e1) {
  }
  ds.getConnection("u1","p1").close();
  try (Connection c=ds.getConnection("u1","x")){
    fail("Able to retrieve connection with incorrect password");
  }
 catch (  final SQLException e) {
    if (!e.getMessage().startsWith("Given password did not match")) {
      throw e;
    }
  }
  ds.getConnection("u1","p1").close();
  ds.getConnection("foo","bar").close();
  try (Connection c=ds.getConnection("u1","ar")){
    fail("Should have caused an SQLException");
  }
 catch (  final SQLException expected) {
  }
  try (Connection c=ds.getConnection("u1","baz")){
    fail("Should have generated SQLException");
  }
 catch (  final SQLException expected) {
  }
}

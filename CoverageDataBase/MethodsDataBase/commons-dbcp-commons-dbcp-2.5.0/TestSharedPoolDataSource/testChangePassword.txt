@Test public void testChangePassword() throws Exception {
  try (Connection c=ds.getConnection("foo","bay")){
    fail("Should have generated SQLException");
  }
 catch (  final SQLException expected) {
  }
  final Connection con1=ds.getConnection("foo","bar");
  final Connection con2=ds.getConnection("foo","bar");
  final Connection con3=ds.getConnection("foo","bar");
  con1.close();
  con2.close();
  TesterDriver.addUser("foo","bay");
  try (Connection con4=ds.getConnection("foo","bay")){
    assertEquals("Should be no idle connections in the pool",0,((SharedPoolDataSource)ds).getNumIdle());
    con4.close();
    assertEquals("Should be one idle connection in the pool",1,((SharedPoolDataSource)ds).getNumIdle());
    try (Connection con4b=ds.getConnection("foo","bar")){
      fail("Should have generated SQLException");
    }
 catch (    final SQLException expected) {
    }
    final Connection con5=ds.getConnection("foo","bay");
    con3.close();
    ds.getConnection("foo","bay").close();
    assertEquals("Should be one idle connection in the pool",1,((SharedPoolDataSource)ds).getNumIdle());
    con5.close();
  }
  finally {
    TesterDriver.addUser("foo","bar");
  }
}

@Test public void testMaxWaitMillis() throws Exception {
  final int maxWaitMillis=1000;
  final int theadCount=20;
  ((SharedPoolDataSource)ds).setDefaultMaxWaitMillis(maxWaitMillis);
  final Connection[] c=new Connection[getMaxTotal()];
  for (int i=0; i < c.length; i++) {
    c[i]=ds.getConnection("foo","bar");
    assertTrue(c[i] != null);
  }
  final long start=System.currentTimeMillis();
  final PoolTest[] pts=new PoolTest[theadCount];
  final ThreadGroup threadGroup=new ThreadGroup("testMaxWaitMillis");
  for (int i=0; i < pts.length; i++) {
    (pts[i]=new PoolTest(threadGroup,1,true)).start();
  }
  for (  final PoolTest poolTest : pts) {
    poolTest.getThread().join();
  }
  final long end=System.currentTimeMillis();
  System.out.println("testMaxWaitMillis took " + (end - start) + " ms. maxWaitMillis: "+ maxWaitMillis);
  assertTrue(end - start < 2 * maxWaitMillis);
  for (  final Connection element : c) {
    element.close();
  }
}

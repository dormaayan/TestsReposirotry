@Test public void testBatchUpdate() throws Exception {
  DriverManager.registerDriver(new TesterDriver());
  final ConnectionFactory connFactory=new DriverManagerConnectionFactory("jdbc:apache:commons:testdriver","u1","p1");
  final PoolableConnectionFactory pcf=new PoolableConnectionFactory(connFactory,null);
  pcf.setPoolStatements(true);
  pcf.setDefaultReadOnly(Boolean.FALSE);
  pcf.setDefaultAutoCommit(Boolean.TRUE);
  final ObjectPool<PoolableConnection> connPool=new GenericObjectPool<>(pcf);
  pcf.setPool(connPool);
  final PoolingDataSource<?> ds=new PoolingDataSource<>(connPool);
  final Connection conn=ds.getConnection();
  final PreparedStatement ps=conn.prepareStatement("select 1 from dual");
  final Statement inner=((DelegatingPreparedStatement)ps).getInnermostDelegate();
  ps.addBatch();
  ps.close();
  conn.close();
  Assert.assertFalse(inner.isClosed());
  ds.close();
}

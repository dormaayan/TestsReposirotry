@Test public void batchForEachEntry_chains(){
  BatchIterable<Map.Entry<Integer,Integer>> collisions=(BatchIterable<Map.Entry<Integer,Integer>>)UnifiedMap.<Integer,Integer>newMap(5).withKeysValues(COLLISION_1,1,COLLISION_2,2,COLLISION_3,3,1,4).withKeysValues(2,5,3,6).entrySet();
  Sum sum2=new IntegerSum(0);
  int numBatches=collisions.getBatchCount(100000);
  for (int i=0; i < numBatches; ++i) {
    collisions.batchForEach(new EntrySumProcedure(sum2),i,numBatches);
  }
  Assert.assertEquals(1,numBatches);
  Assert.assertEquals(78,sum2.getValue());
  Sum sum3=new IntegerSum(0);
  for (int i=0; i < 5; ++i) {
    collisions.batchForEach(new EntrySumProcedure(sum3),i,5);
  }
  Assert.assertEquals(78,sum3.getValue());
}

/** 
 * Start any processes in a loop to make sure that we do not leave any handles/resources open.
 * @throws Exception the test failed
 */
@Test @Ignore public void _testExecuteStability() throws Exception {
  for (int i=0; i < 100; i++) {
    final Map<String,String> env=new HashMap<String,String>();
    env.put("TEST_ENV_VAR",Integer.toString(i));
    final CommandLine cl=new CommandLine(testScript);
    final int exitValue=exec.execute(cl,env);
    assertFalse(exec.isFailure(exitValue));
    assertEquals("FOO." + i + ".",baos.toString().trim());
    baos.reset();
  }
  for (int i=0; i < 100; i++) {
    final Map<String,String> env=new HashMap<String,String>();
    env.put("TEST_ENV_VAR",Integer.toString(i));
    final DefaultExecuteResultHandler resultHandler=new DefaultExecuteResultHandler();
    final CommandLine cl=new CommandLine(foreverTestScript);
    final ExecuteWatchdog watchdog=new ExecuteWatchdog(500);
    exec.setWatchdog(watchdog);
    exec.execute(cl,env,resultHandler);
    resultHandler.waitFor(WAITFOR_TIMEOUT);
    assertTrue("ResultHandler received a result",resultHandler.hasResult());
    assertNotNull(resultHandler.getException());
    baos.reset();
  }
}

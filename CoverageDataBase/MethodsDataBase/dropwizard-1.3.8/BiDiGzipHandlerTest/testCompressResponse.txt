@Test public void testCompressResponse() throws Exception {
  request.setMethod("GET");
  request.setHeader(HttpHeaders.ACCEPT_ENCODING,"gzip");
  HttpTester.Response response=HttpTester.parseResponse(servletTester.getResponses(request.generate()));
  assertThat(response.getStatus()).isEqualTo(200);
  assertThat(response.get(HttpHeader.CONTENT_ENCODING)).isEqualTo("gzip");
  assertThat(response.get(HttpHeader.VARY)).isEqualTo(HttpHeaders.ACCEPT_ENCODING);
  assertThat(response.get(HttpHeader.CONTENT_TYPE)).isEqualToIgnoringCase(PLAIN_TEXT_UTF_8);
  try (GZIPInputStream is=new GZIPInputStream(new ByteArrayInputStream(response.getContentBytes()))){
    assertThat(ByteStreams.toByteArray(is)).isEqualTo(Resources.toByteArray(Resources.getResource("assets/banner.txt")));
  }
 }

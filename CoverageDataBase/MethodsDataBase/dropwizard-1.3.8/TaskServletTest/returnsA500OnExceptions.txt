@Test @SuppressWarnings("unchecked") public void returnsA500OnExceptions() throws Exception {
  when(request.getMethod()).thenReturn("POST");
  when(request.getPathInfo()).thenReturn("/gc");
  when(request.getParameterNames()).thenReturn(Collections.enumeration(ImmutableList.of()));
  final PrintWriter output=mock(PrintWriter.class);
  when(response.getWriter()).thenReturn(output);
  final RuntimeException ex=new RuntimeException("whoops");
  doThrow(ex).when(gc).execute(any(ImmutableMultimap.class),any(PrintWriter.class));
  servlet.service(request,response);
  verify(response).setStatus(500);
}

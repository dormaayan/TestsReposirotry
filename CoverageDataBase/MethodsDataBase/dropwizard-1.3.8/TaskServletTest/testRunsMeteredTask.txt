@Test public void testRunsMeteredTask() throws Exception {
  final Task meteredTask=new Task("metered-task"){
    @Override @Metered(name="vacuum-cleaning") public void execute(    ImmutableMultimap<String,String> parameters,    PrintWriter output) throws Exception {
      output.println("Vacuum cleaning");
    }
  }
;
  servlet.add(meteredTask);
  when(request.getMethod()).thenReturn("POST");
  when(request.getPathInfo()).thenReturn("/metered-task");
  when(response.getWriter()).thenReturn(mock(PrintWriter.class));
  servlet.service(request,response);
  assertThat(metricRegistry.getMeters()).containsKey(name(meteredTask.getClass(),"vacuum-cleaning"));
}

@Test public void testRunsExceptionMeteredTask() throws Exception {
  final Task exceptionMeteredTask=new Task("exception-metered-task"){
    @Override @ExceptionMetered(name="vacuum-cleaning-exceptions") public void execute(    ImmutableMultimap<String,String> parameters,    PrintWriter output) throws Exception {
      throw new RuntimeException("The engine has died");
    }
  }
;
  servlet.add(exceptionMeteredTask);
  when(request.getMethod()).thenReturn("POST");
  when(request.getPathInfo()).thenReturn("/exception-metered-task");
  when(response.getWriter()).thenReturn(mock(PrintWriter.class));
  servlet.service(request,response);
  assertThat(metricRegistry.getMeters()).containsKey(name(exceptionMeteredTask.getClass(),"vacuum-cleaning-exceptions"));
}

@Test public void testConsumeInputConnectionClosed() throws Exception {
  conn=new DefaultNHttpServerConnection(session,1024);
  final ReadableByteChannelMock rchannel=Mockito.spy(new ReadableByteChannelMock(new String[]{"",""},Consts.ASCII));
  final ByteChannelMock channel=new ByteChannelMock(rchannel,null);
  Mockito.when(session.channel()).thenReturn(channel);
  Mockito.when(session.getEventMask()).thenReturn(SelectionKey.OP_READ);
  conn.close();
  conn.consumeInput(handler);
  Mockito.verify(rchannel,Mockito.never()).read(Matchers.<ByteBuffer>any());
  Mockito.verify(session,Mockito.times(1)).clearEvent(SelectionKey.OP_READ);
}

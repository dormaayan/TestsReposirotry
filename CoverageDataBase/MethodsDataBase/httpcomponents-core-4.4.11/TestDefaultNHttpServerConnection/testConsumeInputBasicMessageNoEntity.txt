@Test public void testConsumeInputBasicMessageNoEntity() throws Exception {
  final ReadableByteChannelMock rchannel=Mockito.spy(new ReadableByteChannelMock(new String[]{"GET / HTTP/1.1\r\n\r\n"},Consts.ASCII));
  final ByteChannelMock channel=new ByteChannelMock(rchannel,null);
  Mockito.when(session.channel()).thenReturn(channel);
  Mockito.when(session.getEventMask()).thenReturn(SelectionKey.OP_READ);
  final LinkedList<HttpRequest> requests=new LinkedList<HttpRequest>();
  Mockito.doAnswer(new RequestCapturingAnswer(requests)).when(handler).requestReceived(Matchers.<NHttpServerConnection>any());
  Mockito.doAnswer(new ConsumeContentAnswer(new SimpleInputBuffer(64))).when(handler).inputReady(Matchers.<NHttpServerConnection>any(),Matchers.<ContentDecoder>any());
  conn.consumeInput(handler);
  Assert.assertNull(conn.getHttpResponse());
  Assert.assertNull(conn.contentDecoder);
  Mockito.verify(handler,Mockito.times(1)).requestReceived(Matchers.<NHttpServerConnection>any());
  Mockito.verify(handler,Mockito.never()).inputReady(Matchers.<NHttpServerConnection>any(),Matchers.<LengthDelimitedDecoder>any());
  Mockito.verify(rchannel,Mockito.times(1)).read(Matchers.<ByteBuffer>any());
  Mockito.verify(handler,Mockito.never()).exception(Matchers.<NHttpServerConnection>any(),Matchers.<Exception>any());
  Assert.assertFalse(requests.isEmpty());
  final HttpRequest request=requests.getFirst();
  Assert.assertNotNull(request);
  Assert.assertEquals(HttpVersion.HTTP_1_1,request.getRequestLine().getProtocolVersion());
  Assert.assertEquals("GET",request.getRequestLine().getMethod());
  Assert.assertEquals("/",request.getRequestLine().getUri());
  Assert.assertFalse(request instanceof HttpEntityEnclosingRequest);
}

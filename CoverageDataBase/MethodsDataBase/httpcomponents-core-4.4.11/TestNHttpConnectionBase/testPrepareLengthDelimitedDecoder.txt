@Test public void testPrepareLengthDelimitedDecoder() throws Exception {
  final BasicHttpResponse response=new BasicHttpResponse(HttpVersion.HTTP_1_1,200,"OK");
  response.addHeader(HTTP.CONTENT_LEN,"10");
  response.addHeader(HTTP.CONTENT_TYPE,"stuff");
  response.addHeader(HTTP.CONTENT_ENCODING,"identity");
  Mockito.when(session.channel()).thenReturn(channel);
  final HttpEntity entity=conn.prepareDecoder(response);
  Assert.assertNotNull(entity);
  Assert.assertEquals(10,entity.getContentLength());
  Assert.assertFalse(entity.isChunked());
  Assert.assertNotNull(entity.getContentType());
  Assert.assertEquals("stuff",entity.getContentType().getValue());
  Assert.assertNotNull(entity.getContentEncoding());
  Assert.assertEquals("identity",entity.getContentEncoding().getValue());
  Assert.assertTrue(conn.contentDecoder instanceof LengthDelimitedDecoder);
}

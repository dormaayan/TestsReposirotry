@Test public void testPrepareChunkDecoder() throws Exception {
  final BasicHttpResponse response=new BasicHttpResponse(HttpVersion.HTTP_1_1,200,"OK");
  response.addHeader(HTTP.TRANSFER_ENCODING,"chunked");
  response.addHeader(HTTP.CONTENT_TYPE,"stuff");
  response.addHeader(HTTP.CONTENT_ENCODING,"identity");
  Mockito.when(session.channel()).thenReturn(channel);
  final HttpEntity entity=conn.prepareDecoder(response);
  Assert.assertNotNull(entity);
  Assert.assertEquals(-1,entity.getContentLength());
  Assert.assertTrue(entity.isChunked());
  Assert.assertNotNull(entity.getContentType());
  Assert.assertEquals("stuff",entity.getContentType().getValue());
  Assert.assertNotNull(entity.getContentEncoding());
  Assert.assertEquals("identity",entity.getContentEncoding().getValue());
  Assert.assertTrue(conn.contentDecoder instanceof ChunkDecoder);
}

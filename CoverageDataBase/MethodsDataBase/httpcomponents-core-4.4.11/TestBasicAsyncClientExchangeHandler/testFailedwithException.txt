@Test public void testFailedwithException() throws Exception {
  final Exception ooopsie=new Exception();
  Mockito.doThrow(new RuntimeException()).when(this.responseConsumer).failed(ooopsie);
  try {
    this.exchangeHandler.failed(ooopsie);
    Assert.fail("RuntimeException expected");
  }
 catch (  final RuntimeException ex) {
    Mockito.verify(this.requestProducer).close();
    Mockito.verify(this.responseConsumer).close();
    try {
      this.exchangeHandler.getFuture().get();
    }
 catch (    final ExecutionException exex) {
      Assert.assertSame(ooopsie,exex.getCause());
    }
  }
}

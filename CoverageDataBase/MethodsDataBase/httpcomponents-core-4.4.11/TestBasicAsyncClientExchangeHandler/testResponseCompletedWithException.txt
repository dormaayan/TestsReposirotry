@Test public void testResponseCompletedWithException() throws Exception {
  Mockito.doThrow(new RuntimeException()).when(this.responseConsumer).responseCompleted(this.context);
  try {
    this.exchangeHandler.responseCompleted();
    Assert.fail("RuntimeException expected");
  }
 catch (  final RuntimeException ex) {
    Mockito.verify(this.requestProducer).close();
    Mockito.verify(this.responseConsumer).close();
    try {
      this.exchangeHandler.getFuture().get();
      Assert.fail("ExecutionException expected");
    }
 catch (    final ExecutionException exex) {
    }
  }
}

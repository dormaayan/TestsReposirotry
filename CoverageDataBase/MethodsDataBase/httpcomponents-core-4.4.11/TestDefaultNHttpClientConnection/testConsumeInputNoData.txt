@Test public void testConsumeInputNoData() throws Exception {
  conn=new DefaultNHttpClientConnection(session,1024);
  final ReadableByteChannelMock rchannel=Mockito.spy(new ReadableByteChannelMock(new String[]{"",""},Consts.ASCII));
  final ByteChannelMock channel=new ByteChannelMock(rchannel,null);
  Mockito.when(session.channel()).thenReturn(channel);
  Mockito.when(session.getEventMask()).thenReturn(SelectionKey.OP_READ);
  final LinkedList<HttpResponse> responses=new LinkedList<HttpResponse>();
  Mockito.doAnswer(new ResponseCapturingAnswer(responses)).when(handler).responseReceived(Matchers.<NHttpClientConnection>any());
  Mockito.doAnswer(new ConsumeContentAnswer(new SimpleInputBuffer(64))).when(handler).inputReady(Matchers.<NHttpClientConnection>any(),Matchers.<ContentDecoder>any());
  Assert.assertEquals(0,conn.getMetrics().getResponseCount());
  conn.consumeInput(handler);
  Assert.assertNull(conn.getHttpResponse());
  Assert.assertNull(conn.contentDecoder);
  Assert.assertEquals(0,conn.getMetrics().getResponseCount());
  Assert.assertEquals(0,conn.getMetrics().getReceivedBytesCount());
  Mockito.verify(handler,Mockito.never()).responseReceived(Matchers.<NHttpClientConnection>any());
  Mockito.verify(handler,Mockito.never()).inputReady(Matchers.<NHttpClientConnection>any(),Matchers.<LengthDelimitedDecoder>any());
  Mockito.verify(rchannel,Mockito.times(1)).read(Matchers.<ByteBuffer>any());
  Mockito.verify(handler,Mockito.never()).exception(Matchers.<NHttpClientConnection>any(),Matchers.<Exception>any());
  conn.consumeInput(handler);
  Assert.assertNull(conn.getHttpResponse());
  Assert.assertNull(conn.contentDecoder);
  Assert.assertEquals(0,conn.getMetrics().getResponseCount());
  Assert.assertEquals(0,conn.getMetrics().getReceivedBytesCount());
  Mockito.verify(handler,Mockito.never()).responseReceived(Matchers.<NHttpClientConnection>any());
  Mockito.verify(handler,Mockito.never()).inputReady(Matchers.<NHttpClientConnection>any(),Matchers.<LengthDelimitedDecoder>any());
  Mockito.verify(rchannel,Mockito.times(2)).read(Matchers.<ByteBuffer>any());
  Mockito.verify(handler,Mockito.never()).exception(Matchers.<NHttpClientConnection>any(),Matchers.<Exception>any());
  conn.consumeInput(handler);
  Assert.assertNull(conn.getHttpResponse());
  Assert.assertNull(conn.contentDecoder);
  Assert.assertEquals(0,conn.getMetrics().getResponseCount());
  Assert.assertEquals(0,conn.getMetrics().getReceivedBytesCount());
  Mockito.verify(handler,Mockito.never()).responseReceived(Matchers.<NHttpClientConnection>any());
  Mockito.verify(handler,Mockito.never()).inputReady(Matchers.<NHttpClientConnection>any(),Matchers.<LengthDelimitedDecoder>any());
  Mockito.verify(rchannel,Mockito.times(3)).read(Matchers.<ByteBuffer>any());
  Mockito.verify(handler,Mockito.times(1)).endOfInput(Matchers.<NHttpClientConnection>any());
  Mockito.verify(handler,Mockito.never()).exception(Matchers.<NHttpClientConnection>any(),Matchers.<Exception>any());
}

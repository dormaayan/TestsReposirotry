@Test public void testIOExceptionHandling() throws Exception {
  final State state=new HttpAsyncRequestExecutor.State();
  state.setRequestState(MessageState.COMPLETED);
  state.setResponseState(MessageState.COMPLETED);
  this.connContext.setAttribute(HttpAsyncRequestExecutor.HTTP_EXCHANGE_STATE,state);
  this.connContext.setAttribute(HttpAsyncRequestExecutor.HTTP_HANDLER,this.exchangeHandler);
  final IOException ioex=new IOException();
  this.protocolHandler.exception(this.conn,ioex);
  Mockito.verify(this.exchangeHandler).failed(ioex);
  Mockito.verify(this.conn).shutdown();
}

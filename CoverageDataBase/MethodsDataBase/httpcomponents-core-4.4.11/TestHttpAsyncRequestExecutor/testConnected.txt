@Test public void testConnected() throws Exception {
  final HttpRequest request=new BasicHttpRequest("GET","/");
  Mockito.when(this.exchangeHandler.generateRequest()).thenReturn(request);
  this.connContext.setAttribute(HttpAsyncRequestExecutor.HTTP_HANDLER,this.exchangeHandler);
  this.protocolHandler.connected(this.conn,null);
  final State state=(State)this.connContext.getAttribute(HttpAsyncRequestExecutor.HTTP_EXCHANGE_STATE);
  Assert.assertNotNull(state);
  Mockito.verify(this.exchangeHandler).generateRequest();
  Assert.assertSame(request,state.getRequest());
  Mockito.verify(this.conn).submitRequest(request);
  Mockito.verify(this.exchangeHandler).requestCompleted();
  Assert.assertEquals(MessageState.COMPLETED,state.getRequestState());
  Assert.assertEquals("request state: COMPLETED; request: GET / HTTP/1.1; " + "response state: READY; response: ; valid: true;",state.toString());
}

@Test public void testEndpointAlreadyBoundFatal() throws Exception {
  final IOEventDispatch eventDispatch=createIOEventDispatch();
  final IOReactorConfig config=IOReactorConfig.custom().setIoThreadCount(1).build();
  final ListeningIOReactor ioReactor=new DefaultListeningIOReactor(config);
  final CountDownLatch latch=new CountDownLatch(1);
  final Thread t=new Thread(new Runnable(){
    @Override public void run(){
      try {
        ioReactor.execute(eventDispatch);
        Assert.fail("IOException should have been thrown");
      }
 catch (      final IOException ex) {
        latch.countDown();
      }
    }
  }
);
  t.start();
  final ListenerEndpoint endpoint1=ioReactor.listen(new InetSocketAddress(0));
  endpoint1.waitFor();
  final int port=((InetSocketAddress)endpoint1.getAddress()).getPort();
  final ListenerEndpoint endpoint2=ioReactor.listen(new InetSocketAddress(port));
  endpoint2.waitFor();
  Assert.assertNotNull(endpoint2.getException());
  latch.await(2000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(ioReactor.getStatus().compareTo(IOReactorStatus.SHUTTING_DOWN) >= 0);
  final Set<ListenerEndpoint> endpoints=ioReactor.getEndpoints();
  Assert.assertNotNull(endpoints);
  Assert.assertEquals(0,endpoints.size());
  ioReactor.shutdown(1000);
  t.join(1000);
  Assert.assertEquals(IOReactorStatus.SHUT_DOWN,ioReactor.getStatus());
}

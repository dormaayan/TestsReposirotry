@Test public void testShutdown() throws Exception {
  final LocalRoutePool pool=new LocalRoutePool();
  final IOSession session1=Mockito.mock(IOSession.class);
  final SessionRequest sessionRequest1=Mockito.mock(SessionRequest.class);
  Mockito.when(sessionRequest1.getSession()).thenReturn(session1);
  final BasicFuture<LocalPoolEntry> future1=new BasicFuture<LocalPoolEntry>(null);
  pool.addPending(sessionRequest1,future1);
  final IOSession session2=Mockito.mock(IOSession.class);
  final SessionRequest sessionRequest2=Mockito.mock(SessionRequest.class);
  Mockito.when(sessionRequest2.getSession()).thenReturn(session2);
  final BasicFuture<LocalPoolEntry> future2=new BasicFuture<LocalPoolEntry>(null);
  pool.addPending(sessionRequest2,future2);
  final IOSession session3=Mockito.mock(IOSession.class);
  final SessionRequest sessionRequest3=Mockito.mock(SessionRequest.class);
  Mockito.when(sessionRequest3.getSession()).thenReturn(session3);
  final BasicFuture<LocalPoolEntry> future3=new BasicFuture<LocalPoolEntry>(null);
  pool.addPending(sessionRequest3,future3);
  final LocalPoolEntry entry1=pool.createEntry(sessionRequest1,session1);
  pool.completed(sessionRequest1,entry1);
  Assert.assertNotNull(entry1);
  final LocalPoolEntry entry2=pool.createEntry(sessionRequest2,session2);
  pool.completed(sessionRequest2,entry2);
  Assert.assertNotNull(entry2);
  pool.free(entry1,true);
  Assert.assertEquals(3,pool.getAllocatedCount());
  Assert.assertEquals(1,pool.getAvailableCount());
  Assert.assertEquals(1,pool.getLeasedCount());
  Assert.assertEquals(1,pool.getPendingCount());
  pool.shutdown();
  Assert.assertEquals(0,pool.getAllocatedCount());
  Assert.assertEquals(0,pool.getAvailableCount());
  Assert.assertEquals(0,pool.getLeasedCount());
  Assert.assertEquals(0,pool.getPendingCount());
  Mockito.verify(sessionRequest3).cancel();
  Mockito.verify(session2).close();
  Mockito.verify(session1).close();
}

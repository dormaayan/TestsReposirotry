@Test public void testRequestProcessing() throws Exception {
  when(request.getEntity()).thenReturn(new StringEntity("stuff"));
  consumer.requestReceived(request);
  consumer.consumeContent(decoder,ioControl);
  consumer.requestCompleted(context);
  verify(consumer).releaseResources();
  verify(consumer).buildResult(context);
  Assert.assertTrue(consumer.isDone());
  Assert.assertSame(request,consumer.getResult());
  consumer.requestCompleted(context);
  verify(consumer,times(1)).releaseResources();
  verify(consumer,times(1)).buildResult(context);
}

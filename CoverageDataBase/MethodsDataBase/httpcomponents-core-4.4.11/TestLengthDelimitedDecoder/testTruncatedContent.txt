@Test(expected=ConnectionClosedException.class) public void testTruncatedContent() throws Exception {
  final ReadableByteChannel channel=new ReadableByteChannelMock(new String[]{"1234567890"},Consts.ASCII);
  final SessionInputBuffer inbuf=new SessionInputBufferImpl(1024,256,Consts.ASCII);
  final HttpTransportMetricsImpl metrics=new HttpTransportMetricsImpl();
  final LengthDelimitedDecoder decoder=new LengthDelimitedDecoder(channel,inbuf,metrics,20);
  final ByteBuffer dst=ByteBuffer.allocate(1024);
  final int bytesRead=decoder.read(dst);
  Assert.assertEquals(10,bytesRead);
  decoder.read(dst);
}

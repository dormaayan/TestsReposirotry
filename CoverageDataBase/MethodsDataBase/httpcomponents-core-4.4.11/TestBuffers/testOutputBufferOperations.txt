@Test public void testOutputBufferOperations() throws IOException {
  final ByteArrayOutputStream outStream=new ByteArrayOutputStream();
  final WritableByteChannel channel=Channels.newChannel(outStream);
  final SessionOutputBuffer outbuf=new SessionOutputBufferImpl(1024,128,Consts.ASCII);
  final HttpTransportMetricsImpl metrics=new HttpTransportMetricsImpl();
  final ContentEncoder encoder=new ContentEncoderMock(channel,outbuf,metrics);
  final SimpleOutputBuffer buffer=new SimpleOutputBuffer(4,DirectByteBufferAllocator.INSTANCE);
  buffer.write(EncodingUtils.getAsciiBytes("stuff"));
  buffer.write(';');
  buffer.produceContent(encoder);
  buffer.write(EncodingUtils.getAsciiBytes("more "));
  buffer.write(EncodingUtils.getAsciiBytes("stuff"));
  buffer.produceContent(encoder);
  final byte[] content=outStream.toByteArray();
  Assert.assertEquals("stuff;more stuff",EncodingUtils.getAsciiString(content));
}

@Test public void testReadRequestEntity() throws Exception {
  final String s="HTTP/1.1 200 OK\r\nUser-Agent: test\r\nContent-Length: 3\r\n\r\n123";
  final ByteArrayInputStream inStream=new ByteArrayInputStream(s.getBytes(Consts.ASCII));
  Mockito.when(socket.getInputStream()).thenReturn(inStream);
  conn.bind(socket);
  Assert.assertEquals(0,conn.getMetrics().getResponseCount());
  final HttpResponse response=conn.receiveResponseHeader();
  Assert.assertNotNull(response);
  Assert.assertEquals(HttpVersion.HTTP_1_1,response.getProtocolVersion());
  Assert.assertEquals(200,response.getStatusLine().getStatusCode());
  Assert.assertTrue(response.containsHeader("User-Agent"));
  Assert.assertEquals(1,conn.getMetrics().getResponseCount());
  conn.receiveResponseEntity(response);
  final HttpEntity entity=response.getEntity();
  Assert.assertNotNull(entity);
  Assert.assertEquals(3,entity.getContentLength());
  Assert.assertEquals(1,conn.getMetrics().getResponseCount());
}

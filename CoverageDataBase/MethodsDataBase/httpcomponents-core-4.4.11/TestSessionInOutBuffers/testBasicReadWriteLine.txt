@Test public void testBasicReadWriteLine() throws Exception {
  final String[] teststrs=new String[5];
  teststrs[0]="Hello";
  teststrs[1]="This string should be much longer than the size of the line buffer " + "which is only 16 bytes for this test";
  final StringBuilder buffer=new StringBuilder();
  for (int i=0; i < 15; i++) {
    buffer.append("123456789 ");
  }
  buffer.append("and stuff like that");
  teststrs[2]=buffer.toString();
  teststrs[3]="";
  teststrs[4]="And goodbye";
  final SessionOutputBuffer outbuf=new SessionOutputBufferImpl(1024,16,null,this.allocator);
  for (  final String teststr : teststrs) {
    outbuf.writeLine(teststr);
  }
  outbuf.writeLine((String)null);
  outbuf.writeLine((CharArrayBuffer)null);
  final ByteArrayOutputStream outStream=new ByteArrayOutputStream();
  final WritableByteChannel outChannel=newChannel(outStream);
  outbuf.flush(outChannel);
  final ReadableByteChannel channel=newChannel(outStream.toByteArray());
  final SessionInputBuffer inbuf=new SessionInputBufferImpl(1024,16,null,this.allocator);
  inbuf.fill(channel);
  for (  final String teststr : teststrs) {
    Assert.assertEquals(teststr,inbuf.readLine(true));
  }
  Assert.assertNull(inbuf.readLine(true));
  Assert.assertNull(inbuf.readLine(true));
}

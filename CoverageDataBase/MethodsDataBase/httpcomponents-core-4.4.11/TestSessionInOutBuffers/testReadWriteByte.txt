@Test public void testReadWriteByte() throws Exception {
  final byte[] out=new byte[40];
  for (int i=0; i < out.length; i++) {
    out[i]=(byte)(120 + i);
  }
  final SessionOutputBufferMock outbuffer=new SessionOutputBufferMock();
  for (  final byte element : out) {
    outbuffer.write(element);
  }
  outbuffer.flush();
  final long bytesWritten=outbuffer.getMetrics().getBytesTransferred();
  Assert.assertEquals(out.length,bytesWritten);
  final byte[] tmp=outbuffer.getData();
  Assert.assertEquals(out.length,tmp.length);
  for (int i=0; i < out.length; i++) {
    Assert.assertEquals(out[i],tmp[i]);
  }
  final SessionInputBufferMock inBuffer=new SessionInputBufferMock(tmp);
  final byte[] in=new byte[40];
  for (int i=0; i < in.length; i++) {
    in[i]=(byte)inBuffer.read();
  }
  for (int i=0; i < out.length; i++) {
    Assert.assertEquals(out[i],in[i]);
  }
  Assert.assertEquals(-1,inBuffer.read());
  Assert.assertEquals(-1,inBuffer.read());
  final long bytesRead=inBuffer.getMetrics().getBytesTransferred();
  Assert.assertEquals(out.length,bytesRead);
}

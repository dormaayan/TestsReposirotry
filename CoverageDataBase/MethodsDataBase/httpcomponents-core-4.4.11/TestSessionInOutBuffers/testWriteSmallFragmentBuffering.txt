@Test public void testWriteSmallFragmentBuffering() throws Exception {
  final ByteArrayOutputStream outStream=Mockito.spy(new ByteArrayOutputStream());
  final SessionOutputBufferMock outbuffer=new SessionOutputBufferMock(outStream,16,16,null);
  outbuffer.write(1);
  outbuffer.write(2);
  outbuffer.write(new byte[]{1,2});
  outbuffer.write(new byte[]{3,4});
  outbuffer.flush();
  Mockito.verify(outStream,Mockito.times(1)).write(Matchers.<byte[]>any(),Matchers.anyInt(),Matchers.anyInt());
  Mockito.verify(outStream,Mockito.never()).write(Matchers.anyInt());
}

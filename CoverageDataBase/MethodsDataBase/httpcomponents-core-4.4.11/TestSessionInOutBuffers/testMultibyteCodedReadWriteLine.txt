@Test public void testMultibyteCodedReadWriteLine() throws Exception {
  final String s1=constructString(SWISS_GERMAN_HELLO);
  final String s2=constructString(RUSSIAN_HELLO);
  final String s3="Like hello and stuff";
  final SessionOutputBuffer outbuf=new SessionOutputBufferImpl(1024,16,Consts.UTF_8.newEncoder(),this.allocator);
  for (int i=0; i < 10; i++) {
    outbuf.writeLine(s1);
    outbuf.writeLine(s2);
    outbuf.writeLine(s3);
  }
  final ByteArrayOutputStream outStream=new ByteArrayOutputStream();
  final WritableByteChannel outChannel=newChannel(outStream);
  outbuf.flush(outChannel);
  final byte[] tmp=outStream.toByteArray();
  final ReadableByteChannel channel=newChannel(tmp);
  final SessionInputBuffer inbuf=new SessionInputBufferImpl(16,16,Consts.UTF_8.newDecoder(),this.allocator);
  while (inbuf.fill(channel) > 0) {
  }
  for (int i=0; i < 10; i++) {
    Assert.assertEquals(s1,inbuf.readLine(true));
    Assert.assertEquals(s2,inbuf.readLine(true));
    Assert.assertEquals(s3,inbuf.readLine(true));
  }
}

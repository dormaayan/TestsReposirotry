@Test public void parseAndHtmlOnDifferentThreads() throws InterruptedException {
  String html="<p>Alrighty then it's not \uD83D\uDCA9. <span>Next</span></p>";
  String asci="<p>Alrighty then it's not &#x1f4a9;. <span>Next</span></p>";
  final Document doc=Jsoup.parse(html);
  final String[] out=new String[1];
  final Elements p=doc.select("p");
  assertEquals(html,p.outerHtml());
  Thread thread=new Thread(new Runnable(){
    @Override public void run(){
      out[0]=p.outerHtml();
      doc.outputSettings().charset(StandardCharsets.US_ASCII);
    }
  }
);
  thread.start();
  thread.join();
  assertEquals(html,out[0]);
  assertEquals(StandardCharsets.US_ASCII,doc.outputSettings().charset());
  assertEquals(asci,p.outerHtml());
}

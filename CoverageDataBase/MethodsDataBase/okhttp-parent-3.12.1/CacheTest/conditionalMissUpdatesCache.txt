/** 
 * Test https://github.com/square/okhttp/issues/1712. 
 */
@Test public void conditionalMissUpdatesCache() throws Exception {
  server.enqueue(new MockResponse().addHeader("ETag: v1").setBody("A"));
  server.enqueue(new MockResponse().setResponseCode(HttpURLConnection.HTTP_NOT_MODIFIED));
  server.enqueue(new MockResponse().addHeader("ETag: v2").setBody("B"));
  server.enqueue(new MockResponse().setResponseCode(HttpURLConnection.HTTP_NOT_MODIFIED));
  HttpUrl url=server.url("/");
  assertEquals("A",get(url).body().string());
  assertEquals("A",get(url).body().string());
  assertEquals("B",get(url).body().string());
  assertEquals("B",get(url).body().string());
  assertEquals(null,server.takeRequest().getHeader("If-None-Match"));
  assertEquals("v1",server.takeRequest().getHeader("If-None-Match"));
  assertEquals("v1",server.takeRequest().getHeader("If-None-Match"));
  assertEquals("v2",server.takeRequest().getHeader("If-None-Match"));
}

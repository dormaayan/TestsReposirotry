/** 
 * Don't explode if the cache returns a null body. http://b/3373699 
 */
@Test public void responseCacheReturnsNullOutputStream() throws Exception {
  final AtomicBoolean aborted=new AtomicBoolean();
  setInternalCache(new CacheAdapter(new AbstractResponseCache(){
    @Override public CacheRequest put(    URI uri,    URLConnection connection){
      return new CacheRequest(){
        @Override public void abort(){
          aborted.set(true);
        }
        @Override public OutputStream getBody(){
          return null;
        }
      }
;
    }
  }
));
  server.enqueue(new MockResponse().setBody("abcdef"));
  HttpURLConnection connection=openConnection(server.url("/").url());
  assertEquals("abc",readAscii(connection,3));
  connection.getInputStream().close();
  assertFalse(aborted.get());
}

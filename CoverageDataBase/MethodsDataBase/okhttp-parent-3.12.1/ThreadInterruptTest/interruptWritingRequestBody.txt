@Test public void interruptWritingRequestBody() throws Exception {
  int requestBodySize=2 * 1024 * 1024;
  server.enqueue(new MockResponse().throttleBody(64 * 1024,125,TimeUnit.MILLISECONDS));
  server.start();
  interruptLater(500);
  HttpURLConnection connection=new OkUrlFactory(client).open(server.url("/").url());
  connection.setDoOutput(true);
  connection.setFixedLengthStreamingMode(requestBodySize);
  OutputStream requestBody=connection.getOutputStream();
  byte[] buffer=new byte[1024];
  try {
    for (int i=0; i < requestBodySize; i+=buffer.length) {
      requestBody.write(buffer);
      requestBody.flush();
    }
    fail("Expected thread to be interrupted");
  }
 catch (  InterruptedIOException expected) {
    assertTrue(Thread.interrupted());
  }
  connection.disconnect();
}

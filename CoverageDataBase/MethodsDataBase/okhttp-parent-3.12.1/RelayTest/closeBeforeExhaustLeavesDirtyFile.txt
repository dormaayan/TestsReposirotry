@Test public void closeBeforeExhaustLeavesDirtyFile() throws Exception {
  Buffer upstream=new Buffer();
  upstream.writeUtf8("abcdefghij");
  Relay relay1=Relay.edit(file,upstream,metadata,5);
  BufferedSource source1=Okio.buffer(relay1.newSource());
  assertEquals("abcdefghij",source1.readUtf8(10));
  source1.close();
  assertTrue(relay1.isClosed());
  try {
    Relay.read(file);
    fail();
  }
 catch (  IOException expected) {
    assertEquals("unreadable cache file",expected.getMessage());
  }
  assertFile(Relay.PREFIX_DIRTY,-1L,-1,null,null);
}

@Test public void failedConnect() throws UnknownHostException {
  enableTlsWithTunnel(false);
  server.enqueue(new MockResponse().setSocketPolicy(SocketPolicy.FAIL_HANDSHAKE));
  Call call=client.newCall(new Request.Builder().url(server.url("/")).build());
  try {
    call.execute();
    fail();
  }
 catch (  IOException expected) {
  }
  InetAddress address=client.dns().lookup(server.getHostName()).get(0);
  InetSocketAddress expectedAddress=new InetSocketAddress(address,server.getPort());
  ConnectStart connectStart=listener.removeUpToEvent(ConnectStart.class);
  assertSame(call,connectStart.call);
  assertEquals(expectedAddress,connectStart.inetSocketAddress);
  assertEquals(Proxy.NO_PROXY,connectStart.proxy);
  ConnectFailed connectFailed=listener.removeUpToEvent(ConnectFailed.class);
  assertSame(call,connectFailed.call);
  assertEquals(expectedAddress,connectFailed.inetSocketAddress);
  assertNull(connectFailed.protocol);
  assertNotNull(connectFailed.ioe);
}

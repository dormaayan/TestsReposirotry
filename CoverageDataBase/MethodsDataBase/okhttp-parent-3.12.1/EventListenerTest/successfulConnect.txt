@Test public void successfulConnect() throws IOException {
  server.enqueue(new MockResponse());
  Call call=client.newCall(new Request.Builder().url(server.url("/")).build());
  Response response=call.execute();
  assertEquals(200,response.code());
  response.body().close();
  InetAddress address=client.dns().lookup(server.getHostName()).get(0);
  InetSocketAddress expectedAddress=new InetSocketAddress(address,server.getPort());
  ConnectStart connectStart=listener.removeUpToEvent(ConnectStart.class);
  assertSame(call,connectStart.call);
  assertEquals(expectedAddress,connectStart.inetSocketAddress);
  assertEquals(Proxy.NO_PROXY,connectStart.proxy);
  ConnectEnd connectEnd=listener.removeUpToEvent(ConnectEnd.class);
  assertSame(call,connectEnd.call);
  assertEquals(expectedAddress,connectEnd.inetSocketAddress);
  assertEquals(Protocol.HTTP_1_1,connectEnd.protocol);
}

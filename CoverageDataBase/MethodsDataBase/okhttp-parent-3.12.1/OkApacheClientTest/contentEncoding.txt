@Test public void contentEncoding() throws Exception {
  String text="{\"Message\": { \"text\": \"Hello, World!\" } }";
  server.enqueue(new MockResponse().setBody(gzip(text)).setHeader("Content-Encoding","gzip"));
  HttpGet request=new HttpGet(server.url("/").url().toURI());
  request.setHeader("Accept-encoding","gzip");
  HttpResponse response=client.execute(request);
  HttpEntity entity=response.getEntity();
  Header[] encodingHeaders=response.getHeaders("Content-Encoding");
  assertEquals(1,encodingHeaders.length);
  assertEquals("gzip",encodingHeaders[0].getValue());
  assertNotNull(entity.getContentEncoding());
  assertEquals("gzip",entity.getContentEncoding().getValue());
  assertEquals(text,gunzip(entity));
}

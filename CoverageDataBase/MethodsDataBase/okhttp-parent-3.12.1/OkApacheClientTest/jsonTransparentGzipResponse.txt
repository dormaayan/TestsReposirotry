@Test public void jsonTransparentGzipResponse() throws Exception {
  String text="{\"Message\": { \"text\": \"Hello, World!\" } }";
  server.enqueue(new MockResponse().setBody(gzip(text)).setHeader("Content-Encoding","gzip").setHeader("Content-Type","application/json"));
  HttpGet request=new HttpGet(server.url("/").url().toURI());
  HttpResponse response=client.execute(request);
  HttpEntity entity=response.getEntity();
  Header[] encodingHeaders=response.getHeaders("Content-Encoding");
  assertEquals(0,encodingHeaders.length);
  assertNull(entity.getContentEncoding());
  Header[] lengthHeaders=response.getHeaders("Content-Length");
  assertEquals(0,lengthHeaders.length);
  assertEquals(-1,entity.getContentLength());
  Header[] typeHeaders=response.getHeaders("Content-Type");
  assertEquals(1,typeHeaders.length);
  assertEquals("application/json",typeHeaders[0].getValue());
  assertNotNull(entity.getContentType());
  assertEquals("application/json",entity.getContentType().getValue());
  assertEquals(text,EntityUtils.toString(entity,UTF_8));
}

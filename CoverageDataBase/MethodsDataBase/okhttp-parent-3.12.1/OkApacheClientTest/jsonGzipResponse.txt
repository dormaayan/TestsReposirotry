@Test public void jsonGzipResponse() throws Exception {
  String text="{\"Message\": { \"text\": \"Hello, World!\" } }";
  server.enqueue(new MockResponse().setBody(gzip(text)).setHeader("Content-Encoding","gzip").setHeader("Content-Type","application/json"));
  HttpGet request1=new HttpGet(server.url("/").url().toURI());
  request1.setHeader("Accept-encoding","gzip");
  HttpResponse response=client.execute(request1);
  HttpEntity entity=response.getEntity();
  Header[] encodingHeaders=response.getHeaders("Content-Encoding");
  assertEquals(1,encodingHeaders.length);
  assertEquals("gzip",encodingHeaders[0].getValue());
  assertNotNull(entity.getContentEncoding());
  assertEquals("gzip",entity.getContentEncoding().getValue());
  Header[] typeHeaders=response.getHeaders("Content-Type");
  assertEquals(1,typeHeaders.length);
  assertEquals("application/json",typeHeaders[0].getValue());
  assertNotNull(entity.getContentType());
  assertEquals("application/json",entity.getContentType().getValue());
  assertEquals(text,gunzip(entity));
}

@Test public void unexpectedPongsDoNotInterfereWithFailureDetection() throws IOException {
  long startNanos=System.nanoTime();
  client.initWebSocket(random,500);
  server.webSocket.pong(ByteString.encodeUtf8("pong 1"));
  client.processNextFrame();
  server.webSocket.pong(ByteString.encodeUtf8("pong 2"));
  client.processNextFrame();
  server.webSocket.pong(ByteString.encodeUtf8("pong 3"));
  client.processNextFrame();
  server.processNextFrame();
  client.processNextFrame();
  long elapsedUntilPing=System.nanoTime() - startNanos;
  assertEquals(500,TimeUnit.NANOSECONDS.toMillis(elapsedUntilPing),250d);
  client.listener.assertFailure(SocketTimeoutException.class,"sent ping but didn't receive pong within 500ms (after 1 successful ping/pongs)");
  long elapsedUntilFailure=System.nanoTime() - startNanos;
  assertEquals(1500,TimeUnit.NANOSECONDS.toMillis(elapsedUntilFailure),250d);
}

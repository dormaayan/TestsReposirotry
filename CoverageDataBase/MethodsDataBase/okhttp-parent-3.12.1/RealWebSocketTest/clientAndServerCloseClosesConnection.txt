@Test public void clientAndServerCloseClosesConnection() throws Exception {
  server.webSocket.close(1000,"Hello!");
  client.processNextFrame();
  assertFalse(client.closed);
  client.webSocket.close(1000,"Hi!");
  server.processNextFrame();
  client.listener.assertClosing(1000,"Hello!");
  server.listener.assertClosing(1000,"Hi!");
  client.listener.assertClosed(1000,"Hello!");
  server.listener.assertClosed(1000,"Hi!");
  client.webSocket.awaitTermination(5,TimeUnit.SECONDS);
  assertTrue(client.closed);
  server.listener.assertExhausted();
  client.listener.assertExhausted();
}

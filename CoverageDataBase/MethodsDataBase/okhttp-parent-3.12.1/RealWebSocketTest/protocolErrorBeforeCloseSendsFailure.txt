@Test public void protocolErrorBeforeCloseSendsFailure() throws IOException {
  server.sink.write(ByteString.decodeHex("0a00")).emit();
  client.processNextFrame();
  assertTrue(client.closed);
  client.listener.assertFailure(ProtocolException.class,"Control frames must be final.");
  server.processNextFrame();
  server.listener.assertFailure(EOFException.class);
}

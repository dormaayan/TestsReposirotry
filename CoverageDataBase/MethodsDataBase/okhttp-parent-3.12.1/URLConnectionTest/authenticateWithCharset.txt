@Test public void authenticateWithCharset() throws Exception {
  server.enqueue(new MockResponse().setResponseCode(401).addHeader("WWW-Authenticate: Basic realm=\"protected area\", charset=\"UTF-8\"").setBody("Please authenticate with UTF-8."));
  server.enqueue(new MockResponse().setResponseCode(401).addHeader("WWW-Authenticate: Basic realm=\"protected area\"").setBody("Please authenticate with ISO-8859-1."));
  server.enqueue(new MockResponse().setBody("Successful auth!"));
  Authenticator.setDefault(new RecordingAuthenticator(new PasswordAuthentication("username","m√∂torhead".toCharArray())));
  urlFactory.setClient(urlFactory.client().newBuilder().authenticator(new JavaNetAuthenticator()).build());
  connection=urlFactory.open(server.url("/").url());
  assertEquals("Successful auth!",readAscii(connection.getInputStream(),Integer.MAX_VALUE));
  RecordedRequest request1=server.takeRequest();
  assertNull(request1.getHeader("Authorization"));
  RecordedRequest request2=server.takeRequest();
  assertEquals("Basic dXNlcm5hbWU6bcO2dG9yaGVhZA==",request2.getHeader("Authorization"));
  RecordedRequest request3=server.takeRequest();
  assertEquals("Basic dXNlcm5hbWU6bfZ0b3JoZWFk",request3.getHeader("Authorization"));
}

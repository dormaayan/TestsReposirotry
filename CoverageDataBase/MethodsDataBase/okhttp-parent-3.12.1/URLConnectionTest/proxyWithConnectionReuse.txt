@Test public void proxyWithConnectionReuse() throws IOException {
  SSLSocketFactory socketFactory=handshakeCertificates.sslSocketFactory();
  RecordingHostnameVerifier hostnameVerifier=new RecordingHostnameVerifier();
  server.useHttps(socketFactory,true);
  server.enqueue(new MockResponse().setSocketPolicy(UPGRADE_TO_SSL_AT_END).clearHeaders());
  server.enqueue(new MockResponse().setBody("response 1"));
  server.enqueue(new MockResponse().setBody("response 2"));
  urlFactory.setClient(urlFactory.client().newBuilder().proxy(server.toProxyAddress()).sslSocketFactory(socketFactory,handshakeCertificates.trustManager()).hostnameVerifier(hostnameVerifier).build());
  URL url=new URL("https://android.com/foo");
  assertContent("response 1",urlFactory.open(url));
  assertContent("response 2",urlFactory.open(url));
}

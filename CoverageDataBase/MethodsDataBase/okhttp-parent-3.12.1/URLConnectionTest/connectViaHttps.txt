@Test public void connectViaHttps() throws Exception {
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().setBody("this response comes via HTTPS"));
  urlFactory.setClient(urlFactory.client().newBuilder().sslSocketFactory(handshakeCertificates.sslSocketFactory(),handshakeCertificates.trustManager()).hostnameVerifier(new RecordingHostnameVerifier()).build());
  connection=urlFactory.open(server.url("/foo").url());
  assertContent("this response comes via HTTPS",connection);
  RecordedRequest request=server.takeRequest();
  assertEquals("GET /foo HTTP/1.1",request.getRequestLine());
}

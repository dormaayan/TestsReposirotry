@Test public void requestHeaders() throws Exception {
  server.enqueue(new MockResponse());
  connection=urlFactory.open(server.url("/").url());
  connection.addRequestProperty("D","e");
  connection.addRequestProperty("D","f");
  assertEquals("f",connection.getRequestProperty("D"));
  assertEquals("f",connection.getRequestProperty("d"));
  Map<String,List<String>> requestHeaders=connection.getRequestProperties();
  assertEquals(newSet("e","f"),new LinkedHashSet<>(requestHeaders.get("D")));
  assertEquals(newSet("e","f"),new LinkedHashSet<>(requestHeaders.get("d")));
  try {
    requestHeaders.put("G",Arrays.asList("h"));
    fail("Modified an unmodifiable view.");
  }
 catch (  UnsupportedOperationException expected) {
  }
  try {
    requestHeaders.get("D").add("i");
    fail("Modified an unmodifiable view.");
  }
 catch (  UnsupportedOperationException expected) {
  }
  try {
    connection.setRequestProperty(null,"j");
    fail();
  }
 catch (  NullPointerException expected) {
  }
  try {
    connection.addRequestProperty(null,"k");
    fail();
  }
 catch (  NullPointerException expected) {
  }
  connection.setRequestProperty("NullValue",null);
  assertNull(connection.getRequestProperty("NullValue"));
  connection.addRequestProperty("AnotherNullValue",null);
  assertNull(connection.getRequestProperty("AnotherNullValue"));
  connection.getResponseCode();
  RecordedRequest request=server.takeRequest();
  assertEquals(Arrays.asList("e","f"),request.getHeaders().values("D"));
  assertNull(request.getHeader("NullValue"));
  assertNull(request.getHeader("AnotherNullValue"));
  assertNull(request.getHeader("G"));
  assertNull(request.getHeader("null"));
  try {
    connection.addRequestProperty("N","o");
    fail("Set header after connect");
  }
 catch (  IllegalStateException expected) {
  }
  try {
    connection.setRequestProperty("P","q");
    fail("Set header after connect");
  }
 catch (  IllegalStateException expected) {
  }
  try {
    connection.getRequestProperties();
    fail();
  }
 catch (  IllegalStateException expected) {
  }
}

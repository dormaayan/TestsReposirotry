@Test public void attemptAuthorization20Times() throws Exception {
  for (int i=0; i < 20; i++) {
    server.enqueue(new MockResponse().setResponseCode(401));
  }
  server.enqueue(new MockResponse().setBody("Success!"));
  String credential=Credentials.basic("jesse","peanutbutter");
  urlFactory.setClient(urlFactory.client().newBuilder().authenticator(new RecordingOkAuthenticator(credential,null)).build());
  connection=urlFactory.open(server.url("/0").url());
  assertContent("Success!",connection);
}

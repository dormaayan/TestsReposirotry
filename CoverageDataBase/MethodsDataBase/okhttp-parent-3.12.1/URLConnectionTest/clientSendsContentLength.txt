@Test public void clientSendsContentLength() throws Exception {
  server.enqueue(new MockResponse().setBody("A"));
  connection=urlFactory.open(server.url("/").url());
  connection.setDoOutput(true);
  OutputStream out=connection.getOutputStream();
  out.write(new byte[]{'A','B','C'});
  out.close();
  assertEquals("A",readAscii(connection.getInputStream(),Integer.MAX_VALUE));
  RecordedRequest request=server.takeRequest();
  assertEquals("3",request.getHeader("Content-Length"));
  connection.getInputStream().close();
}

@Test public void clientConfiguredGzipContentEncoding() throws Exception {
  Buffer bodyBytes=gzip("ABCDEFGHIJKLMNOPQRSTUVWXYZ");
  server.enqueue(new MockResponse().setBody(bodyBytes).addHeader("Content-Encoding: gzip"));
  URLConnection connection=urlFactory.open(server.url("/").url());
  connection.addRequestProperty("Accept-Encoding","gzip");
  InputStream gunzippedIn=new GZIPInputStream(connection.getInputStream());
  assertEquals("ABCDEFGHIJKLMNOPQRSTUVWXYZ",readAscii(gunzippedIn,Integer.MAX_VALUE));
  assertEquals(bodyBytes.size(),connection.getContentLength());
  RecordedRequest request=server.takeRequest();
  assertEquals("gzip",request.getHeader("Accept-Encoding"));
}

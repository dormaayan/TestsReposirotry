@Test public void httpsWithCustomTrustManager() throws Exception {
  RecordingHostnameVerifier hostnameVerifier=new RecordingHostnameVerifier();
  RecordingTrustManager trustManager=new RecordingTrustManager(handshakeCertificates.trustManager());
  SSLContext sslContext=Platform.get().getSSLContext();
  sslContext.init(null,new TrustManager[]{trustManager},null);
  urlFactory.setClient(urlFactory.client().newBuilder().hostnameVerifier(hostnameVerifier).sslSocketFactory(sslContext.getSocketFactory(),trustManager).build());
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().setBody("ABC"));
  server.enqueue(new MockResponse().setBody("DEF"));
  server.enqueue(new MockResponse().setBody("GHI"));
  URL url=server.url("/").url();
  assertContent("ABC",urlFactory.open(url));
  assertContent("DEF",urlFactory.open(url));
  assertContent("GHI",urlFactory.open(url));
  assertEquals(Arrays.asList("verify " + server.getHostName()),hostnameVerifier.calls);
  assertEquals(Arrays.asList("checkServerTrusted [CN=localhost 1]"),trustManager.calls);
}

@Test public void connectViaHttpsWithSSLFallbackFailuresRecorded(){
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().setSocketPolicy(FAIL_HANDSHAKE));
  server.enqueue(new MockResponse().setSocketPolicy(FAIL_HANDSHAKE));
  urlFactory.setClient(urlFactory.client().newBuilder().connectionSpecs(Arrays.asList(ConnectionSpec.MODERN_TLS,ConnectionSpec.COMPATIBLE_TLS)).hostnameVerifier(new RecordingHostnameVerifier()).sslSocketFactory(suppressTlsFallbackClientSocketFactory(),handshakeCertificates.trustManager()).build());
  connection=urlFactory.open(server.url("/foo").url());
  try {
    connection.getResponseCode();
    fail();
  }
 catch (  IOException expected) {
    assertEquals(1,expected.getSuppressed().length);
  }
}

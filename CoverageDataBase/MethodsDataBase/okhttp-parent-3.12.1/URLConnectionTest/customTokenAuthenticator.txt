@Test public void customTokenAuthenticator() throws Exception {
  MockResponse pleaseAuthenticate=new MockResponse().setResponseCode(401).addHeader("WWW-Authenticate: Bearer realm=\"oauthed\"").setBody("Please authenticate.");
  server.enqueue(pleaseAuthenticate);
  server.enqueue(new MockResponse().setBody("A"));
  RecordingOkAuthenticator authenticator=new RecordingOkAuthenticator("oauthed abc123","Bearer");
  urlFactory.setClient(urlFactory.client().newBuilder().authenticator(authenticator).build());
  assertContent("A",urlFactory.open(server.url("/private").url()));
  assertNull(server.takeRequest().getHeader("Authorization"));
  assertEquals("oauthed abc123",server.takeRequest().getHeader("Authorization"));
  Response response=authenticator.onlyResponse();
  assertEquals("/private",response.request().url().url().getPath());
  assertEquals(Arrays.asList(new Challenge("Bearer","oauthed")),response.challenges());
}

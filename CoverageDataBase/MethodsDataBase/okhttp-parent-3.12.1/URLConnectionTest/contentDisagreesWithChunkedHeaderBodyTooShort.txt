@Test public void contentDisagreesWithChunkedHeaderBodyTooShort() throws IOException {
  MockResponse mockResponse=new MockResponse();
  mockResponse.setChunkedBody("abcde",5);
  Buffer truncatedBody=new Buffer();
  Buffer fullBody=mockResponse.getBody();
  truncatedBody.write(fullBody,fullBody.indexOf((byte)'e'));
  mockResponse.setBody(truncatedBody);
  mockResponse.clearHeaders();
  mockResponse.addHeader("Transfer-encoding: chunked");
  mockResponse.setSocketPolicy(DISCONNECT_AT_END);
  server.enqueue(mockResponse);
  try {
    readAscii(urlFactory.open(server.url("/").url()).getInputStream(),5);
    fail();
  }
 catch (  ProtocolException expected) {
  }
}

@Test public void streamDiscardingIsTimely() throws Exception {
  server.enqueue(new MockResponse().setBody(new Buffer().write(new byte[10000])).throttleBody(100,10,MILLISECONDS));
  server.enqueue(new MockResponse().setBody("A"));
  long startNanos=System.nanoTime();
  URLConnection connection1=urlFactory.open(server.url("/").url());
  InputStream in=connection1.getInputStream();
  in.close();
  long elapsedNanos=System.nanoTime() - startNanos;
  long elapsedMillis=NANOSECONDS.toMillis(elapsedNanos);
  assertTrue(Util.format("Time to close: %sms",elapsedMillis),elapsedMillis < 500);
  assertContent("A",urlFactory.open(server.url("/").url()));
  assertEquals(0,server.takeRequest().getSequenceNumber());
  assertEquals(0,server.takeRequest().getSequenceNumber());
}

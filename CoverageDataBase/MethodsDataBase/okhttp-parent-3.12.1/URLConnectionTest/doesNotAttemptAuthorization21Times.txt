@Test public void doesNotAttemptAuthorization21Times() throws Exception {
  for (int i=0; i < 21; i++) {
    server.enqueue(new MockResponse().setResponseCode(401));
  }
  String credential=Credentials.basic("jesse","peanutbutter");
  urlFactory.setClient(urlFactory.client().newBuilder().authenticator(new RecordingOkAuthenticator(credential,null)).build());
  connection=urlFactory.open(server.url("/").url());
  try {
    connection.getInputStream();
    fail();
  }
 catch (  ProtocolException expected) {
    assertEquals(401,connection.getResponseCode());
    assertEquals("Too many follow-up requests: 21",expected.getMessage());
  }
}

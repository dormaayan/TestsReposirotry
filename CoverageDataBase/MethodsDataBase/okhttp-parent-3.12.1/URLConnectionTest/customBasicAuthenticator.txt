@Test public void customBasicAuthenticator() throws Exception {
  MockResponse pleaseAuthenticate=new MockResponse().setResponseCode(401).addHeader("WWW-Authenticate: Basic realm=\"protected area\"").setBody("Please authenticate.");
  server.enqueue(pleaseAuthenticate);
  server.enqueue(new MockResponse().setBody("A"));
  String credential=Credentials.basic("jesse","peanutbutter");
  RecordingOkAuthenticator authenticator=new RecordingOkAuthenticator(credential,null);
  urlFactory.setClient(urlFactory.client().newBuilder().authenticator(authenticator).build());
  assertContent("A",urlFactory.open(server.url("/private").url()));
  assertNull(server.takeRequest().getHeader("Authorization"));
  assertEquals(credential,server.takeRequest().getHeader("Authorization"));
  assertEquals(Proxy.NO_PROXY,authenticator.onlyRoute().proxy());
  Response response=authenticator.onlyResponse();
  assertEquals("/private",response.request().url().url().getPath());
  assertEquals(Arrays.asList(new Challenge("Basic","protected area")),response.challenges());
}

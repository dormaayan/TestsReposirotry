@Test public void proxyWithConnectionClose() throws IOException {
  server.useHttps(handshakeCertificates.sslSocketFactory(),true);
  server.enqueue(new MockResponse().setSocketPolicy(UPGRADE_TO_SSL_AT_END).clearHeaders());
  server.enqueue(new MockResponse().setBody("this response comes via a proxy"));
  urlFactory.setClient(urlFactory.client().newBuilder().proxy(server.toProxyAddress()).sslSocketFactory(handshakeCertificates.sslSocketFactory(),handshakeCertificates.trustManager()).hostnameVerifier(new RecordingHostnameVerifier()).build());
  URL url=new URL("https://android.com/foo");
  connection=urlFactory.open(url);
  connection.setRequestProperty("Connection","close");
  assertContent("this response comes via a proxy",connection);
}

@Test public void postBodyRetransmittedOnFailureRecovery() throws Exception {
  server.enqueue(new MockResponse().setBody("abc"));
  server.enqueue(new MockResponse().setSocketPolicy(SocketPolicy.DISCONNECT_AFTER_REQUEST));
  server.enqueue(new MockResponse().setBody("def"));
  Request request1=new Request.Builder().url(server.url("/")).build();
  Response response1=client.newCall(request1).execute();
  assertEquals("abc",response1.body().string());
  Request request2=new Request.Builder().url(server.url("/")).post(RequestBody.create(MediaType.get("text/plain"),"body!")).build();
  Response response2=client.newCall(request2).execute();
  assertEquals("def",response2.body().string());
  RecordedRequest get=server.takeRequest();
  assertEquals(0,get.getSequenceNumber());
  RecordedRequest post1=server.takeRequest();
  assertEquals("body!",post1.getBody().readUtf8());
  assertEquals(1,post1.getSequenceNumber());
  RecordedRequest post2=server.takeRequest();
  assertEquals("body!",post2.getBody().readUtf8());
  assertEquals(0,post2.getSequenceNumber());
}

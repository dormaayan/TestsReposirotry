/** 
 * https://github.com/square/okhttp/issues/2344 
 */
@Test public void ipv6HostHasSquareBraces() throws Exception {
  server.useHttps(handshakeCertificates.sslSocketFactory(),true);
  server.setProtocols(Collections.singletonList(Protocol.HTTP_1_1));
  server.enqueue(new MockResponse().setSocketPolicy(SocketPolicy.UPGRADE_TO_SSL_AT_END).clearHeaders());
  server.enqueue(new MockResponse().setBody("response body"));
  client=client.newBuilder().sslSocketFactory(handshakeCertificates.sslSocketFactory(),handshakeCertificates.trustManager()).hostnameVerifier(new RecordingHostnameVerifier()).proxy(server.toProxyAddress()).build();
  Request request=new Request.Builder().url("https://[::1]/").build();
  Response response=client.newCall(request).execute();
  assertEquals("response body",response.body().string());
  RecordedRequest connect=server.takeRequest();
  assertEquals("CONNECT [::1]:443 HTTP/1.1",connect.getRequestLine());
  assertEquals("[::1]:443",connect.getHeader("Host"));
  RecordedRequest get=server.takeRequest();
  assertEquals("GET / HTTP/1.1",get.getRequestLine());
  assertEquals("[::1]",get.getHeader("Host"));
}

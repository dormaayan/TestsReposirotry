@Test public void rangeHeaderPreventsAutomaticGzip() throws Exception {
  Buffer gzippedBody=gzip("abcabcabc");
  server.enqueue(new MockResponse().setResponseCode(HttpURLConnection.HTTP_PARTIAL).setBody(gzippedBody).addHeader("Content-Encoding: gzip").addHeader("Content-Range: bytes 0-" + (gzippedBody.size() - 1)));
  Request request=new Request.Builder().url(server.url("/")).header("Range","bytes=0-").build();
  Call call=client.newCall(request);
  Response response=call.execute();
  assertEquals("gzip",response.header("Content-Encoding"));
  assertEquals(gzippedBody.snapshot(),response.body().source().readByteString());
  RecordedRequest recordedRequest=server.takeRequest();
  assertNull(recordedRequest.getHeader("Accept-Encoding"));
}

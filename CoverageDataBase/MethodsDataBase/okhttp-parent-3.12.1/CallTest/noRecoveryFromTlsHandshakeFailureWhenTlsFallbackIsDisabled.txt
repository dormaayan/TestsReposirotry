@Test public void noRecoveryFromTlsHandshakeFailureWhenTlsFallbackIsDisabled() throws Exception {
  client=client.newBuilder().connectionSpecs(Arrays.asList(ConnectionSpec.MODERN_TLS,ConnectionSpec.CLEARTEXT)).hostnameVerifier(new RecordingHostnameVerifier()).sslSocketFactory(suppressTlsFallbackClientSocketFactory(),handshakeCertificates.trustManager()).build();
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().setSocketPolicy(SocketPolicy.FAIL_HANDSHAKE));
  Request request=new Request.Builder().url(server.url("/")).build();
  try {
    client.newCall(request).execute();
    fail();
  }
 catch (  SSLProtocolException expected) {
  }
catch (  SSLHandshakeException expected) {
  }
catch (  SSLException expected) {
    String jvmVersion=System.getProperty("java.specification.version");
    assertEquals("11",jvmVersion);
  }
}

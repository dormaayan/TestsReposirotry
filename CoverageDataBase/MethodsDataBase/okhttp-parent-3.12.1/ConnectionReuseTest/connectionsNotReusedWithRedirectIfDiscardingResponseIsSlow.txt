@Test public void connectionsNotReusedWithRedirectIfDiscardingResponseIsSlow() throws Exception {
  client=client.newBuilder().connectionPool(new ConnectionPool(0,5,TimeUnit.SECONDS)).build();
  server.enqueue(new MockResponse().setResponseCode(301).addHeader("Location: /b").setBodyDelay(1,TimeUnit.SECONDS).setBody("a"));
  server.enqueue(new MockResponse().setBody("b"));
  Request request=new Request.Builder().url(server.url("/")).build();
  Response response=client.newCall(request).execute();
  assertEquals("b",response.body().string());
  assertEquals(0,server.takeRequest().getSequenceNumber());
  assertEquals(0,server.takeRequest().getSequenceNumber());
}

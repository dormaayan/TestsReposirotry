@Test public void chainGoesAllTheWayToSelfSignedRoot() throws Exception {
  HeldCertificate selfSigned=new HeldCertificate.Builder().serialNumber(1L).build();
  HeldCertificate trusted=new HeldCertificate.Builder().serialNumber(2L).signedBy(selfSigned).build();
  HeldCertificate certA=new HeldCertificate.Builder().serialNumber(3L).signedBy(trusted).build();
  HeldCertificate certB=new HeldCertificate.Builder().serialNumber(4L).signedBy(certA).build();
  CertificateChainCleaner cleaner=CertificateChainCleaner.get(selfSigned.certificate(),trusted.certificate());
  assertEquals(list(certB,certA,trusted,selfSigned),cleaner.clean(list(certB,certA),"hostname"));
  assertEquals(list(certB,certA,trusted,selfSigned),cleaner.clean(list(certB,certA,trusted),"hostname"));
  assertEquals(list(certB,certA,trusted,selfSigned),cleaner.clean(list(certB,certA,trusted,selfSigned),"hostname"));
}

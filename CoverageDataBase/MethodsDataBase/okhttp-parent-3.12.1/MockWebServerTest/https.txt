@Test public void https() throws Exception {
  HandshakeCertificates handshakeCertificates=localhost();
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().setBody("abc"));
  HttpUrl url=server.url("/");
  HttpsURLConnection connection=(HttpsURLConnection)url.url().openConnection();
  connection.setSSLSocketFactory(handshakeCertificates.sslSocketFactory());
  connection.setHostnameVerifier(new RecordingHostnameVerifier());
  assertEquals(HttpURLConnection.HTTP_OK,connection.getResponseCode());
  BufferedReader reader=new BufferedReader(new InputStreamReader(connection.getInputStream()));
  assertEquals("abc",reader.readLine());
  RecordedRequest request=server.takeRequest();
  assertEquals("https",request.getRequestUrl().scheme());
  Handshake handshake=request.getHandshake();
  assertNotNull(handshake.tlsVersion());
  assertNotNull(handshake.cipherSuite());
  assertNotNull(handshake.localPrincipal());
  assertEquals(1,handshake.localCertificates().size());
  assertNull(handshake.peerPrincipal());
  assertEquals(0,handshake.peerCertificates().size());
}

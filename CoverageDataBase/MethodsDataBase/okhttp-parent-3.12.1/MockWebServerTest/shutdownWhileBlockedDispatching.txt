@Test public void shutdownWhileBlockedDispatching() throws Exception {
  HttpURLConnection connection=(HttpURLConnection)server.url("/").url().openConnection();
  connection.setReadTimeout(500);
  try {
    connection.getResponseCode();
    fail();
  }
 catch (  SocketTimeoutException expected) {
  }
  server.shutdown();
}

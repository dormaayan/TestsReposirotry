@Test public void rebuildJournalFailureIsRetried() throws Exception {
  while (executor.jobs.isEmpty()) {
    set("a","a","a");
    set("b","b","b");
  }
  fileSystem.setFaultyRename(new File(cacheDir,DiskLruCache.JOURNAL_FILE_BACKUP),true);
  executor.jobs.removeFirst().run();
  DiskLruCache.Snapshot snapshot=cache.get("b");
  snapshot.close();
  assertNull(cache.edit("d"));
  assertEquals(2,executor.jobs.size());
  assertNull(cache.get("c"));
  assertEquals(2,executor.jobs.size());
  fileSystem.setFaultyRename(new File(cacheDir,DiskLruCache.JOURNAL_FILE_BACKUP),false);
  executor.jobs.removeFirst().run();
  assertJournalEquals("CLEAN a 1 1","CLEAN b 1 1");
}

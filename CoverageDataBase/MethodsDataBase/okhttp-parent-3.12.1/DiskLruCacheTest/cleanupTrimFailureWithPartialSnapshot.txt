@Test public void cleanupTrimFailureWithPartialSnapshot() throws Exception {
  cache.setMaxSize(8);
  executor.jobs.pop();
  set("a","aa","aa");
  set("b","bb","bbb");
  fileSystem.setFaultyDelete(new File(cacheDir,"a.1"),true);
  executor.jobs.pop().run();
  assertNull(cache.get("a"));
  assertNull(cache.edit("a"));
  fileSystem.setFaultyDelete(new File(cacheDir,"a.1"),false);
  executor.jobs.pop().run();
  assertNull(cache.get("a"));
}

@Test public void recoverFromInitializationFailure() throws IOException {
  DiskLruCache.Editor creator=cache.edit("k1");
  BufferedSink sink=Okio.buffer(creator.newSink(0));
  sink.writeUtf8("Hello");
  sink.close();
  fileSystem.setFaultyDelete(new File(cacheDir,"k1.0.tmp"),true);
  fileSystem.setFaultyDelete(cacheDir,true);
  cache=new DiskLruCache(fileSystem,cacheDir,appVersion,2,Integer.MAX_VALUE,executor);
  toClose.add(cache);
  try {
    cache.get("k1");
    fail();
  }
 catch (  IOException expected) {
  }
  fileSystem.setFaultyDelete(new File(cacheDir,"k1.0.tmp"),false);
  fileSystem.setFaultyDelete(cacheDir,false);
  DiskLruCache.Snapshot snapshot=cache.get("k1");
  assertNull(snapshot);
}

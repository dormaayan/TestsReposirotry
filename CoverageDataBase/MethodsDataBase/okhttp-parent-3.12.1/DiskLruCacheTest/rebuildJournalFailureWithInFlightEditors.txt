@Test public void rebuildJournalFailureWithInFlightEditors() throws Exception {
  while (executor.jobs.isEmpty()) {
    set("a","a","a");
    set("b","b","b");
  }
  DiskLruCache.Editor commitEditor=cache.edit("c");
  DiskLruCache.Editor abortEditor=cache.edit("d");
  cache.edit("e");
  fileSystem.setFaultyRename(new File(cacheDir,DiskLruCache.JOURNAL_FILE_BACKUP),true);
  executor.jobs.removeFirst().run();
  setString(commitEditor,0,"c");
  setString(commitEditor,1,"c");
  commitEditor.commit();
  assertValue("c","c","c");
  abortEditor.abort();
  fileSystem.setFaultyRename(new File(cacheDir,DiskLruCache.JOURNAL_FILE_BACKUP),false);
  executor.jobs.removeFirst().run();
  assertJournalEquals("CLEAN a 1 1","CLEAN b 1 1","DIRTY e","CLEAN c 1 1");
}

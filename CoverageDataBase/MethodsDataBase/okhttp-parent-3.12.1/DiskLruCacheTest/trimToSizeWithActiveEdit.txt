/** 
 * We had a long-lived bug where  {@link DiskLruCache#trimToSize} could infinite loop if entriesbeing edited required deletion for the operation to complete.
 */
@Test public void trimToSizeWithActiveEdit() throws Exception {
  set("a","a1234","a1234");
  DiskLruCache.Editor a=cache.edit("a");
  setString(a,0,"a123");
  cache.setMaxSize(8);
  cache.flush();
  assertEquals(0,cache.size());
  assertNull(cache.get("a"));
  setString(a,1,"a1");
  a.commit();
  assertAbsent("a");
  assertEquals(0,cache.size());
}

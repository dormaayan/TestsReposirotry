@Test public void authenticate() throws Exception {
  server.enqueue(new MockResponse().setResponseCode(HttpURLConnection.HTTP_UNAUTHORIZED).addHeader("www-authenticate: Basic realm=\"protected area\"").setBody("Please authenticate."));
  server.enqueue(new MockResponse().setBody("Successful auth!"));
  String credential=Credentials.basic("username","password");
  client=client.newBuilder().authenticator(new RecordingOkAuthenticator(credential,"Basic")).build();
  Call call=client.newCall(new Request.Builder().url(server.url("/")).build());
  Response response=call.execute();
  assertEquals("Successful auth!",response.body().string());
  RecordedRequest denied=server.takeRequest();
  assertNull(denied.getHeader("Authorization"));
  RecordedRequest accepted=server.takeRequest();
  assertEquals("GET / HTTP/1.1",accepted.getRequestLine());
  assertEquals(credential,accepted.getHeader("Authorization"));
}

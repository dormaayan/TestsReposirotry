@Test public void failedRouteWithSingleProxy() throws Exception {
  Address address=httpsAddress();
  RouteSelector routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  final int numberOfAddresses=2;
  dns.set(uriHost,dns.allocate(numberOfAddresses));
  RouteSelector.Selection selection1=routeSelector.next();
  List<Route> regularRoutes=selection1.getAll();
  assertEquals(numberOfAddresses,regularRoutes.size());
  routeDatabase.failed(regularRoutes.get(0));
  routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  RouteSelector.Selection selection2=routeSelector.next();
  assertEquals(regularRoutes.get(1),selection2.next());
  assertFalse(selection2.hasNext());
  RouteSelector.Selection selection3=routeSelector.next();
  assertEquals(regularRoutes.get(0),selection3.next());
  assertFalse(selection3.hasNext());
  assertFalse(routeSelector.hasNext());
}

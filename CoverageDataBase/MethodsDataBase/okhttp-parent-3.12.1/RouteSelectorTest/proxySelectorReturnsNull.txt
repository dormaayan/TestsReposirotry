@Test public void proxySelectorReturnsNull() throws Exception {
  ProxySelector nullProxySelector=new ProxySelector(){
    @Override public List<Proxy> select(    URI uri){
      assertEquals(uriHost,uri.getHost());
      return null;
    }
    @Override public void connectFailed(    URI uri,    SocketAddress socketAddress,    IOException e){
      throw new AssertionError();
    }
  }
;
  Address address=new Address(uriHost,uriPort,dns,socketFactory,null,null,null,authenticator,null,protocols,connectionSpecs,nullProxySelector);
  RouteSelector routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  assertTrue(routeSelector.hasNext());
  dns.set(uriHost,dns.allocate(1));
  RouteSelector.Selection selection=routeSelector.next();
  assertRoute(selection.next(),address,NO_PROXY,dns.lookup(uriHost,0),uriPort);
  dns.assertRequests(uriHost);
  assertFalse(selection.hasNext());
  assertFalse(routeSelector.hasNext());
}

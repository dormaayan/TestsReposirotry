@Test public void proxySelectorReturnsMultipleProxies() throws Exception {
  Address address=httpAddress();
  proxySelector.proxies.add(proxyA);
  proxySelector.proxies.add(proxyB);
  RouteSelector routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  proxySelector.assertRequests(address.url().uri());
  assertTrue(routeSelector.hasNext());
  dns.set(proxyAHost,dns.allocate(2));
  RouteSelector.Selection selection1=routeSelector.next();
  assertRoute(selection1.next(),address,proxyA,dns.lookup(proxyAHost,0),proxyAPort);
  assertRoute(selection1.next(),address,proxyA,dns.lookup(proxyAHost,1),proxyAPort);
  dns.assertRequests(proxyAHost);
  assertFalse(selection1.hasNext());
  assertTrue(routeSelector.hasNext());
  dns.set(proxyBHost,dns.allocate(1));
  RouteSelector.Selection selection2=routeSelector.next();
  assertRoute(selection2.next(),address,proxyB,dns.lookup(proxyBHost,0),proxyBPort);
  dns.assertRequests(proxyBHost);
  assertFalse(selection2.hasNext());
  assertFalse(routeSelector.hasNext());
}

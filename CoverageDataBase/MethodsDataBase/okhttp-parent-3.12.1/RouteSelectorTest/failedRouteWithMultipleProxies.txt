@Test public void failedRouteWithMultipleProxies() throws IOException {
  Address address=httpsAddress();
  proxySelector.proxies.add(proxyA);
  proxySelector.proxies.add(proxyB);
  RouteSelector routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  dns.set(proxyAHost,dns.allocate(1));
  dns.set(proxyBHost,dns.allocate(1));
  RouteSelector.Selection selection=routeSelector.next();
  dns.assertRequests(proxyAHost);
  Route route=selection.next();
  assertRoute(route,address,proxyA,dns.lookup(proxyAHost,0),proxyAPort);
  routeDatabase.failed(route);
  routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  RouteSelector.Selection selection2=routeSelector.next();
  dns.assertRequests(proxyAHost,proxyBHost);
  assertRoute(selection2.next(),address,proxyB,dns.lookup(proxyBHost,0),proxyBPort);
  assertFalse(selection2.hasNext());
  RouteSelector.Selection selection3=routeSelector.next();
  dns.assertRequests();
  assertRoute(selection3.next(),address,proxyA,dns.lookup(proxyAHost,0),proxyAPort);
  assertFalse(selection3.hasNext());
  assertFalse(routeSelector.hasNext());
}

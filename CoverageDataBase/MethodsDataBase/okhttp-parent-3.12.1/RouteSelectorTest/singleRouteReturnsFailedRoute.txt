@Test public void singleRouteReturnsFailedRoute() throws Exception {
  Address address=httpAddress();
  RouteSelector routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  assertTrue(routeSelector.hasNext());
  dns.set(uriHost,dns.allocate(1));
  RouteSelector.Selection selection=routeSelector.next();
  Route route=selection.next();
  routeDatabase.failed(route);
  routeSelector=new RouteSelector(address,routeDatabase,null,EventListener.NONE);
  selection=routeSelector.next();
  assertRoute(selection.next(),address,NO_PROXY,dns.lookup(uriHost,0),uriPort);
  assertFalse(selection.hasNext());
  try {
    selection.next();
    fail();
  }
 catch (  NoSuchElementException expected) {
  }
  assertFalse(routeSelector.hasNext());
  try {
    routeSelector.next();
    fail();
  }
 catch (  NoSuchElementException expected) {
  }
}

@Test public void serverClosesClientOutputStream() throws Exception {
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().rstStream(3,ErrorCode.CANCEL);
  peer.acceptFrame();
  peer.sendFrame().ping(true,1,0);
  peer.play();
  Http2Connection connection=connect(peer);
  Http2Stream stream=connection.newStream(headerEntries("a","android"),true);
  BufferedSink out=Okio.buffer(stream.getSink());
  connection.writePingAndAwaitPong();
  try {
    out.writeUtf8("square");
    out.flush();
    fail();
  }
 catch (  IOException expected) {
    assertEquals("stream was reset: CANCEL",expected.getMessage());
  }
  try {
    out.close();
    fail();
  }
 catch (  IOException expected) {
  }
  assertEquals(0,connection.openStreamCount());
  InFrame synStream=peer.takeFrame();
  assertEquals(Http2.TYPE_HEADERS,synStream.type);
  assertFalse(synStream.inFinished);
  assertFalse(synStream.outFinished);
  InFrame ping=peer.takeFrame();
  assertEquals(Http2.TYPE_PING,ping.type);
}

@Test public void testTruncatedDataFrame() throws Exception {
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().synReply(false,3,headerEntries("a","android"));
  peer.sendFrame().data(false,3,data(1024),1024);
  peer.truncateLastFrame(8 + 100);
  peer.play();
  Http2Connection connection=connect(peer);
  Http2Stream stream=connection.newStream(headerEntries("b","banana"),false);
  assertEquals(Headers.of("a","android"),stream.takeHeaders());
  Source in=stream.getSource();
  try {
    Okio.buffer(in).readByteString(101);
    fail();
  }
 catch (  IOException expected) {
    assertEquals("stream was reset: PROTOCOL_ERROR",expected.getMessage());
  }
}

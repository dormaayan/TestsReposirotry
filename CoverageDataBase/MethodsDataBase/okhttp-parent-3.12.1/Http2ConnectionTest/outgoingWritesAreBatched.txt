@Test public void outgoingWritesAreBatched() throws Exception {
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().synReply(false,3,headerEntries("a","android"));
  peer.acceptFrame();
  peer.play();
  Http2Connection connection=connect(peer);
  Http2Stream stream=connection.newStream(headerEntries("b","banana"),true);
  Sink sink=stream.getSink();
  sink.write(new Buffer().writeUtf8("abcde"),5);
  sink.write(new Buffer().writeUtf8("fghij"),5);
  sink.close();
  assertEquals(Http2.TYPE_HEADERS,peer.takeFrame().type);
  InFrame data=peer.takeFrame();
  assertEquals(Http2.TYPE_DATA,data.type);
  assertTrue(Arrays.equals("abcdefghij".getBytes("UTF-8"),data.data));
  assertTrue(data.inFinished);
}

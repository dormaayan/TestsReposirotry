@Test public void sendGoAway() throws Exception {
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().synStream(false,2,0,headerEntries("b","b"));
  peer.sendFrame().ping(true,1,0);
  peer.play();
  Http2Connection connection=connect(peer);
  connection.newStream(headerEntries("a","android"),false);
synchronized (connection) {
    if (connection.shutdown) {
      throw new ConnectionShutdownException();
    }
  }
  connection.writePing(false,0x01,0x02);
  connection.shutdown(ErrorCode.PROTOCOL_ERROR);
  assertEquals(1,connection.openStreamCount());
  connection.awaitPong();
  InFrame synStream1=peer.takeFrame();
  assertEquals(Http2.TYPE_HEADERS,synStream1.type);
  InFrame pingFrame=peer.takeFrame();
  assertEquals(Http2.TYPE_PING,pingFrame.type);
  InFrame goaway=peer.takeFrame();
  assertEquals(Http2.TYPE_GOAWAY,goaway.type);
  assertEquals(0,goaway.streamId);
  assertEquals(ErrorCode.PROTOCOL_ERROR,goaway.errorCode);
}

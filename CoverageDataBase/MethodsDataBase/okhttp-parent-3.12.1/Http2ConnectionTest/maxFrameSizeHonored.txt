@Test public void maxFrameSizeHonored() throws Exception {
  byte[] buff=new byte[peer.maxOutboundDataLength() + 1];
  Arrays.fill(buff,(byte)'*');
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().synReply(false,3,headerEntries("a","android"));
  peer.acceptFrame();
  peer.acceptFrame();
  peer.play();
  Http2Connection connection=connect(peer);
  Http2Stream stream=connection.newStream(headerEntries("b","banana"),true);
  BufferedSink out=Okio.buffer(stream.getSink());
  out.write(buff);
  out.flush();
  out.close();
  InFrame synStream=peer.takeFrame();
  assertEquals(Http2.TYPE_HEADERS,synStream.type);
  InFrame data=peer.takeFrame();
  assertEquals(peer.maxOutboundDataLength(),data.data.length);
  data=peer.takeFrame();
  assertEquals(1,data.data.length);
}

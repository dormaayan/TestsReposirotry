@Test public void pushPromiseStream() throws Exception {
  peer.sendFrame().settings(new Settings());
  peer.acceptFrame();
  peer.acceptFrame();
  peer.sendFrame().synReply(false,3,headerEntries("a","android"));
  final List<Header> expectedRequestHeaders=Arrays.asList(new Header(Header.TARGET_METHOD,"GET"),new Header(Header.TARGET_SCHEME,"https"),new Header(Header.TARGET_AUTHORITY,"squareup.com"),new Header(Header.TARGET_PATH,"/cached"));
  peer.sendFrame().pushPromise(3,2,expectedRequestHeaders);
  final List<Header> expectedResponseHeaders=Arrays.asList(new Header(Header.RESPONSE_STATUS,"200"));
  peer.sendFrame().synReply(true,2,expectedResponseHeaders);
  peer.sendFrame().data(true,3,data(0),0);
  peer.play();
  RecordingPushObserver observer=new RecordingPushObserver();
  Http2Connection connection=connect(peer,observer,REFUSE_INCOMING_STREAMS);
  Http2Stream client=connection.newStream(headerEntries("b","banana"),false);
  assertEquals(-1,client.getSource().read(new Buffer(),1));
  assertEquals(Http2.TYPE_HEADERS,peer.takeFrame().type);
  assertEquals(expectedRequestHeaders,observer.takeEvent());
  assertEquals(expectedResponseHeaders,observer.takeEvent());
}

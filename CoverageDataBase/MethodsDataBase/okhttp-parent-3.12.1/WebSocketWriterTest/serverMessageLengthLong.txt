@Test public void serverMessageLengthLong() throws IOException {
  Sink sink=serverWriter.newMessageSink(OPCODE_BINARY,-1);
  Buffer payload=new Buffer();
  while (payload.completeSegmentByteCount() <= PAYLOAD_SHORT_MAX) {
    payload.writeByte('0');
  }
  long byteCount=payload.completeSegmentByteCount();
  sink.write(payload.clone(),byteCount);
  assertData("027f");
  assertData(Util.format("%016X",byteCount));
  assertData(payload.readByteArray(byteCount));
  sink.close();
  assertData("8000");
}

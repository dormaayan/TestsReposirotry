@Test public void serverMessageLengthShort() throws IOException {
  Sink sink=serverWriter.newMessageSink(OPCODE_BINARY,-1);
  Buffer payload=new Buffer();
  while (payload.completeSegmentByteCount() <= PAYLOAD_BYTE_MAX) {
    payload.writeByte('0');
  }
  long byteCount=payload.completeSegmentByteCount();
  sink.write(payload.clone(),byteCount);
  assertData("027e");
  assertData(Util.format("%04X",payload.completeSegmentByteCount()));
  assertData(payload.readByteArray());
  sink.close();
  assertData("8000");
}

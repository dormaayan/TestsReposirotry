@Test public void throwingOnMessageClosesImmediatelyAndFails(){
  webServer.enqueue(new MockResponse().withWebSocketUpgrade(serverListener));
  newWebSocket();
  clientListener.assertOpen();
  WebSocket server=serverListener.assertOpen();
  final RuntimeException e=new RuntimeException();
  clientListener.setNextEventDelegate(new WebSocketListener(){
    @Override public void onMessage(    WebSocket webSocket,    String text){
      throw e;
    }
  }
);
  server.send("Hello, WebSockets!");
  clientListener.assertFailure(e);
  serverListener.assertFailure(EOFException.class);
  serverListener.assertExhausted();
}

@Test public void webSocketAndApplicationInterceptors(){
  final AtomicInteger interceptedCount=new AtomicInteger();
  client=client.newBuilder().addInterceptor(new Interceptor(){
    @Override public Response intercept(    Chain chain) throws IOException {
      assertNull(chain.request().body());
      Response response=chain.proceed(chain.request());
      assertEquals("Upgrade",response.header("Connection"));
      assertTrue(response.body().source().exhausted());
      interceptedCount.incrementAndGet();
      return response;
    }
  }
).build();
  webServer.enqueue(new MockResponse().withWebSocketUpgrade(serverListener));
  WebSocket webSocket=newWebSocket();
  clientListener.assertOpen();
  assertEquals(1,interceptedCount.get());
  webSocket.close(1000,null);
  WebSocket server=serverListener.assertOpen();
  server.close(1000,null);
}

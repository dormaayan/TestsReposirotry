/** 
 * There's no read timeout when reading the first byte of a new frame. But as soon as we start reading a frame we enable the read timeout. In this test we have the server returning the first byte of a frame but no more frames.
 */
@Test public void readTimeoutAppliesWithinFrames(){
  webServer.setDispatcher(new Dispatcher(){
    @Override public MockResponse dispatch(    RecordedRequest request){
      return upgradeResponse(request).setBody(new Buffer().write(ByteString.decodeHex("81"))).removeHeader("Content-Length").setSocketPolicy(SocketPolicy.KEEP_OPEN);
    }
  }
);
  WebSocket webSocket=newWebSocket();
  clientListener.assertOpen();
  clientListener.assertFailure(SocketTimeoutException.class,"timeout","Read timed out");
  assertFalse(webSocket.close(1000,null));
}

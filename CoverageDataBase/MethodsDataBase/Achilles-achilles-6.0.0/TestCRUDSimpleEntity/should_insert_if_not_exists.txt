@Test public void should_insert_if_not_exists() throws Exception {
  final long id=100L;
  final Date date=buildDateKey();
  scriptExecutor.executeScriptTemplate("SimpleEntity/insert_single_row.cql",ImmutableMap.of("id",id,"table","simple"));
  final SimpleEntity entity=new SimpleEntity(id,date,"value");
  final AtomicBoolean error=new AtomicBoolean(false);
  final AtomicLong currentId=new AtomicLong(0L);
  final LWTResultListener lwtListener=new LWTResultListener(){
    @Override public void onSuccess(){
    }
    @Override public void onError(    LWTResult lwtResult){
      error.getAndSet(true);
      currentId.getAndSet(lwtResult.currentValues().getTyped("id"));
    }
  }
;
  manager.crud().insert(entity).ifNotExists().withLwtResultListener(lwtListener).execute();
  assertThat(error.get()).isTrue();
  assertThat(currentId.get()).isEqualTo(id);
}

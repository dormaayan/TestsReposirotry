@Test public void testAuthenticatedWebsocket() throws Exception {
  ProgramaticClientEndpoint endpoint=new ProgramaticClientEndpoint();
  ClientEndpointConfig clientEndpointConfig=ClientEndpointConfig.Builder.create().configurator(new ClientConfigurator(){
    @Override public void beforeRequest(    Map<String,List<String>> headers){
      headers.put(AUTHORIZATION.toString(),Collections.singletonList(BASIC + " " + FlexBase64.encodeString("user1:password1".getBytes(),false)));
    }
  }
).build();
  ContainerProvider.getWebSocketContainer().connectToServer(endpoint,clientEndpointConfig,new URI("ws://" + DefaultServer.getHostAddress("default") + ":"+ DefaultServer.getHostPort("default")+ "/servletContext/secured"));
  Assert.assertEquals("user1",endpoint.getResponses().poll(15,TimeUnit.SECONDS));
  endpoint.session.close();
  endpoint.closeLatch.await(10,TimeUnit.SECONDS);
}

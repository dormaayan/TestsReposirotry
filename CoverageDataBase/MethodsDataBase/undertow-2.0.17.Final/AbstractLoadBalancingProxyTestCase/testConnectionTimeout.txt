@Test public void testConnectionTimeout() throws Exception {
  TestHttpClient client=new TestHttpClient();
  HttpGet get=new HttpGet(DefaultServer.getDefaultServerURL() + "/timeout");
  get.addHeader("Connection","close");
  HttpResponse result=client.execute(get);
  boolean res=Boolean.parseBoolean(HttpClientUtils.readResponse(result));
  Assert.assertEquals(false,res);
  try {
    for (int i=0; i < 20; ++i) {
      result=client.execute(get);
      HttpClientUtils.readResponse(result);
    }
    result=client.execute(get);
    res=Boolean.parseBoolean(HttpClientUtils.readResponse(result));
    Thread.sleep(IDLE_TIMEOUT + 1000);
    UndertowLogger.ROOT_LOGGER.info("Sending timed out request");
    result=client.execute(get);
    res=Boolean.parseBoolean(HttpClientUtils.readResponse(result));
    Assert.assertEquals(false,res);
  }
  finally {
    client.getConnectionManager().shutdown();
  }
}

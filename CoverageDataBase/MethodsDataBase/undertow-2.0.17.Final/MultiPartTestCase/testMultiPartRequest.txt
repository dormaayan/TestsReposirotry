@Test public void testMultiPartRequest() throws IOException {
  TestHttpClient client=new TestHttpClient();
  try {
    String uri=DefaultServer.getDefaultServerURL() + "/servletContext/1";
    HttpPost post=new HttpPost(uri);
    MultipartEntity entity=new MultipartEntity(HttpMultipartMode.BROWSER_COMPATIBLE,null,StandardCharsets.UTF_8);
    entity.addPart("formValue",new StringBody("myValue","text/plain",StandardCharsets.UTF_8));
    entity.addPart("file",new FileBody(new File(MultiPartTestCase.class.getResource("uploadfile.txt").getFile())));
    post.setEntity(entity);
    HttpResponse result=client.execute(post);
    Assert.assertEquals(StatusCodes.OK,result.getStatusLine().getStatusCode());
    final String response=HttpClientUtils.readResponse(result);
    Assert.assertEquals("PARAMS:\n" + "name: formValue\n" + "filename: null\n"+ "content-type: null\n"+ "Content-Disposition: form-data; name=\"formValue\"\n"+ "size: 7\n"+ "content: myValue\n"+ "name: file\n"+ "filename: uploadfile.txt\n"+ "content-type: application/octet-stream\n"+ "Content-Disposition: form-data; name=\"file\"; filename=\"uploadfile.txt\"\n"+ "Content-Type: application/octet-stream\n"+ "size: 13\n"+ "content: file contents\n",response);
  }
  finally {
    client.getConnectionManager().shutdown();
  }
}

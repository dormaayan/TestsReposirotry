@Test public void cancelBeforeEnqueue() throws Exception {
  Retrofit retrofit=new Retrofit.Builder().baseUrl(server.url("/")).addConverterFactory(new ToStringConverterFactory()).build();
  Service service=retrofit.create(Service.class);
  Call<String> call=service.getString();
  call.cancel();
  assertThat(call.isCanceled()).isTrue();
  final AtomicReference<Throwable> failureRef=new AtomicReference<>();
  final CountDownLatch latch=new CountDownLatch(1);
  call.enqueue(new Callback<String>(){
    @Override public void onResponse(    Response<String> response){
      throw new AssertionError();
    }
    @Override public void onFailure(    Throwable t){
      failureRef.set(t);
      latch.countDown();
    }
  }
);
  latch.await();
  assertThat(failureRef.get()).hasMessage("Canceled");
}

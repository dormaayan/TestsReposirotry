@Test public void callAdapterFactoryQueriedCanDelegateTwiceWithoutRecursion(){
  Type type=String.class;
  Annotation[] annotations=new Annotation[0];
  CallAdapter<?> expectedAdapter=mock(CallAdapter.class);
  CallAdapter.Factory factory3=mock(CallAdapter.Factory.class);
  CallAdapter.Factory factory2=spy(new CallAdapter.Factory(){
    @Override public CallAdapter<?> get(    Type returnType,    Annotation[] annotations,    Retrofit retrofit){
      return retrofit.nextCallAdapter(this,returnType,annotations);
    }
  }
);
  CallAdapter.Factory factory1=spy(new CallAdapter.Factory(){
    @Override public CallAdapter<?> get(    Type returnType,    Annotation[] annotations,    Retrofit retrofit){
      return retrofit.nextCallAdapter(this,returnType,annotations);
    }
  }
);
  Retrofit retrofit=new Retrofit.Builder().baseUrl("http://example.com/").addCallAdapterFactory(factory1).addCallAdapterFactory(factory2).addCallAdapterFactory(factory3).build();
  doReturn(expectedAdapter).when(factory3).get(type,annotations,retrofit);
  CallAdapter<?> actualAdapter=retrofit.callAdapter(type,annotations);
  assertThat(actualAdapter).isSameAs(expectedAdapter);
  verify(factory1).get(type,annotations,retrofit);
  verifyNoMoreInteractions(factory1);
  verify(factory2).get(type,annotations,retrofit);
  verifyNoMoreInteractions(factory2);
  verify(factory3).get(type,annotations,retrofit);
  verifyNoMoreInteractions(factory3);
}

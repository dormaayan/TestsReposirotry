@Test public void generateReports_OnException_AppendsBuildToTrends(){
  List<String> jsonReports=Arrays.asList(ReportGenerator.reportFromResource(ReportGenerator.SAMPLE_JSON));
  Configuration configuration=new Configuration(reportDirectory,"myProject"){
    @Override public File getEmbeddingDirectory(){
      throw new IllegalStateException();
    }
  }
;
  ReportBuilder reportBuilder=new ReportBuilder(jsonReports,configuration);
  configuration.setTrendsStatsFile(trendsFileTmp);
  reportBuilder.generateReports();
  assertPageExists(reportDirectory,ReportBuilder.HOME_PAGE);
  assertThat(countHtmlFiles()).hasSize(1);
  Trends trends=Deencapsulation.invoke(reportBuilder,"loadTrends",trendsFileTmp);
  assertThat(trends.getBuildNumbers()).hasSize(4);
}

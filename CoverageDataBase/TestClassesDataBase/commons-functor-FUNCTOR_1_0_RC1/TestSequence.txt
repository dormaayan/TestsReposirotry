/** 
 * @version $Revision$ $Date$
 * @author Rodney Waldhoff
 */
@SuppressWarnings("unchecked") public class TestSequence extends BaseFunctorTest {
  protected Object makeFunctor(){
    return new Sequence(new NoOp(),new NoOp());
  }
  @Test public void testRunZero() throws Exception {
    Sequence seq=new Sequence();
    seq.run();
  }
  @Test public void testRunOne() throws Exception {
    RunCounter counter=new RunCounter();
    Sequence seq=new Sequence(counter);
    assertEquals(0,counter.count);
    seq.run();
    assertEquals(1,counter.count);
  }
  @Test public void testRunTwo() throws Exception {
    RunCounter[] counter={new RunCounter(),new RunCounter()};
    Sequence seq=new Sequence(counter[0],counter[1]);
    assertEquals(0,counter[0].count);
    assertEquals(0,counter[1].count);
    seq.run();
    assertEquals(1,counter[0].count);
    assertEquals(1,counter[1].count);
  }
  @Test public void testThen() throws Exception {
    List list=new ArrayList();
    Sequence seq=new Sequence();
    seq.run();
    for (int i=0; i < 10; i++) {
      RunCounter counter=new RunCounter();
      seq.then(counter);
      list.add(counter);
      seq.run();
      for (int j=0; j < list.size(); j++) {
        assertEquals(list.size() - j,(((RunCounter)(list.get(j))).count));
      }
    }
  }
  @Test public void testEquals() throws Exception {
    Sequence p=new Sequence();
    assertEquals(p,p);
    Sequence q=new Sequence();
    assertObjectsAreEqual(p,q);
    for (int i=0; i < 3; i++) {
      p.then(new NoOp());
      assertObjectsAreNotEqual(p,q);
      q.then(new NoOp());
      assertObjectsAreEqual(p,q);
      p.then(new Sequence(new NoOp(),new NoOp()));
      assertObjectsAreNotEqual(p,q);
      q.then(new Sequence(new NoOp(),new NoOp()));
      assertObjectsAreEqual(p,q);
    }
    assertObjectsAreNotEqual(p,new NoOp());
  }
static class RunCounter implements Procedure {
    public void run(){
      count++;
    }
    public int count=0;
  }
}

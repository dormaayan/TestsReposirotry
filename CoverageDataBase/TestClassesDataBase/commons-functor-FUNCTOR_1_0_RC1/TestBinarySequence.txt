/** 
 * @version $Revision$ $Date$
 * @author Rodney Waldhoff
 */
@SuppressWarnings("unchecked") public class TestBinarySequence extends BaseFunctorTest {
  protected Object makeFunctor(){
    return new BinarySequence(new NoOp(),new NoOp());
  }
  @Test public void testRunZero() throws Exception {
    BinarySequence seq=new BinarySequence();
    seq.run(null,null);
    seq.run("xyzzy","xyzzy");
  }
  @Test public void testRunOne() throws Exception {
    RunCounter counter=new RunCounter();
    BinarySequence seq=new BinarySequence(counter);
    assertEquals(0,counter.count);
    seq.run(null,null);
    assertEquals(1,counter.count);
    seq.run("xyzzy","xyzzy");
    assertEquals(2,counter.count);
  }
  @Test public void testRunTwo() throws Exception {
    RunCounter[] counter={new RunCounter(),new RunCounter()};
    BinarySequence seq=new BinarySequence(counter[0],counter[1]);
    assertEquals(0,counter[0].count);
    assertEquals(0,counter[1].count);
    seq.run(null,null);
    assertEquals(1,counter[0].count);
    assertEquals(1,counter[1].count);
    seq.run("xyzzy","xyzzy");
    assertEquals(2,counter[0].count);
    assertEquals(2,counter[1].count);
  }
  @Test public void testThen() throws Exception {
    List list=new ArrayList();
    BinarySequence seq=new BinarySequence();
    seq.run(null,null);
    for (int i=0; i < 10; i++) {
      RunCounter counter=new RunCounter();
      seq.then(counter);
      list.add(counter);
      seq.run("xyzzy","xyzzy");
      for (int j=0; j < list.size(); j++) {
        assertEquals(list.size() - j,(((RunCounter)(list.get(j))).count));
      }
    }
  }
  @Test public void testEquals() throws Exception {
    BinarySequence p=new BinarySequence();
    assertEquals(p,p);
    BinarySequence q=new BinarySequence();
    assertObjectsAreEqual(p,q);
    for (int i=0; i < 3; i++) {
      p.then(new NoOp());
      assertObjectsAreNotEqual(p,q);
      q.then(new NoOp());
      assertObjectsAreEqual(p,q);
      p.then(new BinarySequence(new NoOp(),new NoOp()));
      assertObjectsAreNotEqual(p,q);
      q.then(new BinarySequence(new NoOp(),new NoOp()));
      assertObjectsAreEqual(p,q);
    }
    assertObjectsAreNotEqual(p,new NoOp());
  }
static class RunCounter implements BinaryProcedure {
    public void run(    Object a,    Object b){
      count++;
    }
    public int count=0;
  }
}

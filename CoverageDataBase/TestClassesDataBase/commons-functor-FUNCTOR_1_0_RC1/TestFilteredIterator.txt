/** 
 * @version $Revision$ $Date$
 * @author Rodney Waldhoff
 */
@SuppressWarnings("unchecked") public class TestFilteredIterator extends BaseFunctorTest {
  public Object makeFunctor(){
    List list=new ArrayList();
    list.add("xyzzy");
    return FilteredIterator.filter(list.iterator(),Constant.truePredicate());
  }
  @Before public void setUp() throws Exception {
    list=new ArrayList();
    evens=new ArrayList();
    for (int i=0; i < 10; i++) {
      list.add(new Integer(i));
      if (i % 2 == 0) {
        evens.add(new Integer(i));
      }
    }
  }
  @After public void tearDown() throws Exception {
    list=null;
    evens=null;
  }
  @Test public void testSomePass(){
    Iterator expected=evens.iterator();
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    while (expected.hasNext()) {
      assertTrue(testing.hasNext());
      assertEquals(expected.next(),testing.next());
    }
    assertTrue(!testing.hasNext());
  }
  @Test public void testAllPass(){
    Iterator expected=evens.iterator();
    Iterator testing=new FilteredIterator(evens.iterator(),isEven);
    while (expected.hasNext()) {
      assertTrue(testing.hasNext());
      assertEquals(expected.next(),testing.next());
    }
    assertTrue(!testing.hasNext());
  }
  @Test public void testAllPass2(){
    Iterator expected=list.iterator();
    Iterator testing=new FilteredIterator(list.iterator(),Constant.truePredicate());
    while (expected.hasNext()) {
      assertTrue(testing.hasNext());
      assertEquals(expected.next(),testing.next());
    }
    assertTrue(!testing.hasNext());
  }
  @Test public void testEmptyList(){
    Iterator testing=new FilteredIterator(Collections.EMPTY_LIST.iterator(),isEven);
    assertTrue(!testing.hasNext());
  }
  @Test public void testNonePass(){
    Iterator testing=new FilteredIterator(Collections.EMPTY_LIST.iterator(),Constant.falsePredicate());
    assertTrue(!testing.hasNext());
  }
  @Test public void testNextWithoutHasNext(){
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    Iterator expected=evens.iterator();
    while (expected.hasNext()) {
      assertEquals(expected.next(),testing.next());
    }
    assertTrue(!(testing.hasNext()));
  }
  @Test public void testNextAfterEndOfList(){
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    Iterator expected=evens.iterator();
    while (expected.hasNext()) {
      assertEquals(expected.next(),testing.next());
    }
    try {
      testing.next();
      fail("ExpectedNoSuchElementException");
    }
 catch (    NoSuchElementException e) {
    }
  }
  @Test public void testNextOnEmptyList(){
    Iterator testing=new FilteredIterator(Collections.EMPTY_LIST.iterator(),isEven);
    try {
      testing.next();
      fail("ExpectedNoSuchElementException");
    }
 catch (    NoSuchElementException e) {
    }
  }
  @Test public void testRemoveBeforeNext(){
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    try {
      testing.remove();
      fail("IllegalStateException");
    }
 catch (    IllegalStateException e) {
    }
  }
  @Test public void testRemoveAfterNext(){
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    testing.next();
    testing.remove();
    try {
      testing.remove();
      fail("IllegalStateException");
    }
 catch (    IllegalStateException e) {
    }
  }
  @Test public void testRemoveSome(){
    Iterator testing=new FilteredIterator(list.iterator(),isEven);
    while (testing.hasNext()) {
      testing.next();
      testing.remove();
    }
    for (Iterator iter=list.iterator(); iter.hasNext(); ) {
      assertTrue(!isEven.test(iter.next()));
    }
  }
  @Test public void testRemoveAll(){
    Iterator testing=new FilteredIterator(list.iterator(),Constant.truePredicate());
    while (testing.hasNext()) {
      testing.next();
      testing.remove();
    }
    assertTrue(list.isEmpty());
  }
  @Test public void testRemoveWithoutHasNext(){
    Iterator testing=new FilteredIterator(list.iterator(),Constant.truePredicate());
    for (int i=0, m=list.size(); i < m; i++) {
      testing.next();
      testing.remove();
    }
    assertTrue(list.isEmpty());
  }
  @Test public void testFilterWithNullIteratorReturnsNull(){
    assertNull(FilteredIterator.filter(null,Constant.truePredicate()));
  }
  @Test public void testFilterWithNullPredicateReturnsIdentity(){
    Iterator iter=list.iterator();
    assertSame(iter,FilteredIterator.filter(iter,null));
  }
  @Test public void testConstructorProhibitsNull(){
    try {
      new FilteredIterator(null,null);
      fail("ExpectedNullPointerException");
    }
 catch (    IllegalArgumentException e) {
    }
    try {
      new FilteredIterator(null,Constant.truePredicate());
      fail("ExpectedNullPointerException");
    }
 catch (    IllegalArgumentException e) {
    }
    try {
      new FilteredIterator(list.iterator(),null);
      fail("ExpectedNullPointerException");
    }
 catch (    IllegalArgumentException e) {
    }
  }
  private List list=null;
  private List evens=null;
  private UnaryPredicate isEven=new UnaryPredicate(){
    public boolean test(    Object obj){
      return ((Number)obj).intValue() % 2 == 0;
    }
  }
;
}

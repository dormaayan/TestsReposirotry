static final class RecordingHeadersListener implements Header.Listener {
  final ArrayDeque<Headers> receivedHeaders=new ArrayDeque<>();
  @Override public void onHeaders(  Headers headers){
    receivedHeaders.add(headers);
  }
  public List<Headers> takeAll(){
    List<Headers> result=new ArrayList<>();
    for (Headers headers; (headers=receivedHeaders.poll()) != null; ) {
      result.add(headers);
    }
    return result;
  }
}

@NotThreadSafe public class DbDropAllCommandTest extends AbstractMigrationTest {
  private DbDropAllCommand<TestMigrationConfiguration> dropAllCommand=new DbDropAllCommand<>(TestMigrationConfiguration::getDataSource,TestMigrationConfiguration.class,"migrations.xml");
  @Test public void testRun() throws Exception {
    final String databaseUrl=getDatabaseUrl();
    final TestMigrationConfiguration conf=createConfiguration(databaseUrl);
    new DbMigrateCommand<>(TestMigrationConfiguration::getDataSource,TestMigrationConfiguration.class,"migrations.xml").run(null,new Namespace(ImmutableMap.of()),conf);
    dropAllCommand.run(null,new Namespace(ImmutableMap.of()),conf);
    try (Handle handle=new DBI(databaseUrl,"sa","").open()){
      handle.execute("create table persons(id int, name varchar(255))");
    }
   }
  @Test public void testHelpPage() throws Exception {
    final ByteArrayOutputStream out=new ByteArrayOutputStream();
    createSubparser(dropAllCommand).printHelp(new PrintWriter(new OutputStreamWriter(out,UTF_8),true));
    assertThat(out.toString(UTF_8)).isEqualTo(String.format("usage: db drop-all [-h] [--migrations MIGRATIONS-FILE] [--catalog CATALOG]%n" + "          [--schema SCHEMA] --confirm-delete-everything [file]%n" + "%n"+ "Delete all user-owned objects from the database.%n"+ "%n"+ "positional arguments:%n"+ "  file                   application configuration file%n"+ "%n"+ "named arguments:%n"+ "  -h, --help             show this help message and exit%n"+ "  --migrations MIGRATIONS-FILE%n"+ "                         the file containing  the  Liquibase migrations for%n"+ "                         the application%n"+ "  --catalog CATALOG      Specify  the   database   catalog   (use  database%n"+ "                         default if omitted)%n"+ "  --schema SCHEMA        Specify the database schema  (use database default%n"+ "                         if omitted)%n"+ "  --confirm-delete-everything%n"+ "                         indicate you  understand  this  deletes everything%n"+ "                         in your database%n"));
  }
}

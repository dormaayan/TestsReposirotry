@Ignore public class DBDatabaseDriverMSSqlTest {
  @Rule public DBResource dbResource=new DBResource(DB.MSSQL_JTDS);
  @Test public void testChineseCharacters(){
    Connection conn=dbResource.getConnection();
    DBDatabaseDriver driver=dbResource.newDriver();
    CompanyDB db=new CompanyDB();
    db.open(driver,dbResource.getConnection());
    if (!databaseExists(conn,db)) {
      DBSQLScript script=new DBSQLScript();
      db.getCreateDDLScript(db.getDriver(),script);
      System.out.println(script.toString());
      script.executeAll(db.getDriver(),dbResource.getConnection(),false);
    }
    System.out.println("*** Step 5: clearDatabase() ***");
    clearDatabase(conn,db);
    DBRecord dep=new DBRecord();
    dep.create(db.DEPARTMENT);
    dep.setValue(db.DEPARTMENT.NAME,"junit");
    dep.setValue(db.DEPARTMENT.BUSINESS_UNIT,"中文");
    dep.update(conn);
    int id=dep.getInt(db.DEPARTMENT.ID);
    DBRecord depRead=new DBRecord();
    depRead.read(db.DEPARTMENT,id,conn);
    assertEquals("中文",depRead.getString(db.DEPARTMENT.BUSINESS_UNIT));
  }
  /** 
 * <PRE> Empties all Tables. </PRE>
 */
  private static void clearDatabase(  Connection conn,  CompanyDB db){
    DBCommand cmd=db.createCommand();
    db.executeDelete(db.DEPARTMENT,cmd,conn);
  }
  /** 
 * <PRE> Checks whether the database exists or not by executing select count(*) from DEPARTMENTS If the Departments table does not exist the querySingleInt() function return -1 for failure. Please note that in this case an error will appear in the log which can be ignored. </PRE>
 */
  private static boolean databaseExists(  Connection conn,  CompanyDB db){
    DBCommand cmd=db.createCommand();
    cmd.select(db.DEPARTMENT.count());
    System.out.println("Checking whether table DEPARTMENTS exists (SQLException will be logged if not - please ignore) ...");
    return (db.querySingleInt(cmd,-1,conn) >= 0);
  }
}

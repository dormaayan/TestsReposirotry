public class CodeGenAppTest {
  @Before public void cleanup() throws IOException {
    File generated=new File("target/generated");
    if (generated.exists()) {
      boolean deleted=FileUtils.deleteDirectory(generated);
      if (!deleted) {
        throw new IOException("Could not delete previously generated sources");
      }
    }
  }
  @Test public void testMain(){
    String[] args=new String[]{"src/test/resources/testconfig.xml"};
    CodeGenerator.main(args);
    File expected=new File("target/generated/dbsample/org/apache/empire/db/samples/dbsample/SampleDB.java");
    assertTrue("missing generated code",expected.exists());
  }
  @Test public void testMainDefaultTemplateFolderNested(){
    String[] args=new String[]{"src/test/resources/testconfig_default_template_folder_nested.xml"};
    CodeGenerator.main(args);
    File expectedFile=new File("target/generated/dbsample/org/apache/empire/db/samples/dbsample/SampleDB.java");
    String expectedContent="addColumn(";
    String fileContent="";
    try {
      FileInputStream fis=new FileInputStream(expectedFile);
      byte[] buff=new byte[fis.available()];
      fis.read(buff);
      fileContent=new String(buff);
      fis.close();
    }
 catch (    IOException e) {
    }
    assertTrue("missing generated code for nested table classes",fileContent.contains(expectedContent));
  }
  @Test public void testMainUsingTemplateFolder(){
    String[] args=new String[]{"src/test/resources/testconfig_using_template_folder.xml"};
    CodeGenerator.main(args);
    File expected=new File("target/generated/dbsample/org/apache/empire/db/samples/dbsample/SampleDB.java");
    assertTrue("missing generated code",expected.exists());
  }
  @Test public void testMainFailInvalidTemplateFolder(){
    String[] args=new String[]{"src/test/resources/testconfig_invalid_template_folder.xml"};
    try {
      CodeGenerator.main(args);
      fail("This should fail as the template path is missing");
    }
 catch (    RuntimeException ex) {
      assertTrue("Wrong message",ex.getMessage().startsWith("Provided template folder missing or not readable:"));
    }
  }
}

/** 
 * Delegates everything to the BasicDataSource (ds field), except for getXAConnection which creates a BasicXAConnection.
 */
public class XADataSourceHandle implements InvocationHandler {
  @Override public Object invoke(  final Object proxy,  final Method method,  final Object[] args) throws Throwable {
    final String methodName=method.getName();
    if (methodName.equals("hashCode")) {
      return Integer.valueOf(System.identityHashCode(proxy));
    }
    if (methodName.equals("equals")) {
      return Boolean.valueOf(proxy == args[0]);
    }
    if (methodName.equals("getXAConnection")) {
      return getXAConnection();
    }
    try {
      return method.invoke(ds,args);
    }
 catch (    final InvocationTargetException e) {
      throw e.getTargetException();
    }
  }
  protected XAConnection getXAConnection() throws SQLException {
    return new TesterBasicXAConnection(ds.getConnection(),closeCounter);
  }
}

private static class ProxyServer {
  private final int port=FreePort.find();
  private final Undertow server;
  private final PathHandler pathHandler=Handlers.path();
  final String uri="http://localhost:" + port;
  private final String targetUri;
  ProxyServer(  String targetUri){
    this.targetUri=targetUri;
    server=Undertow.builder().addHttpListener(port,"0.0.0.0").setHandler(pathHandler).build();
    server.start();
  }
  void proxyPrefixPath(  String proxyPath,  String targetPath){
    pathHandler.addPrefixPath(proxyPath,proxyHandler(targetPath));
  }
  void proxyExactPath(  String proxyPath,  String targetPath){
    pathHandler.addExactPath(proxyPath,proxyHandler(targetPath));
  }
  void stop(){
    server.stop();
  }
  private HttpHandler proxyHandler(  String targetPath){
    return ProxyHandler.builder().setProxyClient((new SimpleProxyClientProvider(URI.create(targetUri + targetPath)))).build();
  }
}

/** 
 * A simple end of chain handler to set a header and cause the call to return. <p/> Reaching this handler is a sign the mechanism handlers have allowed the request through.
 */
protected static class ResponseHandler implements HttpHandler {
  static final HttpString PROCESSED_BY=new HttpString("ProcessedBy");
  static final HttpString AUTHENTICATED_USER=new HttpString("AuthenticatedUser");
  @Override public void handleRequest(  HttpServerExchange exchange) throws Exception {
    HeaderMap responseHeader=exchange.getResponseHeaders();
    responseHeader.add(PROCESSED_BY,"ResponseHandler");
    String user=getAuthenticatedUser(exchange);
    if (user != null) {
      responseHeader.add(AUTHENTICATED_USER,user);
    }
    if (exchange.getQueryParameters().get("logout") != null) {
      exchange.getSecurityContext().logout();
    }
    exchange.endExchange();
  }
}

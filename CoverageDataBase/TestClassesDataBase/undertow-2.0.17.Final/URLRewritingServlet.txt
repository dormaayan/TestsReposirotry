public static class URLRewritingServlet extends HttpServlet {
  @Override protected void doGet(  HttpServletRequest req,  HttpServletResponse resp) throws ServletException, IOException {
    HttpSession session=req.getSession(true);
    Object existing=session.getAttribute(COUNT);
    if (existing == null) {
      session.setAttribute(COUNT,0);
    }
 else {
      Assert.assertTrue(req.getRequestURI().startsWith("/servletContext/foo;"));
      Assert.assertTrue(req.getRequestURI().contains("jsessionid=" + session.getId()));
    }
    Integer count=(Integer)session.getAttribute(COUNT);
    resp.addHeader(COUNT,count.toString());
    session.setAttribute(COUNT,++count);
    for (    Map.Entry<String,String[]> qp : req.getParameterMap().entrySet()) {
      resp.addHeader(qp.getKey(),qp.getValue()[0]);
    }
    if (req.getQueryString() == null) {
      resp.getWriter().write(resp.encodeURL(DefaultServer.getDefaultServerURL() + req.getRequestURI()));
    }
 else {
      resp.getWriter().write(resp.encodeURL(DefaultServer.getDefaultServerURL() + req.getRequestURI() + "?"+ req.getQueryString()));
    }
  }
}

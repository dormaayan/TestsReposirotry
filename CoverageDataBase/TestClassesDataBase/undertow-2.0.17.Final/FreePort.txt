private static class FreePort {
  static int find(){
    int port=0;
    while (port == 0) {
      ServerSocket socket=null;
      try {
        socket=new ServerSocket(0);
        port=socket.getLocalPort();
      }
 catch (      IOException e) {
        throw new RuntimeException("Failed finding free port",e);
      }
 finally {
        try {
          if (socket != null)           socket.close();
        }
 catch (        IOException ignore) {
        }
      }
    }
    return port;
  }
}

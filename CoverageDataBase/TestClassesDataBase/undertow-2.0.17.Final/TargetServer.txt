private static class TargetServer {
  private final int port=FreePort.find();
  private final Undertow server;
  final String uri="http://localhost:" + port;
  private final LinkedBlockingQueue<String> gotRequestQueue=new LinkedBlockingQueue<>();
  TargetServer(){
    server=Undertow.builder().addHttpListener(port,"0.0.0.0").setHandler(new HttpHandler(){
      @Override public void handleRequest(      HttpServerExchange exchange) throws Exception {
        gotRequestQueue.add(URI.create(exchange.getRequestURL()).getPath());
      }
    }
).build();
    server.start();
  }
  void stop(){
    server.stop();
  }
  String gotRequest(  boolean wait){
    String url=null;
    try {
      url=gotRequestQueue.poll(wait ? 10000 : 10,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      throw new RuntimeException(e);
    }
    return url;
  }
}

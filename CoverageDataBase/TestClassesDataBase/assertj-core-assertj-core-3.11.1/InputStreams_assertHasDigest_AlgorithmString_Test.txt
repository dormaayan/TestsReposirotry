/** 
 * Tests for <code> {@link InputStreams#assertHasDigest(AssertionInfo,InputStream,String,String)}</code>
 * @author Valeriy Vyrva
 */
public class InputStreams_assertHasDigest_AlgorithmString_Test extends InputStreamsBaseTest {
  private static final String MD5="MD5";
  private final String expected="";
  private static final String RED_PNG_DIGEST="3AC1AFA2A89B7E4F1866502877BF1DC5";
  @Test public void should_fail_if_actual_is_null(){
    assertThatExceptionOfType(AssertionError.class).isThrownBy(() -> inputStreams.assertHasDigest(INFO,null,MD5,expected)).withMessage(actualIsNull());
  }
  @Test public void should_throw_error_if_digest_is_null(){
    assertThatNullPointerException().isThrownBy(() -> inputStreams.assertHasDigest(INFO,null,(MessageDigest)null,expected)).withMessage("The message digest algorithm should not be null");
  }
  @Test public void should_throw_error_if_expected_is_null(){
    assertThatNullPointerException().isThrownBy(() -> inputStreams.assertHasDigest(INFO,null,MD5,(byte[])null)).withMessage("The binary representation of digest to compare to should not be null");
  }
  @Test public void should_throw_error_wrapping_catched_IOException() throws IOException {
    IOException cause=new IOException();
    actual=mock(InputStream.class);
    given(actual.read(any())).willThrow(cause);
    Throwable error=catchThrowable(() -> inputStreams.assertHasDigest(INFO,actual,MD5,expected));
    assertThat(error).isInstanceOf(InputStreamsException.class).hasCause(cause);
  }
  @Test public void should_fail_if_actual_does_not_have_expected_digest() throws NoSuchAlgorithmException {
    actual=getClass().getResourceAsStream("/red.png");
    catchThrowable(() -> inputStreams.assertHasDigest(INFO,actual,MD5,expected));
    verify(failures).failure(INFO,shouldHaveDigest(actual,new DigestDiff(RED_PNG_DIGEST,"",MessageDigest.getInstance(MD5))));
  }
  @Test public void should_pass_if_actual_has_expected_digest(){
    actual=getClass().getResourceAsStream("/red.png");
    inputStreams.assertHasDigest(INFO,actual,MD5,Digests.fromHex(RED_PNG_DIGEST));
  }
}

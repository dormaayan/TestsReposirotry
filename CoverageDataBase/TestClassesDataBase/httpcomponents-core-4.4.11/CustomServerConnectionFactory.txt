static class CustomServerConnectionFactory extends ServerConnectionFactory {
  public CustomServerConnectionFactory(){
    super();
  }
  @Override public DefaultNHttpServerConnection createConnection(  final IOSession session){
    return new LoggingNHttpServerConnection(session){
      @Override protected ContentEncoder createContentEncoder(      final long len,      final WritableByteChannel channel,      final SessionOutputBuffer buffer,      final HttpTransportMetricsImpl metrics){
        if (len == ContentLengthStrategy.CHUNKED) {
          return new BrokenChunkEncoder(channel,buffer,metrics);
        }
 else {
          return super.createContentEncoder(len,channel,buffer,metrics);
        }
      }
    }
;
  }
}

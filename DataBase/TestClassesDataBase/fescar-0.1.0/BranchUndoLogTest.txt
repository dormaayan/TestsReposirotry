public class BranchUndoLogTest {
  @Test public void testEncodeUndoLog(){
    BranchUndoLog branchUndoLog=new BranchUndoLog();
    branchUndoLog.setBranchId(641789253L);
    branchUndoLog.setXid("xid:xxx");
    ArrayList<SQLUndoLog> items=new ArrayList<>();
    SQLUndoLog item=new SQLUndoLog();
    item.setSqlType(SQLType.UPDATE);
    TableMeta tableMeta=new TableMeta();
    tableMeta.setTableName("product");
    TableRecords beforeImage=new TableRecords(tableMeta);
    Row rowb=new Row();
    rowb.add(new Field("id",Types.INTEGER,1));
    rowb.add(new Field("name",Types.VARCHAR,"FESCAR"));
    rowb.add(new Field("since",Types.VARCHAR,"2014"));
    beforeImage.add(rowb);
    item.setBeforeImage(beforeImage);
    TableRecords afterImage=new TableRecords(tableMeta);
    Row rowa=new Row();
    rowa.add(new Field("id",Types.INTEGER,1));
    rowa.add(new Field("name",Types.VARCHAR,"GTS"));
    rowa.add(new Field("since",Types.VARCHAR,"2014"));
    afterImage.add(rowa);
    item.setAfterImage(afterImage);
    items.add(item);
    branchUndoLog.setSqlUndoLogs(items);
    String encodeString=UndoLogParserFactory.getInstance().encode(branchUndoLog);
    System.out.println(encodeString);
    BranchUndoLog decodeObj=UndoLogParserFactory.getInstance().decode(encodeString);
    Assert.assertEquals(decodeObj.getBranchId(),branchUndoLog.getBranchId());
  }
}

public class AboutJenkinsTest {
  @Rule public JenkinsRule j=new JenkinsRule();
  @Test @Issue("SECURITY-771") public void onlyAdminCanReadAbout() throws Exception {
    final String ADMIN="admin";
    final String USER="user";
    j.jenkins.setSecurityRealm(j.createDummySecurityRealm());
    j.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy().grant(Jenkins.ADMINISTER).everywhere().to(ADMIN).grant(Jenkins.READ).everywhere().to(USER));
    JenkinsRule.WebClient wc=j.createWebClient();
    wc.getOptions().setThrowExceptionOnFailingStatusCode(false);
{
      wc.login(USER);
      HtmlPage page=wc.goTo("about/");
      assertEquals(403,page.getWebResponse().getStatusCode());
    }
{
      wc.login(ADMIN);
      HtmlPage page=wc.goTo("about/");
      assertEquals(200,page.getWebResponse().getStatusCode());
      assertThat(page.getWebResponse().getContentAsString(),containsString("Mavenized dependencies"));
    }
  }
}

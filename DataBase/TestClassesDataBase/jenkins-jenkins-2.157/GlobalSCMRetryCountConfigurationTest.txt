/** 
 * Tests of  {@link GlobalSCMRetryCountConfiguration}.
 * @author Panagiotis Galatsanos
 */
public class GlobalSCMRetryCountConfigurationTest {
  @Rule public JenkinsRule j=new JenkinsRule();
  @Test @Issue("JENKINS-36387") public void shouldExceptOnNullScmRetryCount() throws Exception {
    try {
      JSONObject json=new JSONObject();
      GlobalSCMRetryCountConfiguration gc=(GlobalSCMRetryCountConfiguration)GlobalConfiguration.all().getDynamic("jenkins.model.GlobalSCMRetryCountConfiguration");
      json.element("scmCheckoutRetryCount",5);
      gc.configure(Stapler.getCurrentRequest(),json);
      assertThat("Wrong value, it should be equal to 5",j.getInstance().getScmCheckoutRetryCount(),equalTo(5));
      json.element("scmCheckoutRetryCount",3);
      gc.configure(Stapler.getCurrentRequest(),json);
      assertThat("Wrong value, it should be equal to 3",j.getInstance().getScmCheckoutRetryCount(),equalTo(3));
      JSONObject emptyJson=new JSONObject();
      gc.configure(Stapler.getCurrentRequest(),emptyJson);
    }
 catch (    Descriptor.FormException e) {
      assertThat("Scm Retry count value changed! This shouldn't happen.",j.getInstance().getScmCheckoutRetryCount(),equalTo(3));
    }
  }
}

/** 
 * Tests to verify the behavior of failing to fully start transition HA states.
 */
public class TestStateTransitionFailure {
  /** 
 * Ensure that a failure to fully transition to the active state causes a shutdown of the NameNode.
 */
  @Test public void testFailureToTransitionCausesShutdown() throws IOException {
    MiniDFSCluster cluster=null;
    try {
      Configuration conf=new Configuration();
      conf.setLong(CommonConfigurationKeys.FS_TRASH_INTERVAL_KEY,-1);
      cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(0).checkExitOnShutdown(false).build();
      cluster.waitActive();
      try {
        cluster.transitionToActive(0);
        fail("Transitioned to active but should not have been able to.");
      }
 catch (      ExitException ee) {
        assertExceptionContains("Cannot start trash emptier with negative interval",ee);
      }
    }
  finally {
      if (cluster != null) {
        cluster.shutdown();
      }
    }
  }
}

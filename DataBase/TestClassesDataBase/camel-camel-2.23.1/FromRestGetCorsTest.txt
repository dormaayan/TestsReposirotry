public class FromRestGetCorsTest extends ContextTestSupport {
  @Override protected JndiRegistry createRegistry() throws Exception {
    JndiRegistry jndi=super.createRegistry();
    jndi.bind("dummy-rest",new DummyRestConsumerFactory());
    return jndi;
  }
  @Test public void testCors() throws Exception {
    getMockEndpoint("mock:update").expectedMessageCount(1);
    Exchange out=template.request("seda:post-say-bye",new Processor(){
      @Override public void process(      Exchange exchange) throws Exception {
        exchange.getIn().setBody("I was here");
      }
    }
);
    assertNotNull(out);
    assertEquals(out.getOut().getHeader("Access-Control-Allow-Origin"),RestConfiguration.CORS_ACCESS_CONTROL_ALLOW_ORIGIN);
    assertEquals(out.getOut().getHeader("Access-Control-Allow-Methods"),RestConfiguration.CORS_ACCESS_CONTROL_ALLOW_METHODS);
    assertEquals(out.getOut().getHeader("Access-Control-Allow-Headers"),RestConfiguration.CORS_ACCESS_CONTROL_ALLOW_HEADERS);
    assertEquals(out.getOut().getHeader("Access-Control-Max-Age"),RestConfiguration.CORS_ACCESS_CONTROL_MAX_AGE);
    assertMockEndpointsSatisfied();
  }
  @Override protected RouteBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        restConfiguration().host("localhost").enableCORS(true);
        rest("/say/hello").get().to("direct:hello");
        rest("/say/bye").get().consumes("application/json").to("direct:bye").post().to("mock:update");
        from("direct:hello").transform().constant("Hello World");
        from("direct:bye").transform().constant("Bye World");
      }
    }
;
  }
}

@ContextConfiguration public class BindyComplexCsvGenerateHeaderMarshallTest extends AbstractJUnit4SpringContextTests {
  private List<Map<String,Object>> models=new ArrayList<>();
  private String result="Order Nr,Client Nr,First Name,Last Name,Instrument Code,Instrument Nr,Order Type,Instrument Type,amount,currency,Order Date\r\n" + "10,A1,Julia,Roberts,ISIN,LU123456789,BUY,Share,150.00,USD,14-01-2009\r\n";
  @Produce(uri="direct:start") private ProducerTemplate template;
  @EndpointInject(uri="mock:result") private MockEndpoint resultEndpoint;
  @Test public void testMarshallMessage() throws Exception {
    resultEndpoint.expectedBodiesReceived(result);
    template.sendBody(generateModel());
    resultEndpoint.assertIsSatisfied();
  }
  private List<Map<String,Object>> generateModel(){
    Map<String,Object> model=new HashMap<>();
    Order order=new Order();
    order.setOrderNr(10);
    order.setAmount(new BigDecimal("150"));
    order.setOrderType("BUY");
    order.setInstrumentType("Share");
    order.setCurrency("USD");
    Calendar calendar=new GregorianCalendar();
    calendar.set(2009,0,14);
    order.setOrderDate(calendar.getTime());
    Client client=new Client();
    client.setClientNr("A1");
    client.setFirstName("Julia");
    client.setLastName("Roberts");
    order.setClient(client);
    Security security=new Security();
    security.setInstrumentCode("ISIN");
    security.setInstrumentNumber("LU123456789");
    order.setSecurity(security);
    model.put(order.getClass().getName(),order);
    model.put(client.getClass().getName(),client);
    model.put(security.getClass().getName(),security);
    models.add(0,model);
    return models;
  }
public static class ContextConfig extends RouteBuilder {
    public void configure(){
      BindyCsvDataFormat camelDataFormat=new BindyCsvDataFormat(org.apache.camel.dataformat.bindy.model.complex.generateheader.Order.class);
      camelDataFormat.setLocale("en");
      from("direct:start").marshal(camelDataFormat).to("mock:result");
    }
  }
}

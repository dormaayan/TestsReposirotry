public class ReferenceCountTest {
  @Test public void testReferenceCount(){
    AtomicInteger cnt=new AtomicInteger(0);
    ReferenceCount ref=ReferenceCount.on(cnt::incrementAndGet,cnt::decrementAndGet);
    ref.retain();
    Assert.assertEquals(1,ref.get());
    Assert.assertEquals(1,cnt.get());
    ref.retain();
    Assert.assertEquals(2,ref.get());
    Assert.assertEquals(1,cnt.get());
    ref.release();
    Assert.assertEquals(1,ref.get());
    Assert.assertEquals(1,cnt.get());
    ref.release();
    Assert.assertEquals(0,ref.get());
    Assert.assertEquals(0,cnt.get());
  }
}

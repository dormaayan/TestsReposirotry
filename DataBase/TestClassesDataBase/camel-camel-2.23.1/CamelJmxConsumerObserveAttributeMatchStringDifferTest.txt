public class CamelJmxConsumerObserveAttributeMatchStringDifferTest extends CamelTestSupport {
  @Override protected boolean useJmx(){
    return true;
  }
  @Test public void testJmxConsumer() throws Exception {
    getMockEndpoint("mock:result").expectedMinimumMessageCount(1);
    getMockEndpoint("mock:result").message(0).body().contains("<newValue>false</newValue>");
    getMockEndpoint("mock:result").message(0).body().contains("<attributeName>Tracing</attributeName>");
    ManagedRouteMBean mr=context.getManagedRoute("foo",ManagedRouteMBean.class);
    mr.setStatisticsEnabled(true);
    mr=context.getManagedRoute("foo",ManagedRouteMBean.class);
    mr.setTracing(true);
    mr=context.getManagedRoute("foo",ManagedRouteMBean.class);
    mr.setTracing(false);
    mr=context.getManagedRoute("foo",ManagedRouteMBean.class);
    mr.setTracing(true);
    assertMockEndpointsSatisfied();
  }
  @Override protected RoutesBuilder createRouteBuilder() throws Exception {
    return new RouteBuilder(){
      @Override public void configure() throws Exception {
        String id=getContext().getName();
        fromF("jmx:platform?objectDomain=org.apache.camel&key.context=%s&key.type=routes&key.name=\"foo\"&observedAttribute=Tracing&stringToCompare=true&notifyDiffer=true",id).routeId("jmxRoute").to("log:jmx").to("mock:result");
        from("direct:foo").routeId("foo").to("log:foo","mock:foo");
      }
    }
;
  }
}

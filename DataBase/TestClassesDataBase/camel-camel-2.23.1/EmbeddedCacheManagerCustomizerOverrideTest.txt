@RunWith(SpringRunner.class) @DirtiesContext @SpringBootApplication @SpringBootTest(classes={EmbeddedCacheManagerCustomizerOverrideTest.TestConfiguration.class},properties={"debug=false","infinispan.embedded.enabled=false","infinispan.remote.enabled=false","camel.component.infinispan.customizer.embedded-cache-manager.enabled=true","camel.component.infinispan.customizer.embedded-cache-manager.override=true","camel.component.infinispan.customizer.remote-cache-manager.enabled=false"}) public class EmbeddedCacheManagerCustomizerOverrideTest {
  private static final EmbeddedCacheManager CACHE_MANAGER=CacheManagerCustomizerTestSupport.newEmbeddedCacheManagerInstance();
  @Autowired EmbeddedCacheManager cacheManager;
  @Autowired InfinispanComponent component;
  @Test public void testComponentConfiguration() throws Exception {
    Assert.assertNotNull(cacheManager);
    Assert.assertNotNull(component);
    Assert.assertNotNull(component.getCacheContainer());
    Assert.assertEquals(cacheManager,component.getCacheContainer());
  }
@Configuration @AutoConfigureAfter(CamelAutoConfiguration.class) @AutoConfigureBefore(InfinispanComponentAutoConfiguration.class) public static class TestConfiguration {
    @Order(Ordered.HIGHEST_PRECEDENCE) @Bean public ComponentCustomizer<InfinispanComponent> customizer(){
      return new ComponentCustomizer<InfinispanComponent>(){
        @Override public void customize(        InfinispanComponent component){
          component.setCacheContainer(CACHE_MANAGER);
        }
      }
;
    }
    @Bean(destroyMethod="stop") public EmbeddedCacheManager embeddedCacheManagerInstance(){
      return CacheManagerCustomizerTestSupport.newEmbeddedCacheManagerInstance();
    }
  }
}

@ContextConfiguration public class CamelGreeterConsumerTest extends AbstractJUnit4SpringContextTests {
  private static int port=AvailablePortFinder.getNextAvailable(20001);
static {
    System.setProperty("CamelGreeterConsumerTest.port",Integer.toString(port));
  }
  @Autowired protected CamelContext camelContext;
  @Test public void testInvokeServers() throws Exception {
    assertNotNull(camelContext);
    ProducerTemplate template=camelContext.createProducerTemplate();
    List<String> params=new ArrayList<>();
    params.add("Willem");
    Object result=template.sendBodyAndHeader("cxf://bean:serviceEndpoint",ExchangePattern.InOut,params,CxfConstants.OPERATION_NAME,"greetMe");
    assertTrue("Result is a list instance ",result instanceof List);
    assertEquals("Get the wrong response",((List<?>)result).get(0),"HelloWillem");
    try {
      template.sendBodyAndHeader("cxf://bean:serviceEndpoint",ExchangePattern.InOut,params,CxfConstants.OPERATION_NAME,"pingMe");
      fail("Expect exception here.");
    }
 catch (    Exception ex) {
      assertTrue("Get a wrong exception.",ex instanceof CamelExecutionException);
      assertTrue("Get a wrong exception cause. ",ex.getCause() instanceof PingMeFault);
    }
    template.stop();
  }
}

public class HawtDBAggregationRepositoryTest extends CamelTestSupport {
  private HawtDBFile hawtDBFile;
  @Override @Before public void setUp() throws Exception {
    super.setUp();
    deleteDirectory("target/data");
    File file=new File("target/data/hawtdb.dat");
    hawtDBFile=new HawtDBFile();
    hawtDBFile.setFile(file);
    hawtDBFile.start();
  }
  @Override @After public void tearDown() throws Exception {
    hawtDBFile.stop();
    super.tearDown();
  }
  @Test public void testOperations(){
    HawtDBAggregationRepository repo=new HawtDBAggregationRepository();
    repo.setHawtDBFile(hawtDBFile);
    repo.setRepositoryName("repo1");
    repo.setReturnOldExchange(true);
    Exchange actual=repo.get(context,"missing");
    assertEquals(null,actual);
    Exchange exchange1=new DefaultExchange(context);
    exchange1.getIn().setBody("counter:1");
    actual=repo.add(context,"foo",exchange1);
    assertEquals(null,actual);
    actual=repo.get(context,"foo");
    assertEquals("counter:1",actual.getIn().getBody());
    Exchange exchange2=new DefaultExchange(context);
    exchange2.getIn().setBody("counter:2");
    actual=repo.add(context,"foo",exchange2);
    assertEquals("counter:1",actual.getIn().getBody());
    actual=repo.get(context,"foo");
    assertEquals("counter:2",actual.getIn().getBody());
    repo.remove(context,"foo",actual);
    actual=repo.get(context,"foo");
    assertEquals(null,actual);
    exchange1=new DefaultExchange(context);
    exchange1.getIn().setBody("counter:3");
    actual=repo.add(context,"foo",exchange1);
    assertEquals(null,actual);
    actual=repo.get(context,"foo");
    assertEquals("counter:3",actual.getIn().getBody());
  }
}

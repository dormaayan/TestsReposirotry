public class ConfigurableStandalonePageCacheFactoryTest {
  @Rule public VerboseTimeout timeout=VerboseTimeout.builder().withTimeout(30,TimeUnit.SECONDS).build();
  @Rule public TestDirectory testDirectory=TestDirectory.testDirectory();
  @Test public void mustAutomaticallyStartEvictionThread() throws Exception {
    try (FileSystemAbstraction fs=new DefaultFileSystemAbstraction();JobScheduler jobScheduler=new ThreadPoolJobScheduler()){
      File file=new File(testDirectory.directory(),"a").getCanonicalFile();
      fs.create(file).close();
      try (PageCache cache=ConfigurableStandalonePageCacheFactory.createPageCache(fs,jobScheduler);PagedFile pf=cache.map(file,4096);PageCursor cursor=pf.io(0,PagedFile.PF_SHARED_WRITE_LOCK)){
        for (int i=0; i < 10_000; i++) {
          assertTrue(cursor.next());
          cursor.putInt(42);
        }
      }
     }
   }
}

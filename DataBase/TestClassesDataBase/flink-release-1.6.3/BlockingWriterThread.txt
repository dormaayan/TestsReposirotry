private static final class BlockingWriterThread extends BlockingThread {
  private final LimitedConnectionsFileSystem fs;
  private final Path path;
  private final int maxConcurrentOutputStreams;
  private final int maxConcurrentStreamsTotal;
  BlockingWriterThread(  LimitedConnectionsFileSystem fs,  Path path,  int maxConcurrentOutputStreams,  int maxConcurrentStreamsTotal){
    this.fs=fs;
    this.path=path;
    this.maxConcurrentOutputStreams=maxConcurrentOutputStreams;
    this.maxConcurrentStreamsTotal=maxConcurrentStreamsTotal;
  }
  @Override public void go() throws Exception {
    try (FSDataOutputStream stream=fs.create(path,WriteMode.OVERWRITE)){
      assertTrue(fs.getNumberOfOpenOutputStreams() <= maxConcurrentOutputStreams);
      assertTrue(fs.getTotalNumberOfOpenStreams() <= maxConcurrentStreamsTotal);
      final Random rnd=new Random();
      final byte[] data=new byte[rnd.nextInt(10000) + 1];
      rnd.nextBytes(data);
      stream.write(data);
      waitTillWokenUp();
      stream.write(rnd.nextInt());
    }
   }
}

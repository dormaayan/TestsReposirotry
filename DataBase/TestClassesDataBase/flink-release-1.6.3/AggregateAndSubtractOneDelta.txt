@SuppressWarnings("serial") private static final class AggregateAndSubtractOneDelta extends RichMapFunction<Tuple2<Integer,Integer>,Tuple2<Integer,Integer>> {
  private LongSumAggregator aggr;
  private LongValue previousAggr;
  private int superstep;
  @Override public void open(  Configuration conf){
    aggr=getIterationRuntimeContext().getIterationAggregator(NEGATIVE_ELEMENTS_AGGR);
    superstep=getIterationRuntimeContext().getSuperstepNumber();
    if (superstep > 1) {
      previousAggr=getIterationRuntimeContext().getPreviousIterationAggregate(NEGATIVE_ELEMENTS_AGGR);
      Assert.assertEquals(superstep - 1,previousAggr.getValue());
    }
  }
  @Override public Tuple2<Integer,Integer> map(  Tuple2<Integer,Integer> value){
    if (value.f1 == 1) {
      aggr.aggregate(1L);
    }
    value.f1--;
    return value;
  }
}

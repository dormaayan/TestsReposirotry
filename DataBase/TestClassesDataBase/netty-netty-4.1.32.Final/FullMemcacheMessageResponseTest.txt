public class FullMemcacheMessageResponseTest {
  private EmbeddedChannel channel;
  @Before public void setup() throws Exception {
    channel=new EmbeddedChannel(new BinaryMemcacheResponseEncoder(),new BinaryMemcacheResponseDecoder(),new BinaryMemcacheObjectAggregator(1024));
  }
  @After public void teardown() throws Exception {
    assertFalse(channel.finish());
  }
  @Test public void testEncodeDecode() throws Exception {
    ByteBuf key=Unpooled.wrappedBuffer("key".getBytes(CharsetUtil.UTF_8));
    ByteBuf content=Unpooled.wrappedBuffer("content".getBytes(CharsetUtil.UTF_8));
    ByteBuf extras=Unpooled.wrappedBuffer("extras".getBytes(CharsetUtil.UTF_8));
    FullBinaryMemcacheResponse resp=new DefaultFullBinaryMemcacheResponse(key,extras,content);
    assertTrue(channel.writeOutbound(resp));
    assertEquals(2,channel.outboundMessages().size());
    assertTrue(channel.writeInbound(channel.readOutbound(),channel.readOutbound()));
    FullBinaryMemcacheResponse read=channel.readInbound();
    assertEquals("key",read.key().toString(CharsetUtil.UTF_8));
    assertEquals("content",read.content().toString(CharsetUtil.UTF_8));
    assertEquals("extras",read.extras().toString(CharsetUtil.UTF_8));
    read.release();
  }
}

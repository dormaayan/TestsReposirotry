public class ObservableIgnoreElementsTest {
  @Test public void testWithEmptyObservable(){
    assertTrue(Observable.empty().ignoreElements().toObservable().isEmpty().blockingGet());
  }
  @Test public void testWithNonEmptyObservable(){
    assertTrue(Observable.just(1,2,3).ignoreElements().toObservable().isEmpty().blockingGet());
  }
  @Test public void testUpstreamIsProcessedButIgnoredObservable(){
    final int num=10;
    final AtomicInteger upstreamCount=new AtomicInteger();
    long count=Observable.range(1,num).doOnNext(new Consumer<Integer>(){
      @Override public void accept(      Integer t){
        upstreamCount.incrementAndGet();
      }
    }
).ignoreElements().toObservable().count().blockingGet();
    assertEquals(num,upstreamCount.get());
    assertEquals(0,count);
  }
  @Test public void testCompletedOkObservable(){
    TestObserver<Object> to=new TestObserver<Object>();
    Observable.range(1,10).ignoreElements().toObservable().subscribe(to);
    to.assertNoErrors();
    to.assertNoValues();
    to.assertTerminated();
  }
  @Test public void testErrorReceivedObservable(){
    TestObserver<Object> to=new TestObserver<Object>();
    TestException ex=new TestException("boo");
    Observable.error(ex).ignoreElements().toObservable().subscribe(to);
    to.assertNoValues();
    to.assertTerminated();
    to.assertError(TestException.class);
    to.assertErrorMessage("boo");
  }
  @Test public void testUnsubscribesFromUpstreamObservable(){
    final AtomicBoolean unsub=new AtomicBoolean();
    Observable.range(1,10).concatWith(Observable.<Integer>never()).doOnDispose(new Action(){
      @Override public void run(){
        unsub.set(true);
      }
    }
).ignoreElements().toObservable().subscribe().dispose();
    assertTrue(unsub.get());
  }
  @Test public void testWithEmpty(){
    assertNull(Observable.empty().ignoreElements().blockingGet());
  }
  @Test public void testWithNonEmpty(){
    assertNull(Observable.just(1,2,3).ignoreElements().blockingGet());
  }
  @Test public void testUpstreamIsProcessedButIgnored(){
    final int num=10;
    final AtomicInteger upstreamCount=new AtomicInteger();
    Object count=Observable.range(1,num).doOnNext(new Consumer<Integer>(){
      @Override public void accept(      Integer t){
        upstreamCount.incrementAndGet();
      }
    }
).ignoreElements().blockingGet();
    assertEquals(num,upstreamCount.get());
    assertNull(count);
  }
  @Test public void testCompletedOk(){
    TestObserver<Object> to=new TestObserver<Object>();
    Observable.range(1,10).ignoreElements().subscribe(to);
    to.assertNoErrors();
    to.assertNoValues();
    to.assertTerminated();
  }
  @Test public void testErrorReceived(){
    TestObserver<Object> to=new TestObserver<Object>();
    TestException ex=new TestException("boo");
    Observable.error(ex).ignoreElements().subscribe(to);
    to.assertNoValues();
    to.assertTerminated();
    to.assertError(TestException.class);
    to.assertErrorMessage("boo");
  }
  @Test public void testUnsubscribesFromUpstream(){
    final AtomicBoolean unsub=new AtomicBoolean();
    Observable.range(1,10).concatWith(Observable.<Integer>never()).doOnDispose(new Action(){
      @Override public void run(){
        unsub.set(true);
      }
    }
).ignoreElements().subscribe().dispose();
    assertTrue(unsub.get());
  }
  @Test public void cancel(){
    PublishSubject<Integer> ps=PublishSubject.create();
    TestObserver<Integer> to=ps.ignoreElements().<Integer>toObservable().test();
    assertTrue(ps.hasObservers());
    to.cancel();
    assertFalse(ps.hasObservers());
    TestHelper.checkDisposed(ps.ignoreElements().<Integer>toObservable());
  }
  @Test public void dispose(){
    TestHelper.checkDisposed(Observable.just(1).ignoreElements());
    TestHelper.checkDisposed(Observable.just(1).ignoreElements().toObservable());
  }
}

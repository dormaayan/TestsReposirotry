/** 
 * Tests behavior of a FileNotFound error that happens after open(), i.e. on the first read.
 */
public class ITestS3ADelayedFNF extends AbstractS3ATestBase {
  /** 
 * See debugging documentation <a href="https://cwiki.apache.org/confluence/display/HADOOP/S3A%3A+FileNotFound+Exception+on+Read">here</a>.
 * @throws Exception
 */
  @Test public void testNotFoundFirstRead() throws Exception {
    FileSystem fs=getFileSystem();
    Path p=path("some-file");
    ContractTestUtils.createFile(fs,p,false,new byte[]{20,21,22});
    final FSDataInputStream in=fs.open(p);
    assertDeleted(p,false);
    LambdaTestUtils.intercept(FileNotFoundException.class,new Callable<Integer>(){
      @Override public Integer call() throws Exception {
        return in.read();
      }
    }
);
  }
}

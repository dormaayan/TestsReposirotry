/** 
 * Test RM Auth filter.
 */
public class TestRMAuthenticationFilter {
  @SuppressWarnings("unchecked") @Test public void testConfiguration() throws Exception {
    Configuration conf=new Configuration();
    conf.set("hadoop.http.authentication.foo","bar");
    conf.set("hadoop.proxyuser.user.foo","bar1");
    conf.set(HttpServer2.BIND_ADDRESS,"barhost");
    FilterContainer container=Mockito.mock(FilterContainer.class);
    Mockito.doAnswer(new Answer(){
      @Override public Object answer(      InvocationOnMock invocationOnMock) throws Throwable {
        Object[] args=invocationOnMock.getArguments();
        assertEquals("RMAuthenticationFilter",args[0]);
        assertEquals(RMAuthenticationFilter.class.getName(),args[1]);
        Map<String,String> conf=(Map<String,String>)args[2];
        assertEquals("/",conf.get("cookie.path"));
        assertEquals("simple",conf.get("type"));
        assertEquals("36000",conf.get("token.validity"));
        assertNull(conf.get("cookie.domain"));
        assertEquals("true",conf.get("simple.anonymous.allowed"));
        assertEquals("HTTP/barhost@LOCALHOST",conf.get("kerberos.principal"));
        assertEquals(System.getProperty("user.home") + "/hadoop.keytab",conf.get("kerberos.keytab"));
        assertEquals("bar",conf.get("foo"));
        assertEquals("bar1",conf.get("proxyuser.user.foo"));
        return null;
      }
    }
).when(container).addFilter(Mockito.<String>anyObject(),Mockito.<String>anyObject(),Mockito.<Map<String,String>>anyObject());
    new RMAuthenticationFilterInitializer().initFilter(container,conf);
  }
}

@Test public void secureResponseCaching() throws IOException {
  assumeFalse(getPlatform().equals("jdk9"));
  server.useHttps(handshakeCertificates.sslSocketFactory(),false);
  server.enqueue(new MockResponse().addHeader("Last-Modified: " + formatDate(-1,TimeUnit.HOURS)).addHeader("Expires: " + formatDate(1,TimeUnit.HOURS)).setBody("ABC"));
  HttpsURLConnection c1=(HttpsURLConnection)urlFactory.open(server.url("/").url());
  c1.setSSLSocketFactory(handshakeCertificates.sslSocketFactory());
  c1.setHostnameVerifier(NULL_HOSTNAME_VERIFIER);
  assertEquals("ABC",readAscii(c1));
  String suite=c1.getCipherSuite();
  List<Certificate> localCerts=toListOrNull(c1.getLocalCertificates());
  List<Certificate> serverCerts=toListOrNull(c1.getServerCertificates());
  Principal peerPrincipal=c1.getPeerPrincipal();
  Principal localPrincipal=c1.getLocalPrincipal();
  HttpsURLConnection c2=(HttpsURLConnection)urlFactory.open(server.url("/").url());
  c2.setSSLSocketFactory(handshakeCertificates.sslSocketFactory());
  c2.setHostnameVerifier(NULL_HOSTNAME_VERIFIER);
  assertEquals("ABC",readAscii(c2));
  assertEquals(2,cache.requestCount());
  assertEquals(1,cache.networkCount());
  assertEquals(1,cache.hitCount());
  assertEquals(suite,c2.getCipherSuite());
  assertEquals(localCerts,toListOrNull(c2.getLocalCertificates()));
  assertEquals(serverCerts,toListOrNull(c2.getServerCertificates()));
  assertEquals(peerPrincipal,c2.getPeerPrincipal());
  assertEquals(localPrincipal,c2.getLocalPrincipal());
}

@Test void shiftBytesMustShiftBytesToTheLeftNotOverlapping() throws Exception {
  configureStandardPageCache();
  try (PagedFile pf=map(file("a"),filePageSize);PageCursor cursor=pf.io(0,PF_SHARED_WRITE_LOCK)){
    assertTrue(cursor.next());
    byte[] bytes=new byte[30];
    for (int i=0; i < bytes.length; i++) {
      bytes[i]=(byte)(i + 1);
    }
    int srcOffset=filePageSize - bytes.length - 10;
    cursor.setOffset(srcOffset);
    cursor.putBytes(bytes);
    int gap=5;
    int shift=-bytes.length - gap;
    assertZeroes(cursor,0,srcOffset);
    assertZeroes(cursor,srcOffset + bytes.length,filePageSize - srcOffset - bytes.length);
    cursor.shiftBytes(srcOffset,bytes.length,shift);
    assertZeroes(cursor,0,srcOffset + shift);
    assertZeroes(cursor,srcOffset + bytes.length,filePageSize - srcOffset - bytes.length);
    cursor.setOffset(srcOffset + shift);
    for (int i=0; i < bytes.length; i++) {
      assertThat(cursor.getByte(),is((byte)(i + 1)));
    }
    assertZeroes(cursor,srcOffset + bytes.length + shift,gap);
    cursor.setOffset(srcOffset);
    for (int i=0; i < bytes.length; i++) {
      assertThat(cursor.getByte(),is((byte)(i + 1)));
    }
    assertFalse(cursor.checkAndClearBoundsFlag());
  }
 }

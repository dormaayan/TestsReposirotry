@Issue("JENKINS-27530") @Test public void reloadWhileBuildIsInQueue() throws Exception {
  FreeStyleProject p=r.createFreeStyleProject("p");
  p.getBuildersList().add(new SleepBuilder(9999999));
  r.jenkins.setNumExecutors(1);
  assertEquals(1,p.scheduleBuild2(0).waitForStart().number);
  p.scheduleBuild2(0);
  r.jenkins.reload();
  p=r.jenkins.getItemByFullName("p",FreeStyleProject.class);
  FreeStyleBuild b1=p.getLastBuild();
  assertEquals(1,b1.getNumber());
  Queue.Item[] items=Queue.getInstance().getItems();
  assertEquals(1,items.length);
  assertEquals(p,items[0].task);
  QueueTaskFuture<Queue.Executable> b2f=items[0].getFuture();
  b1.getExecutor().interrupt();
  r.assertBuildStatus(Result.ABORTED,r.waitForCompletion(b1));
  FreeStyleBuild b2=(FreeStyleBuild)b2f.waitForStart();
  assertEquals(2,b2.getNumber());
  assertEquals(p,b2.getParent());
  b2.getExecutor().interrupt();
  r.assertBuildStatus(Result.ABORTED,r.waitForCompletion(b2));
  FreeStyleBuild b3=p.scheduleBuild2(0).waitForStart();
  assertEquals(3,b3.getNumber());
  assertEquals(p,b3.getParent());
  b3.getExecutor().interrupt();
  r.assertBuildStatus(Result.ABORTED,r.waitForCompletion(b3));
}

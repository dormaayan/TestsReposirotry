@Test public void cancelQuietDownShouldSuccessOnQuietDownedJenkinsAndRunningExecutor() throws Exception {
  final FreeStyleProject project=j.createFreeStyleProject("aProject");
  final OneShotEvent finish=new OneShotEvent();
  Future<FreeStyleBuild> build=OnlineNodeCommandTest.startBlockingAndFinishingBuild(project,finish);
  assertThat(((FreeStyleProject)j.jenkins.getItem("aProject")).getBuilds(),hasSize(1));
  assertThat(project.isBuilding(),equalTo(true));
  j.jenkins.getActiveInstance().doQuietDown();
  QuietDownCommandTest.assertJenkinsInQuietMode(j);
  final CLICommandInvoker.Result result=command.authorizedTo(Jenkins.READ,Jenkins.ADMINISTER).invoke();
  assertThat(result,succeededSilently());
  QuietDownCommandTest.assertJenkinsNotInQuietMode(j);
  finish.signal();
  build.get();
  assertThat(((FreeStyleProject)j.jenkins.getItem("aProject")).getBuilds(),hasSize(1));
  assertThat(project.isBuilding(),equalTo(false));
  j.assertBuildStatusSuccess(build);
  QuietDownCommandTest.assertJenkinsNotInQuietMode(j);
  build=OnlineNodeCommandTest.startBlockingAndFinishingBuild(project,finish);
  assertThat(((FreeStyleProject)j.jenkins.getItem("aProject")).getBuilds(),hasSize(2));
  assertThat(project.isBuilding(),equalTo(true));
  finish.signal();
  build.get();
  assertThat(((FreeStyleProject)j.jenkins.getItem("aProject")).getBuilds(),hasSize(2));
  assertThat(project.isBuilding(),equalTo(false));
  j.assertBuildStatusSuccess(build);
  QuietDownCommandTest.assertJenkinsNotInQuietMode(j);
}

@Test @Issue("SECURITY-765") public void checkSanitizationIsApplied_inDescriptor() throws Exception {
  logging.record("",Level.WARNING).capture(100);
  j.jenkins.setCrumbIssuer(null);
  JenkinsRule.WebClient wc=j.createWebClient();
  wc.getOptions().setThrowExceptionOnFailingStatusCode(false);
  HtmlPage page=wc.goTo("testDescribable");
  String secret="s3cr3t";
  ((HtmlInput)page.getElementById("password")).setValueAttribute(secret);
  HtmlForm form=page.getFormByName("config");
  Page formSubmitPage=j.submit(form);
  assertThat(formSubmitPage.getWebResponse().getContentAsString(),allOf(containsString(RedactSecretJsonInErrorMessageSanitizer.REDACT_VALUE),not(containsString(secret))));
  Throwable thrown=logging.getRecords().stream().filter(r -> r.getMessage().contains("Error while serving")).findAny().get().getThrown();
  assertThat(thrown.getCause().getMessage(),allOf(containsString(RedactSecretJsonInErrorMessageSanitizer.REDACT_VALUE),not(containsString(secret))));
  assertThat(thrown.getCause().getCause().getMessage(),allOf(containsString(RedactSecretJsonInErrorMessageSanitizer.REDACT_VALUE),not(containsString(secret))));
  StringWriter buffer=new StringWriter();
  thrown.printStackTrace(new PrintWriter(buffer));
  String fullStack=buffer.getBuffer().toString();
  assertThat(fullStack,allOf(containsString(RedactSecretJsonInErrorMessageSanitizer.REDACT_VALUE),not(containsString(secret))));
}

@ThreadLeakLingering(linger=1000) @Test public void testRecommenderWithToyData() throws Exception {
  setUpToyData();
  factorizer=new ParallelSGDFactorizer(dataModel,rank,lambda,numIterations,0.01,1,0,0);
  svdRecommender=new SVDRecommender(dataModel,factorizer);
  RunningAverage avg=new FullRunningAverage();
  LongPrimitiveIterator userIDs=dataModel.getUserIDs();
  while (userIDs.hasNext()) {
    long userID=userIDs.nextLong();
    for (    Preference pref : dataModel.getPreferencesFromUser(userID)) {
      double rating=pref.getValue();
      double estimate=svdRecommender.estimatePreference(userID,pref.getItemID());
      double err=rating - estimate;
      avg.addDatum(err * err);
    }
  }
  double rmse=Math.sqrt(avg.getAverage());
  logger.info("rmse: " + rmse);
  assertTrue(rmse < 0.2);
}

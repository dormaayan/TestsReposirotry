@Test public void testUpgradeTrailers() throws Exception {
  EmbeddedChannel ch=new EmbeddedChannel(new Http2StreamFrameToHttpObjectCodec(true));
  LastHttpContent trailers=new DefaultLastHttpContent(Unpooled.EMPTY_BUFFER,true);
  HttpHeaders headers=trailers.trailingHeaders();
  headers.set("key","value");
  assertTrue(ch.writeOutbound(trailers));
  Http2HeadersFrame headerFrame=ch.readOutbound();
  assertThat(headerFrame.headers().get("key").toString(),is("value"));
  assertTrue(headerFrame.isEndStream());
  assertThat(ch.readOutbound(),is(nullValue()));
  assertFalse(ch.finish());
}

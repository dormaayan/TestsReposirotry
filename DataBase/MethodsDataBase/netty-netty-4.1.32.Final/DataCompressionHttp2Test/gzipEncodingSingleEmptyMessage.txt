@Test public void gzipEncodingSingleEmptyMessage() throws Exception {
  final String text="";
  final ByteBuf data=Unpooled.copiedBuffer(text.getBytes());
  bootstrapEnv(data.readableBytes());
  try {
    final Http2Headers headers=new DefaultHttp2Headers().method(POST).path(PATH).set(HttpHeaderNames.CONTENT_ENCODING,HttpHeaderValues.GZIP);
    runInChannel(clientChannel,new Http2Runnable(){
      @Override public void run() throws Http2Exception {
        clientEncoder.writeHeaders(ctxClient(),3,headers,0,false,newPromiseClient());
        clientEncoder.writeData(ctxClient(),3,data.retain(),0,true,newPromiseClient());
        clientHandler.flush(ctxClient());
      }
    }
);
    awaitServer();
    assertEquals(text,serverOut.toString(CharsetUtil.UTF_8.name()));
  }
  finally {
    data.release();
  }
}

@Test public void testPuttingBackChunksAfterFlushing() throws UnexpectedStateException {
  byte[] row=Bytes.toBytes("testrow");
  byte[] fam=Bytes.toBytes("testfamily");
  byte[] qf1=Bytes.toBytes("testqualifier1");
  byte[] qf2=Bytes.toBytes("testqualifier2");
  byte[] qf3=Bytes.toBytes("testqualifier3");
  byte[] qf4=Bytes.toBytes("testqualifier4");
  byte[] qf5=Bytes.toBytes("testqualifier5");
  byte[] val=Bytes.toBytes("testval");
  DefaultMemStore memstore=new DefaultMemStore();
  memstore.add(new KeyValue(row,fam,qf1,val),null);
  memstore.add(new KeyValue(row,fam,qf2,val),null);
  memstore.add(new KeyValue(row,fam,qf3,val),null);
  MemStoreSnapshot snapshot=memstore.snapshot();
  assertEquals(3,memstore.getSnapshot().getCellsCount());
  assertEquals(0,memstore.getActive().getCellsCount());
  memstore.add(new KeyValue(row,fam,qf4,val),null);
  memstore.add(new KeyValue(row,fam,qf5,val),null);
  assertEquals(2,memstore.getActive().getCellsCount());
  for (  KeyValueScanner scanner : snapshot.getScanners()) {
    scanner.close();
  }
  memstore.clearSnapshot(snapshot.getId());
  int chunkCount=chunkCreator.getPoolSize();
  assertTrue(chunkCount > 0);
}

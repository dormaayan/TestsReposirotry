@Test public void test() throws Exception {
  try (Connection conn=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());Table table=conn.getTable(TableName.META_TABLE_NAME)){
    CoprocessorRpcChannel rpcChannel=table.coprocessorService(HConstants.EMPTY_START_ROW);
    AuthenticationProtos.AuthenticationService.BlockingInterface service=AuthenticationProtos.AuthenticationService.newBlockingStub(rpcChannel);
    WhoAmIResponse response=service.whoAmI(null,WhoAmIRequest.getDefaultInstance());
    assertEquals(USERNAME,response.getUsername());
    assertEquals(AuthenticationMethod.TOKEN.name(),response.getAuthMethod());
    try {
      service.getAuthenticationToken(null,GetAuthenticationTokenRequest.getDefaultInstance());
    }
 catch (    ServiceException e) {
      IOException ioe=ProtobufUtil.getRemoteException(e);
      assertThat(ioe,instanceOf(AccessDeniedException.class));
      assertThat(ioe.getMessage(),containsString("Token generation only allowed for Kerberos authenticated clients"));
    }
  }
 }

@Test public void testSmallImageDiskCacheGetSuccessful(){
  when(mImageRequest.getCacheChoice()).thenReturn(ImageRequest.CacheChoice.SMALL);
  setupDiskCacheGetSuccess(mSmallImageBufferedDiskCache);
  mDiskCacheReadProducer.produceResults(mConsumer,mProducerContext);
  verify(mConsumer).onNewResult(mFinalEncodedImage,Consumer.IS_LAST);
  verify(mProducerListener).onProducerStart(mRequestId,PRODUCER_NAME);
  ArgumentCaptor<HashMap> captor=ArgumentCaptor.forClass(HashMap.class);
  verify(mProducerListener).onProducerFinishWithSuccess(eq(mRequestId),eq(PRODUCER_NAME),captor.capture());
  Map<String,String> resultMap=captor.getValue();
  assertEquals("true",resultMap.get(DiskCacheReadProducer.EXTRA_CACHED_VALUE_FOUND));
  assertEquals("0",resultMap.get(DiskCacheReadProducer.ENCODED_IMAGE_SIZE));
  verify(mProducerListener).onUltimateProducerReached(mRequestId,PRODUCER_NAME,true);
  Assert.assertFalse(EncodedImage.isValid(mFinalEncodedImage));
}

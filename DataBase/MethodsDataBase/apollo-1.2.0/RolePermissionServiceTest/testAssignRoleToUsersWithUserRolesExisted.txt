@Test @Sql(scripts="/sql/permission/insert-test-roles.sql",executionPhase=Sql.ExecutionPhase.BEFORE_TEST_METHOD) @Sql(scripts="/sql/permission/insert-test-userroles.sql",executionPhase=Sql.ExecutionPhase.BEFORE_TEST_METHOD) @Sql(scripts="/sql/cleanup.sql",executionPhase=Sql.ExecutionPhase.AFTER_TEST_METHOD) public void testAssignRoleToUsersWithUserRolesExisted() throws Exception {
  String someRoleName="someRoleName";
  String someUser="someUser";
  String anotherUser="anotherUser";
  String operator="operator";
  Set<String> users=Sets.newHashSet(someUser,anotherUser);
  rolePermissionService.assignRoleToUsers(someRoleName,users,operator);
  List<UserRole> userRoles=userRoleRepository.findByRoleId(990);
  Set<String> usersWithRole=Sets.newHashSet();
  for (  UserRole userRole : userRoles) {
    assertEquals("someOperator",userRole.getDataChangeCreatedBy());
    assertEquals("someOperator",userRole.getDataChangeLastModifiedBy());
    usersWithRole.add(userRole.getUserId());
  }
  assertEquals(2,usersWithRole.size());
  assertTrue(usersWithRole.containsAll(users));
}

@Test public void oauth2LoginCustomWithConfigurer() throws Exception {
  loadConfig(OAuth2LoginConfigCustomWithConfigurer.class);
  OAuth2AuthorizationRequest authorizationRequest=createOAuth2AuthorizationRequest();
  this.authorizationRequestRepository.saveAuthorizationRequest(authorizationRequest,this.request,this.response);
  this.request.setParameter("code","code123");
  this.request.setParameter("state",authorizationRequest.getState());
  this.springSecurityFilterChain.doFilter(this.request,this.response,this.filterChain);
  Authentication authentication=this.securityContextRepository.loadContext(new HttpRequestResponseHolder(this.request,this.response)).getAuthentication();
  assertThat(authentication.getAuthorities()).hasSize(2);
  assertThat(authentication.getAuthorities()).first().hasToString("ROLE_USER");
  assertThat(authentication.getAuthorities()).last().hasToString("ROLE_OAUTH2_USER");
}

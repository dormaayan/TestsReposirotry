@Test(expected=BadCredentialsException.class) public void testPasswordChangeWithWrongOldPasswordFails(){
  InetOrgPerson.Essence p=new InetOrgPerson.Essence();
  p.setDn("whocares");
  p.setCn(new String[]{"John Yossarian"});
  p.setSn("Yossarian");
  p.setUid("johnyossarian");
  p.setPassword("yossarianspassword");
  p.setAuthorities(TEST_AUTHORITIES);
  mgr.createUser(p.createUserDetails());
  SecurityContextHolder.getContext().setAuthentication(new UsernamePasswordAuthenticationToken("johnyossarian","yossarianspassword",TEST_AUTHORITIES));
  mgr.changePassword("wrongpassword","yossariansnewpassword");
}

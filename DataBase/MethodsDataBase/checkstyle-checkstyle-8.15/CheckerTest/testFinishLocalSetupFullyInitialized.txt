@Test public void testFinishLocalSetupFullyInitialized() throws Exception {
  final Checker checker=new Checker();
  final ClassLoader contextClassLoader=Thread.currentThread().getContextClassLoader();
  checker.setModuleClassLoader(contextClassLoader);
  final PackageObjectFactory factory=new PackageObjectFactory(new HashSet<>(),contextClassLoader);
  checker.setModuleFactory(factory);
  checker.setBasedir("testBaseDir");
  checker.setLocaleLanguage("it");
  checker.setLocaleCountry("IT");
  checker.finishLocalSetup();
  final Context context=Whitebox.getInternalState(checker,"childContext");
  assertEquals("Charset was different than expected",System.getProperty("file.encoding",StandardCharsets.UTF_8.name()),context.get("charset"));
  assertEquals("Was used insufficient classloader",contextClassLoader,context.get("classLoader"));
  assertEquals("Severity is set to unexpected value","error",context.get("severity"));
  assertEquals("Basedir is set to unexpected value","testBaseDir",context.get("basedir"));
  final Field sLocale=LocalizedMessage.class.getDeclaredField("sLocale");
  sLocale.setAccessible(true);
  final Locale locale=(Locale)sLocale.get(null);
  assertEquals("Locale is set to unexpected value",Locale.ITALY,locale);
}

@Test public void testClearExistingCache() throws Exception {
  final DefaultConfiguration checkerConfig=createRootConfig(null);
  checkerConfig.addAttribute("charset",StandardCharsets.UTF_8.name());
  final File cacheFile=temporaryFolder.newFile();
  checkerConfig.addAttribute("cacheFile",cacheFile.getPath());
  final Checker checker=new Checker();
  checker.setModuleClassLoader(Thread.currentThread().getContextClassLoader());
  checker.configure(checkerConfig);
  checker.addListener(getBriefUtLogger());
  checker.clearCache();
  checker.destroy();
  final Properties cacheAfterClear=new Properties();
  cacheAfterClear.load(Files.newBufferedReader(cacheFile.toPath()));
  assertEquals("Cache has unexpected size",1,cacheAfterClear.size());
  assertNotNull("Cache has null hash",cacheAfterClear.getProperty(PropertyCacheFile.CONFIG_HASH_KEY));
  final String pathToEmptyFile=temporaryFolder.newFile("file.java").getPath();
  final String[] expected=CommonUtil.EMPTY_STRING_ARRAY;
  verify(checker,pathToEmptyFile,pathToEmptyFile,expected);
  final Properties cacheAfterSecondRun=new Properties();
  cacheAfterSecondRun.load(Files.newBufferedReader(cacheFile.toPath()));
  assertNotNull("Cache has null path",cacheAfterSecondRun.getProperty(pathToEmptyFile));
  assertEquals("Cash have changed it hash",cacheAfterClear.getProperty(PropertyCacheFile.CONFIG_HASH_KEY),cacheAfterSecondRun.getProperty(PropertyCacheFile.CONFIG_HASH_KEY));
  final int expectedNumberOfObjectsInCacheAfterSecondRun=2;
  assertEquals("Cache has changed number of items",expectedNumberOfObjectsInCacheAfterSecondRun,cacheAfterSecondRun.size());
}

@Test public void testDuplicatedModule() throws Exception {
  final DefaultConfiguration moduleConfig1=createModuleConfig(NewlineAtEndOfFileCheck.class);
  final DefaultConfiguration moduleConfig2=createModuleConfig(NewlineAtEndOfFileCheck.class);
  moduleConfig2.addAttribute("id","ModuleId");
  final DefaultConfiguration root=new DefaultConfiguration("root");
  root.addChild(moduleConfig1);
  root.addChild(moduleConfig2);
  final Checker checker=new Checker();
  checker.setModuleClassLoader(Thread.currentThread().getContextClassLoader());
  checker.configure(root);
  final ByteArrayOutputStream out=Whitebox.getInternalState(this,"stream");
  final DefaultLogger logger=new DefaultLogger(out,true,out,false,new AuditEventDefaultFormatter());
  checker.addListener(logger);
  final String path=temporaryFolder.newFile("file.java").getPath();
  final String errorMessage=getCheckMessage(NewlineAtEndOfFileCheck.class,MSG_KEY_NO_NEWLINE_EOF);
  final String[] expected={"1: " + errorMessage + " [NewlineAtEndOfFile]","1: " + errorMessage + " [ModuleId]"};
  out.flush();
  final int errs=checker.process(Collections.singletonList(new File(path)));
  try (ByteArrayInputStream inputStream=new ByteArrayInputStream(out.toByteArray());LineNumberReader lnr=new LineNumberReader(new InputStreamReader(inputStream,StandardCharsets.UTF_8))){
    final List<String> actual=lnr.lines().filter(line -> !getCheckMessage(AUDIT_STARTED_MESSAGE).equals(line)).filter(line -> !getCheckMessage(AUDIT_FINISHED_MESSAGE).equals(line)).limit(expected.length).sorted().collect(Collectors.toList());
    Arrays.sort(expected);
    for (int i=0; i < expected.length; i++) {
      final String expectedResult="[ERROR] " + path + ":"+ expected[i];
      assertEquals("error message " + i,expectedResult,actual.get(i));
    }
    assertEquals("unexpected output: " + lnr.readLine(),expected.length,errs);
  }
   checker.destroy();
}

@Test @SuppressWarnings("unchecked") public void testPackagesWithIoException() throws Exception {
  final URLConnection mockConnection=Mockito.mock(URLConnection.class);
  when(mockConnection.getInputStream()).thenReturn(null);
  final URL url=getMockUrl(mockConnection);
  final Enumeration<URL> enumer=mock(Enumeration.class);
  when(enumer.hasMoreElements()).thenReturn(true);
  when(enumer.nextElement()).thenReturn(url);
  final ClassLoader classLoader=mock(ClassLoader.class);
  when(classLoader.getResources("checkstyle_packages.xml")).thenReturn(enumer);
  try {
    PackageNamesLoader.getPackageNames(classLoader);
    fail("CheckstyleException is expected");
  }
 catch (  CheckstyleException ex) {
    assertTrue("Invalid exception cause class",ex.getCause() instanceof IOException);
    assertNotEquals("Invalid exception message","unable to get package file resources",ex.getMessage());
  }
}

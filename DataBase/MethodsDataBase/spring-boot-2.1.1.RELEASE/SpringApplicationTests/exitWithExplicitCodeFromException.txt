@Test public void exitWithExplicitCodeFromException(){
  final SpringBootExceptionHandler handler=mock(SpringBootExceptionHandler.class);
  SpringApplication application=new SpringApplication(ExitCodeCommandLineRunConfig.class){
    @Override SpringBootExceptionHandler getSpringBootExceptionHandler(){
      return handler;
    }
  }
;
  ExitCodeListener listener=new ExitCodeListener();
  application.addListeners(listener);
  application.setWebApplicationType(WebApplicationType.NONE);
  try {
    application.run();
    fail("Did not throw");
  }
 catch (  IllegalStateException ex) {
  }
  verify(handler).registerExitCode(11);
  assertThat(listener.getExitCode()).isEqualTo(11);
}

@Test public void testNodeLocalAllocationSameSchedKey() throws Exception {
  ResourceBlacklistRequest blacklistRequest=ResourceBlacklistRequest.newInstance(new ArrayList<>(),new ArrayList<>());
  List<ResourceRequest> reqs=Arrays.asList(ResourceRequest.newBuilder().allocationRequestId(2).numContainers(2).priority(Priority.newInstance(1)).resourceName("/r1").capability(Resources.createResource(1 * GB)).relaxLocality(true).executionType(ExecutionType.OPPORTUNISTIC).build(),ResourceRequest.newBuilder().allocationRequestId(2).numContainers(2).priority(Priority.newInstance(1)).resourceName("h1").capability(Resources.createResource(1 * GB)).relaxLocality(true).executionType(ExecutionType.OPPORTUNISTIC).build(),ResourceRequest.newBuilder().allocationRequestId(2).numContainers(2).priority(Priority.newInstance(1)).resourceName(ResourceRequest.ANY).capability(Resources.createResource(1 * GB)).relaxLocality(true).executionType(ExecutionType.OPPORTUNISTIC).build());
  ApplicationAttemptId appAttId=ApplicationAttemptId.newInstance(ApplicationId.newInstance(0L,1),1);
  oppCntxt.updateNodeList(Arrays.asList(RemoteNode.newInstance(NodeId.newInstance("h1",1234),"h1:1234","/r1"),RemoteNode.newInstance(NodeId.newInstance("h2",1234),"h2:1234","/r1"),RemoteNode.newInstance(NodeId.newInstance("h3",1234),"h3:1234","/r1")));
  List<Container> containers=allocator.allocateContainers(blacklistRequest,reqs,appAttId,oppCntxt,1L,"luser");
  System.out.println(containers);
  Set<String> allocatedHosts=new HashSet<>();
  for (  Container c : containers) {
    allocatedHosts.add(c.getNodeHttpAddress());
  }
  Assert.assertEquals(2,containers.size());
  Assert.assertTrue(allocatedHosts.contains("h1:1234"));
  Assert.assertFalse(allocatedHosts.contains("h2:1234"));
  Assert.assertFalse(allocatedHosts.contains("h3:1234"));
}

@Test public void testTaskOutputListingWithHiddenFiles() throws Exception {
  PartitionedStagingCommitter committer=newTaskCommitter();
  attemptPath=committer.getTaskAttemptPath(getTAC());
  attemptFS=attemptPath.getFileSystem(getTAC().getConfiguration());
  attemptFS.delete(attemptPath,true);
  try {
    List<String> expectedFiles=Lists.newArrayList();
    for (    String dateint : Arrays.asList("20161115","20161116")) {
      String metadata="dateint=" + dateint + "/"+ "_metadata";
      attemptFS.create(new Path(attemptPath,metadata)).close();
      for (      String hour : Arrays.asList("13","14")) {
        String relative="dateint=" + dateint + "/hour="+ hour+ "/"+ UUID.randomUUID().toString()+ ".parquet";
        expectedFiles.add(relative);
        attemptFS.create(new Path(attemptPath,relative)).close();
        String partial="dateint=" + dateint + "/hour="+ hour+ "/."+ UUID.randomUUID().toString()+ ".partial";
        attemptFS.create(new Path(attemptPath,partial)).close();
      }
    }
    List<String> actualFiles=committer.getTaskOutput(getTAC()).stream().map(stat -> Paths.getRelativePath(attemptPath,stat.getPath())).collect(Collectors.toList());
    Collections.sort(expectedFiles);
    Collections.sort(actualFiles);
    assertEquals("File sets should match",expectedFiles,actualFiles);
  }
  finally {
    deleteQuietly(attemptFS,attemptPath,true);
  }
}

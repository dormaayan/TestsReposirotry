@Test public void testFileStatusWithECPolicy() throws Exception {
  final Path dir=new Path("/foo");
  assertTrue(fs.mkdir(dir,FsPermission.getDirDefault()));
  ContractTestUtils.assertNotErasureCoded(fs,dir);
  assertNull(client.getFileInfo(dir.toString()).getErasureCodingPolicy());
  final Path file=new Path(dir,"foo");
  fs.create(file).close();
  assertNull(client.getFileInfo(file.toString()).getErasureCodingPolicy());
  ContractTestUtils.assertNotErasureCoded(fs,file);
  fs.delete(file,true);
  final ErasureCodingPolicy ecPolicy1=getEcPolicy();
  fs.setErasureCodingPolicy(dir,ecPolicy1.getName());
  ContractTestUtils.assertErasureCoded(fs,dir);
  final ErasureCodingPolicy ecPolicy2=client.getFileInfo(dir.toUri().getPath()).getErasureCodingPolicy();
  assertNotNull(ecPolicy2);
  assertTrue(ecPolicy1.equals(ecPolicy2));
  fs.create(file).close();
  final ErasureCodingPolicy ecPolicy3=fs.getClient().getFileInfo(file.toUri().getPath()).getErasureCodingPolicy();
  assertNotNull(ecPolicy3);
  assertTrue(ecPolicy1.equals(ecPolicy3));
  ContractTestUtils.assertErasureCoded(fs,file);
  FileStatus status=fs.getFileStatus(file);
  assertTrue(file + " should have erasure coding set in " + "FileStatus#toString(): "+ status,status.toString().contains("isErasureCoded=true"));
}

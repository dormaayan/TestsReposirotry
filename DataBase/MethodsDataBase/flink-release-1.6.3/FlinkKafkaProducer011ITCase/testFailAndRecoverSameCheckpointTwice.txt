@Test public void testFailAndRecoverSameCheckpointTwice() throws Exception {
  String topic="flink-kafka-producer-fail-and-recover-same-checkpoint-twice";
  OperatorSubtaskState snapshot1;
  try (OneInputStreamOperatorTestHarness<Integer,Object> testHarness=createTestHarness(topic)){
    testHarness.setup();
    testHarness.open();
    testHarness.processElement(42,0);
    testHarness.snapshot(0,1);
    testHarness.processElement(43,2);
    snapshot1=testHarness.snapshot(1,3);
    testHarness.processElement(44,4);
  }
   try (OneInputStreamOperatorTestHarness<Integer,Object> testHarness=createTestHarness(topic)){
    testHarness.setup();
    testHarness.initializeState(snapshot1);
    testHarness.open();
    testHarness.processElement(44,7);
    testHarness.snapshot(2,8);
    testHarness.processElement(45,9);
  }
   try (OneInputStreamOperatorTestHarness<Integer,Object> testHarness=createTestHarness(topic)){
    testHarness.setup();
    testHarness.initializeState(snapshot1);
    testHarness.open();
    testHarness.processElement(44,7);
    testHarness.snapshot(3,8);
    testHarness.processElement(45,9);
  }
   assertExactlyOnceForTopic(createProperties(),topic,0,Arrays.asList(42,43));
  deleteTestTopic(topic);
}

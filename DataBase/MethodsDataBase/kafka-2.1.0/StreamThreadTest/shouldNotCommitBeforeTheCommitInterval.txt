@SuppressWarnings({"unchecked","ThrowableNotThrown"}) @Test public void shouldNotCommitBeforeTheCommitInterval(){
  final long commitInterval=1000L;
  final Properties props=configProps(false);
  props.setProperty(StreamsConfig.STATE_DIR_CONFIG,stateDir);
  props.setProperty(StreamsConfig.COMMIT_INTERVAL_MS_CONFIG,Long.toString(commitInterval));
  final StreamsConfig config=new StreamsConfig(props);
  final Consumer<byte[],byte[]> consumer=EasyMock.createNiceMock(Consumer.class);
  final TaskManager taskManager=mockTaskManagerCommit(consumer,1,1);
  final StreamThread.StreamsMetricsThreadImpl streamsMetrics=new StreamThread.StreamsMetricsThreadImpl(metrics,"");
  final StreamThread thread=new StreamThread(mockTime,config,null,consumer,consumer,null,taskManager,streamsMetrics,internalTopologyBuilder,clientId,new LogContext(""),new AtomicInteger());
  thread.setNow(mockTime.milliseconds());
  thread.maybeCommit();
  mockTime.sleep(commitInterval - 10L);
  thread.setNow(mockTime.milliseconds());
  thread.maybeCommit();
  EasyMock.verify(taskManager);
}

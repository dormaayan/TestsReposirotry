@Test public void testTimedAndSizedTruncationError(){
  TestScheduler test=new TestScheduler();
  SizeAndTimeBoundReplayBuffer<Integer> buf=new SizeAndTimeBoundReplayBuffer<Integer>(2,2000,TimeUnit.MILLISECONDS,test);
  Assert.assertFalse(buf.hasCompleted());
  Assert.assertFalse(buf.hasError());
  List<Integer> values=new ArrayList<Integer>();
  buf.next(1);
  test.advanceTimeBy(1,TimeUnit.SECONDS);
  buf.next(2);
  test.advanceTimeBy(1,TimeUnit.SECONDS);
  buf.collect(values);
  Assert.assertEquals(Arrays.asList(2),values);
  buf.next(3);
  buf.next(4);
  values.clear();
  buf.collect(values);
  Assert.assertEquals(Arrays.asList(3,4),values);
  test.advanceTimeBy(2,TimeUnit.SECONDS);
  buf.next(5);
  values.clear();
  buf.collect(values);
  Assert.assertEquals(Arrays.asList(5),values);
  Assert.assertFalse(buf.hasCompleted());
  Assert.assertFalse(buf.hasError());
  test.advanceTimeBy(2,TimeUnit.SECONDS);
  buf.error(new TestException());
  values.clear();
  buf.collect(values);
  Assert.assertTrue(values.isEmpty());
  Assert.assertEquals(1,buf.size);
  Assert.assertFalse(buf.hasCompleted());
  Assert.assertTrue(buf.hasError());
}

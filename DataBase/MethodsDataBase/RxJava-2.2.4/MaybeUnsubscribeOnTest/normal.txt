@Test public void normal() throws Exception {
  PublishProcessor<Integer> pp=PublishProcessor.create();
  final String[] name={null};
  final CountDownLatch cdl=new CountDownLatch(1);
  pp.doOnCancel(new Action(){
    @Override public void run() throws Exception {
      name[0]=Thread.currentThread().getName();
      cdl.countDown();
    }
  }
).singleElement().unsubscribeOn(Schedulers.single()).test(true);
  assertTrue(cdl.await(5,TimeUnit.SECONDS));
  int times=10;
  while (times-- > 0 && pp.hasSubscribers()) {
    Thread.sleep(100);
  }
  assertFalse(pp.hasSubscribers());
  assertNotEquals(Thread.currentThread().getName(),name[0]);
}

@Test public void testToMultimapWithCollectionFactory(){
  Observable<String> source=Observable.just("cc","dd","eee","eee");
  Function<Integer,Collection<String>> collectionFactory=new Function<Integer,Collection<String>>(){
    @Override public Collection<String> apply(    Integer t1){
      if (t1 == 2) {
        return new ArrayList<String>();
      }
 else {
        return new HashSet<String>();
      }
    }
  }
;
  Function<String,String> identity=new Function<String,String>(){
    @Override public String apply(    String v){
      return v;
    }
  }
;
  Callable<Map<Integer,Collection<String>>> mapSupplier=new Callable<Map<Integer,Collection<String>>>(){
    @Override public Map<Integer,Collection<String>> call(){
      return new HashMap<Integer,Collection<String>>();
    }
  }
;
  Single<Map<Integer,Collection<String>>> mapped=source.toMultimap(lengthFunc,identity,mapSupplier,collectionFactory);
  Map<Integer,Collection<String>> expected=new HashMap<Integer,Collection<String>>();
  expected.put(2,Arrays.asList("cc","dd"));
  expected.put(3,new HashSet<String>(Arrays.asList("eee")));
  mapped.subscribe(singleObserver);
  verify(singleObserver,never()).onError(any(Throwable.class));
  verify(singleObserver,times(1)).onSuccess(expected);
}

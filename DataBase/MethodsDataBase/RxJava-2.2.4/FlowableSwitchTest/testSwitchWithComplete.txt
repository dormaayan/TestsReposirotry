@Test public void testSwitchWithComplete(){
  Flowable<Flowable<String>> source=Flowable.unsafeCreate(new Publisher<Flowable<String>>(){
    @Override public void subscribe(    Subscriber<? super Flowable<String>> subscriber){
      subscriber.onSubscribe(new BooleanSubscription());
      publishNext(subscriber,50,Flowable.unsafeCreate(new Publisher<String>(){
        @Override public void subscribe(        final Subscriber<? super String> subscriber){
          subscriber.onSubscribe(new BooleanSubscription());
          publishNext(subscriber,60,"one");
          publishNext(subscriber,100,"two");
        }
      }
));
      publishNext(subscriber,200,Flowable.unsafeCreate(new Publisher<String>(){
        @Override public void subscribe(        final Subscriber<? super String> subscriber){
          subscriber.onSubscribe(new BooleanSubscription());
          publishNext(subscriber,0,"three");
          publishNext(subscriber,100,"four");
        }
      }
));
      publishCompleted(subscriber,250);
    }
  }
);
  Flowable<String> sampled=Flowable.switchOnNext(source);
  sampled.subscribe(subscriber);
  InOrder inOrder=inOrder(subscriber);
  scheduler.advanceTimeTo(90,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,never()).onNext(anyString());
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
  scheduler.advanceTimeTo(125,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,times(1)).onNext("one");
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
  scheduler.advanceTimeTo(175,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,times(1)).onNext("two");
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
  scheduler.advanceTimeTo(225,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,times(1)).onNext("three");
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
  scheduler.advanceTimeTo(350,TimeUnit.MILLISECONDS);
  inOrder.verify(subscriber,times(1)).onNext("four");
  verify(subscriber,never()).onComplete();
  verify(subscriber,never()).onError(any(Throwable.class));
}

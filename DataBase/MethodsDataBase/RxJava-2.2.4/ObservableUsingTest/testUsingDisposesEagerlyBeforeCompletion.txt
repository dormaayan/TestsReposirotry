@Test public void testUsingDisposesEagerlyBeforeCompletion(){
  final List<String> events=new ArrayList<String>();
  Callable<Resource> resourceFactory=createResourceFactory(events);
  final Action completion=createOnCompletedAction(events);
  final Action unsub=createUnsubAction(events);
  Function<Resource,Observable<String>> observableFactory=new Function<Resource,Observable<String>>(){
    @Override public Observable<String> apply(    Resource resource){
      return Observable.fromArray(resource.getTextFromWeb().split(" "));
    }
  }
;
  Observer<String> observer=TestHelper.mockObserver();
  Observable<String> o=Observable.using(resourceFactory,observableFactory,new DisposeAction(),true).doOnDispose(unsub).doOnComplete(completion);
  o.safeSubscribe(observer);
  assertEquals(Arrays.asList("disposed","completed"),events);
}

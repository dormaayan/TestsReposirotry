@Test public void testToMapWithErrorInValueSelectorObservable(){
  Observable<String> source=Observable.just("a","bb","ccc","dddd");
  Function<String,String> duplicateErr=new Function<String,String>(){
    @Override public String apply(    String t1){
      if ("bb".equals(t1)) {
        throw new RuntimeException("Forced failure");
      }
      return t1 + t1;
    }
  }
;
  Observable<Map<Integer,String>> mapped=source.toMap(lengthFunc,duplicateErr).toObservable();
  Map<Integer,String> expected=new HashMap<Integer,String>();
  expected.put(1,"aa");
  expected.put(2,"bbbb");
  expected.put(3,"cccccc");
  expected.put(4,"dddddddd");
  mapped.subscribe(objectObserver);
  verify(objectObserver,never()).onNext(expected);
  verify(objectObserver,never()).onComplete();
  verify(objectObserver,times(1)).onError(any(Throwable.class));
}
